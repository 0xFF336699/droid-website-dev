{"version":3,"file":"static/chunks/pages/im/room/meeting-4eede7dd3265a833.js","mappings":"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","sources":["webpack://_N_E/./src/im/components/meeting/meeting-page-content/MeetingPageContent.tsx","webpack://_N_E/./src/pages/im/room/meeting/index.tsx","webpack://_N_E/?be01","webpack://_N_E/../../node_modules/.pnpm/react-i18next@15.1.4_i18next@24.1.0_typescript@5.8.2__react-dom@19.0.0_react@19.0.0__react@19.0.0/node_modules/react-i18next/dist/es/index.js","webpack://_N_E/../../../../src/components/app/AppShell.tsx","webpack://_N_E/../../../../src/components/page/PageContent.tsx","webpack://_N_E/../../../../src/components/page/AndroidPageContent.tsx","webpack://_N_E/../../../src/mc/static-model.ts","webpack://_N_E/../../../../src/components/motion/page-transition.tsx","webpack://_N_E/../../../../src/components/app/PageShell.tsx","webpack://_N_E/../../../../src/components/appbar/AppBar.tsx"],"sourcesContent":["import { useRouter } from 'next/router';\r\nimport { useEffect, useState } from 'react';\r\nimport { mainModel } from '@src/libs/mc/main/MainModel';\r\nimport { matrixUser, matrixClient } from '@src/im/client';\r\nimport { Log, useProxyWatch } from '@fanfanlo';\r\nimport _ from 'lodash';\r\n\r\nconst fileLogger = new Log(false, 'im.components.meeting.MeetingPageContent');\r\n// fileLogger.pause = true;\r\n\r\nexport function MeetingPageContent() {\r\n  const logger = fileLogger.sub(false, 'MeetingPageContent_fn');\r\n  // logger.pause = true;\r\n  const router = useRouter();\r\n  const { roomId, callId } = router.query;\r\n  // logger.info('路由参数', { roomId, callId });\r\n\r\n  // 侦听登录态\r\n  const [loginResponse] = useProxyWatch(\r\n    matrixUser.userData,\r\n    'userInfo.loginResponse',\r\n    matrixUser.userData.userInfo.loginResponse,\r\n  );\r\n  logger.info('loginResponse', loginResponse);\r\n\r\n  const [meetingUrl, setMeetingUrl] = useState('');\r\n\r\n  useEffect(() => {\r\n    // logger.info('【副作用】loginResponse/roomId/callId 变化:', { loginResponse, roomId, callId });\r\n    if (!loginResponse) {\r\n      return;\r\n    }\r\n    let cancelled = false;\r\n    async function buildUrl() {\r\n      if (loginResponse && roomId && callId) {\r\n        const elementCallUrl = mainModel.appConfig?.elementCall?.url || '';\r\n        let userId = '';\r\n        let accessToken = '';\r\n        let homeserver = mainModel.appConfig?.matrix?.homeserver || '';\r\n        try {\r\n          userId = (await matrixClient.client?.getUserId?.()) || '';\r\n          accessToken = (await matrixClient.client?.getAccessToken?.()) || '';\r\n        } catch (e) {\r\n          logger.error('获取 matrixClient.client 用户信息失败', e);\r\n        }\r\n        // logger.info('用户身份参数', { userId, accessToken, homeserver });\r\n        if (elementCallUrl && userId && accessToken && homeserver) {\r\n          // const url = `${elementCallUrl}/room/#/${callId}?roomId=${(roomId as string)}&user_id=${(userId)}&access_token=${(accessToken)}&homeserver=${(homeserver)}`;\r\n          const url = `${elementCallUrl}/room/#/${callId}?roomId=${roomId as string}&userId=${userId}&accessToken=${accessToken}&homeserver=${homeserver}&intent=start_call&parentUrl=${encodeURIComponent(window.location.href)}&widgetId=123456&deviceId=${loginResponse.device_id}&baseUrl=${encodeURIComponent('https://website-droid-dev.droidlego.com')}`;\r\n          if (!cancelled) setMeetingUrl(url);\r\n          // if (!cancelled) setMeetingUrl(`https://dev-server-element-call-im-droid.droidlego.com/#/hi-friends?password=CtwndaKq46CNg0hhF3FImA&roomId=%21SHitIJaIjdWkvUhBeE%3Awebsite-droid-dev.droidlego.com`);\r\n          // if (!cancelled) setMeetingUrl(`https://dev-server-element-call-im-droid.droidlego.com/#/hi-friends?password=CtwndaKq46CNg0hhF3FImA&displayName=fanfanlo`);\r\n          logger.info('最终拼接的 meetingUrl', url);\r\n        } else {\r\n          if (!cancelled) setMeetingUrl('');\r\n          logger.warn('参数缺失，无法拼接 meetingUrl');\r\n        }\r\n      } else {\r\n        if (!cancelled) setMeetingUrl('');\r\n        logger.info('未登录或参数不全，meetingUrl 置空');\r\n      }\r\n    }\r\n    buildUrl();\r\n    return () => {\r\n      cancelled = true;\r\n    };\r\n  }, [loginResponse, roomId, callId]);\r\n\r\n  useEffect(() => {\r\n    async function handleMessage(event: MessageEvent) {\r\n      //   logger.log('event=', event);\r\n      //   logger.log('eventype=', event.type);\r\n      const { data } = event;\r\n      if (!data) return;\r\n      logger.log('data json=', JSON.stringify(data));\r\n      if (!(data.api == 'fromWidget')) return;\r\n      const iframe = document.getElementById('element-call-iframe') as HTMLIFrameElement;\r\n      if (!iframe) return;\r\n      let resultData: any = _.cloneDeep(data);\r\n      resultData.api = 'toWidget';\r\n      let sendMessage = true;\r\n      let response: any = undefined;\r\n      let res: any = {\r\n        api: 'toWidget',\r\n        widgetId: data.widgetId,\r\n        requestId: data.requestId,\r\n      };\r\n      switch (data.action) {\r\n        case 'supported_api_versions':\r\n          const versions = await matrixClient.client?.getVersions();\r\n          res = {\r\n            data:{\r\n                api:data.api,\r\n                widgetId: data.widgetId,\r\n                requestId: data.requestId,\r\n                action:\"supported_api_versions\",\r\n                response:{\r\n                    supported_versions:versions.versions,\r\n                }\r\n            }\r\n          }\r\n          break;\r\n        case 'content_loaded':\r\n          res.action = 'theme_change';\r\n\r\n          res.data = {\r\n            age: 3,\r\n            name: 'light',\r\n          };\r\n          break;\r\n        default:\r\n          sendMessage = false;\r\n          console.log('unknown action=', data.action);\r\n      }\r\n      //   const  res = {\r\n      //     api: 'toWidget',\r\n      //     widgetId: data.widgetId,\r\n      //     requestId: data.requestId,\r\n      //     action: 'theme_change',\r\n      //     data: {\r\n      //       name: 'light',\r\n      //     },\r\n      //   };\r\n      logger.log('postMessage=', JSON.stringify(res));\r\n      iframe.contentWindow?.postMessage(res, 'https://dev-server-element-call-im-droid.droidlego.com');\r\n      iframe.contentWindow?.postMessage(res, 'https://homepage.vm-ubuntu.droidlego.com');\r\n      iframe.contentWindow?.postMessage(res, '*');\r\n    }\r\n\r\n    window.addEventListener('message', handleMessage);\r\n    return () => window.removeEventListener('message', handleMessage);\r\n  }, [loginResponse, roomId, callId]);\r\n  return (\r\n    <div style={{ width: '100%', height: '100%', position: 'relative' }}>\r\n      <h1>会议页面</h1>\r\n      <div>{meetingUrl}</div>\r\n      {!loginResponse ? (\r\n        <div>请先登录 Matrix 账号...</div>\r\n      ) : !meetingUrl ? (\r\n        <div>参数缺失或 element-call 配置缺失，无法加载会议</div>\r\n      ) : (\r\n        <iframe\r\n        id='element-call-iframe'\r\n          src={meetingUrl}\r\n          style={{ width: '100%', height: 600, border: '1px solid #ccc', borderRadius: 8 }}\r\n          allow=\"camera; microphone; fullscreen; display-capture\"\r\n          title=\"会议\"\r\n        />\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","import { AppbarContainer, AppShell } from \"@app/ui\";\r\nimport { useTranslation } from \"@fanfanlo\";\r\nimport { useRouter } from 'next/router';\r\nimport { useEffect } from 'react';\r\nimport { MeetingPageContent } from '@src/im/components/meeting/meeting-page-content/MeetingPageContent';\r\n\r\nexport default function BasicSettingsPage() {\r\n  const { t } = useTranslation(\"homepage/pages/im/room/meeting/content\");\r\n  const router = useRouter();\r\n  const { roomId, callId } = router.query;\r\n\r\n  useEffect(() => {\r\n    // 如果没有 roomId，重定向到聊天列表\r\n    if (!roomId && router.isReady) {\r\n      router.push('/im');\r\n    }\r\n  }, [roomId, router]);\r\n\r\n  // 可选：调试参数\r\n  // console.log('title=', t(\"content.title\"), 'roomId=', roomId, 'callId=', callId);\r\n  return (\r\n    <AppShell>\r\n      <AppbarContainer appbarProps={{ title: t(\"content.title\"), back: true }}>\r\n        <MeetingPageContent />\r\n      </AppbarContainer>\r\n    </AppShell>\r\n  );\r\n} ","\n    (window.__NEXT_P = window.__NEXT_P || []).push([\n      \"/im/room/meeting\",\n      function () {\n        return require(\"private-next-pages/im/room/meeting/index.tsx\");\n      }\n    ]);\n    if(module.hot) {\n      module.hot.dispose(function () {\n        window.__NEXT_P.push([\"/im/room/meeting\"])\n      });\n    }\n  ","export * from \"C:\\\\work\\\\android-droid\\\\html\\\\website-2024-12\\\\node_modules\\\\.pnpm\\\\react-i18next@15.1.4_i18next@24.1.0_typescript@5.8.2__react-dom@19.0.0_react@19.0.0__react@19.0.0\\\\node_modules\\\\react-i18next\\\\dist\\\\es\\\\index.js\"","'use client'\r\nimport { i18n, i18nInit, IPageScrollPosition, StorePageContext, StorePageDynamicContext, toProxy, watchUpdates, storeUtils } from \"@fanfanlo\";\r\nimport { useRouter } from \"next/router\";\r\nimport { PropsWithChildren, useEffect } from \"react\";\r\nimport { I18nextProvider } from \"react-i18next\";\r\n\r\n\r\ni18nInit()\r\n\r\nexport function AppShell({ children }: PropsWithChildren) {\r\n  const router = useRouter();\r\n  const scrollKey = 'scrollPositionInfo'\r\n  const href = window.location.href.split(\"#\")[0]\r\n  const dynamicKey = `dynamic-${href}`\r\n  const s = storeUtils.namespace(dynamicKey);\r\n  let o: Record<string, unknown>|undefined = s.read(dynamicKey)\r\n  if (!o) {\r\n    o = {}\r\n    s.write(dynamicKey, o)\r\n  }\r\n  o = toProxy(o)\r\n  useEffect(() => {\r\n\r\n    router.beforePopState((state) => {\r\n      s.clearAll()\r\n      return true\r\n    })\r\n  })\r\n  useEffect(() => {\r\n    s.write(dynamicKey, o)\r\n    return watchUpdates(o, () => {\r\n      s.write(dynamicKey, o)\r\n    })\r\n  }, [])\r\n  useEffect(() => {\r\n    const info = (s.read(scrollKey) || { x: 0, y: 0 }) as IPageScrollPosition\r\n    // console.log('app shell scroll info info = ', info)\r\n    if (info.x == 0 && info.y == 0) {\r\n      listenScroll()\r\n    } else {\r\n      window.requestAnimationFrame(() => {\r\n        window.scrollTo(info.x, info.y)\r\n        listenScroll()\r\n      })\r\n    }\r\n    function onScroll(e: Event) {\r\n      // console.log('app shell on scroll', { x: window.scrollX, y: window.scrollY })\r\n      s.write(scrollKey, { x: window.scrollX, y: window.scrollY })\r\n    }\r\n    function listenScroll() {\r\n      window.addEventListener('scroll', onScroll)\r\n    }\r\n\r\n    function unsub() {\r\n      window.removeEventListener('scroll', onScroll)\r\n    }\r\n    return unsub\r\n  });\r\n  return (\r\n    <StorePageContext value={s}>\r\n      <StorePageDynamicContext value={o}>\r\n\r\n        <I18nextProvider i18n={i18n}>\r\n          {children}\r\n        </I18nextProvider>\r\n      </StorePageDynamicContext>\r\n    </StorePageContext>\r\n  )\r\n}","import { Box, Button, Container } from '@mui/material';\r\nimport { createContext, PropsWithChildren, useContext, useEffect } from 'react';\r\nimport { ITitleI18nConf, ITitleI18nNsConf, ITitleI18nTitleConf } from '.';\r\nimport { isBuild, isDev, isServer, loadI18nValue, publicRuntimeConfig } from '@fanfanlo';\r\nimport { read } from 'fs';\r\nimport { useTranslation } from '@fanfanlo';\r\n\r\n\r\nfunction Reload(){\r\n  if(!isDev)return <>  </>\r\n  const {t} = useTranslation(\"app-ui/components/page/content\")\r\n  return(\r\n    <Box>\r\n      <Button onClick={() => {window.location.reload()}}>{t(\"PageContent.refresh\")}</Button>\r\n      {new Date().toLocaleString()}\r\n    </Box>\r\n  )\r\n}\r\n\r\nconst ScrollP = createContext({ x: 0, y: 0 });\r\nlet index = 0;\r\nexport default function PageContent({ children, titleConf, reload }: {titleConf?:ITitleI18nConf, reload?: boolean} & PropsWithChildren) {\r\n  index++;\r\n  const scroll = useContext(ScrollP);\r\n  const clazz = `${Date.now() + Math.random() * Date.now()}`;\r\n  useEffect(()=>{\r\n    async function loadTitle(){\r\n      if(!titleConf)return\r\n      let title = titleConf.title\r\n      if(titleConf.ns){\r\n        title = await loadI18nValue(titleConf.ns, titleConf.key || \"content.title\")\r\n      }\r\n      if(!title)return\r\n      document.title = title\r\n    }\r\n    loadTitle()\r\n  }, [])\r\n  useEffect(() => {\r\n    const container = document.getElementsByClassName(clazz)[0];\r\n    if (!container) return;\r\n    container.scrollTop = scroll.y;\r\n    const onScroll = () => {\r\n      var scrollTop = container.scrollTop;\r\n      scroll.y = scrollTop;\r\n    };\r\n    container.removeEventListener('scroll', onScroll);\r\n    container.addEventListener('scroll', onScroll, { passive: true });\r\n    return () => container.removeEventListener('scroll', onScroll);\r\n  }, [clazz, scroll]);\r\n  return (\r\n\r\n    <Container className={clazz} sx={{ flexGrow: 1, overflow: 'auto', padding: \"0px\" }}>\r\n      <Box>\r\n        {(reload || (reload == undefined)) && <Reload />}\r\n        {children}\r\n      </Box>\r\n    </Container>\r\n  );\r\n}\r\n","import { PropsWithChildren } from \"react\";\r\nimport PageContent from \"./PageContent\";\r\nimport { ITitleI18nConf } from \".\";\r\nexport default function AndroidPageContent({ children, titleConf, reload }: {titleConf?:ITitleI18nConf, reload?: boolean} & PropsWithChildren)  {\r\n    return (\r\n        <PageContent titleConf={titleConf} reload={reload}>\r\n            {children}\r\n        </PageContent>\r\n    )\r\n}\r\n","import { Dispatcher } from \"@fanfanlo\"\r\nimport { DispatcherUnsubscribe } from \"@fanfanlo\"\r\n\r\nconst dipsatcher = new Dispatcher()\r\ninterface IStaticModel{\r\n    dipsatcher:Dispatcher\r\n    screenLockCount:number\r\n    switchPage:()=>void\r\n    listenSwitchPage:(callback:()=>void)=>DispatcherUnsubscribe \r\n}\r\nexport const staticModel:IStaticModel = {\r\n    dipsatcher,\r\n    screenLockCount:0,\r\n    switchPage:async()=>{\r\n        dipsatcher.dispatch(\"switchPage\")\r\n        staticModel.screenLockCount = 0\r\n    },\r\n    listenSwitchPage:(callback:()=>void)=>{\r\n        return dipsatcher.addListener(\"switchPage\",callback)\r\n    }\r\n}   \r\n","import { PropsWithChildren } from \"react\";\r\nimport { AnimatePresence, motion } from \"framer-motion\";\r\nimport { useRouter } from \"next/router\";\r\n\r\n\r\nexport function PageTransition({ children }: PropsWithChildren) {\r\n    const router = useRouter()\r\n    return (\r\n\r\n        <AnimatePresence mode=\"sync\">\r\n            <motion.div\r\n                key={router.route}\r\n                initial={{ opacity: 0, y: 10 }}\r\n                animate={{ opacity: 1, y: 0 }}\r\n                exit={{ opacity: 0, y: -110 }}\r\n                transition={{ duration: 0.3 }}\r\n            >\r\n                {children}\r\n            </motion.div>\r\n        </AnimatePresence>\r\n    )\r\n}","import { staticModel } from \"@app/static\";\r\nimport { Box } from \"@mui/material\";\r\nimport { useEffect } from \"react\";\r\nimport { PageTransition } from \"../motion\";\r\nlet idCount = 0\r\nexport function PageShell({children}:{children:React.ReactNode}){\r\n    const id = `app-shell-${idCount++}`\r\n    useEffect(()=>{\r\n        const box = document.querySelector(`#${id}`)\r\n        const unlisten = staticModel.listenSwitchPage(()=>{\r\n            if(!box)return\r\n        })\r\n        if(!box)return\r\n        box.addEventListener(\"click\",(e)=>{\r\n            if(staticModel.screenLockCount == 0)return\r\n            e.stopPropagation()\r\n            e.preventDefault()\r\n        })\r\n        return ()=>{\r\n            unlisten()\r\n        }\r\n    },[])\r\n    return (\r\n        <Box id={id}>\r\n            <PageTransition>\r\n                {children}  \r\n            </PageTransition>\r\n        </Box>\r\n    )\r\n}\r\n","import { AppBar, Box, Container, CssBaseline, Fab, Fade, Slide, Toolbar, Typography, useScrollTrigger } from \"@mui/material\";\r\nimport { PropsWithChildren, ReactNode } from \"react\";\r\n// import {AndroidPageContent} from \"../../\";\r\nimport { browserHistoryUtils, IDispatcher } from \"@fanfanlo\";\r\nimport KeyboardArrowLeft from '@mui/icons-material/KeyboardArrowLeft';\r\nimport KeyboardArrowUpIcon from '@mui/icons-material/KeyboardArrowUp';\r\nimport * as React from \"react\";\r\nimport { useRouter } from \"next/router\";\r\nimport { PageShell } from \"../app/PageShell\";\r\nimport shadows from \"@mui/material/styles/shadows\";\r\nimport AndroidPageContent from \"../page/AndroidPageContent\";\r\nimport { IAppBarBackAskEvent } from \"@app/static\";\r\nimport { ITitleI18nConf } from \"../page\";\r\ninterface Props {\r\n    /**\r\n     * Injected by the documentation to work in an iframe.\r\n     * You won't need it on your project.\r\n     */\r\n    window?: () => Window;\r\n    children?: React.ReactElement<unknown>;\r\n}\r\n\r\nfunction HideOnScroll(props: Props) {\r\n    const { children, window } = props;\r\n    // Note that you normally won't need to set the window ref as useScrollTrigger\r\n    // will default to window.\r\n    // This is only being set here because the demo is in an iframe.\r\n    const trigger = useScrollTrigger({\r\n        target: window ? window() : undefined,\r\n    });\r\n\r\n    return (\r\n        <Slide appear={false} direction=\"down\" in={!trigger}>\r\n            {children ?? <div />}\r\n        </Slide>\r\n    );\r\n}\r\nexport interface IAppbarProps extends PropsWithChildren {\r\n    title: ReactNode\r\n    back: boolean\r\n    backHandler?: () => boolean\r\n    backDispatcher?:IDispatcher\r\n    toolbar?:ReactNode\r\n    toolbarContent?:ReactNode\r\n}\r\nexport function Appbar({ title }: { title: ReactNode } & PropsWithChildren) {\r\n    return (\r\n\r\n        <AppBar color={\"inherit\"}>\r\n            <Toolbar>\r\n                <Typography variant=\"h6\" component=\"div\">\r\n                    {title}\r\n                </Typography>\r\n            </Toolbar>\r\n        </AppBar>\r\n    )\r\n}\r\n\r\ninterface IAppbarContainerProps extends PropsWithChildren {\r\n    appbarProps: IAppbarProps\r\n    titleConf?:ITitleI18nConf\r\n    reload?: boolean\r\n}\r\n\r\n// export interface IAppBarBackAskEvent{\r\n//     defaultPrevented:boolean\r\n// }\r\n\r\nfunction ScrollTop(props: Props) {\r\n    const { children, window } = props;\r\n    // Note that you normally won't need to set the window ref as useScrollTrigger\r\n    // will default to window.\r\n    // This is only being set here because the demo is in an iframe.\r\n    const trigger = useScrollTrigger({\r\n        target: window ? window() : undefined,\r\n        disableHysteresis: true,\r\n        threshold: 100,\r\n    });\r\n\r\n    const handleClick = (event: React.MouseEvent<HTMLDivElement>) => {\r\n        const anchor = (\r\n            (event.target as HTMLDivElement).ownerDocument || document\r\n        ).querySelector('#back-to-top-anchor');\r\n\r\n        if (anchor) {\r\n            anchor.scrollIntoView({\r\n                block: 'center',\r\n            });\r\n        }\r\n    };\r\n\r\n    return (\r\n        <Fade in={trigger}>\r\n            <Box data-id=\"content-scroll-top-button\"\r\n                onClick={handleClick}\r\n                role=\"presentation\"\r\n                sx={{ position: 'fixed', bottom: 16, right: 16 }}\r\n            >\r\n                {children}\r\n            </Box>\r\n        </Fade>\r\n    );\r\n}\r\nexport function AppbarContainer(props: IAppbarContainerProps) {\r\n    const { children, appbarProps, titleConf, reload } = props;\r\n    const router = useRouter()\r\n    function handleBack(){\r\n        // 本想抽象成底层一个方法，但是考虑了一下router需要注入或者是一个callback，似乎像现在这样判断一下event也可以。回头继续观察一下吧。\r\n        const event = browserHistoryUtils.askHistoryBack()\r\n        if(event.defaultPrevented)return\r\n        if(appbarProps.backDispatcher){\r\n            const e:IAppBarBackAskEvent = {defaultPrevented:false}\r\n            appbarProps.backDispatcher.dispatch('back',e)\r\n            if(e.defaultPrevented)return\r\n        }\r\n        router.back()\r\n    }\r\n    return (\r\n        <PageShell>\r\n        <React.Fragment>\r\n            <CssBaseline />\r\n            <HideOnScroll {...props}>\r\n                <AppBar color=\"inherit\">\r\n                    {appbarProps.toolbar ? \r\n                    appbarProps.toolbar:\r\n                    <Toolbar>\r\n                        <KeyboardArrowLeft onClick={handleBack} />\r\n                        {appbarProps.title}\r\n                    </Toolbar>\r\n                    }\r\n                </AppBar>\r\n            </HideOnScroll>\r\n            <Toolbar id=\"back-to-top-anchor\" />\r\n            <Container sx={{padding:\"0\", marginTop:\"17px\"}}>\r\n                <AndroidPageContent titleConf={titleConf} reload={reload}>\r\n                    {children}\r\n                </AndroidPageContent>\r\n            </Container>\r\n\r\n            <ScrollTop {...props}>\r\n                <Fab size=\"small\" aria-label=\"scroll back to top\">\r\n                    <KeyboardArrowUpIcon />\r\n                </Fab>\r\n            </ScrollTop>\r\n        </React.Fragment>\r\n        </PageShell>\r\n    );\r\n}\r\n"],"names":["useRouter","useEffect","useState","mainModel","matrixUser","matrixClient","Log","useProxyWatch","_","fileLogger","MeetingPageContent","logger","sub","router","roomId","callId","query","loginResponse","userData","userInfo","info","meetingUrl","setMeetingUrl","cancelled","buildUrl","elementCallUrl","appConfig","elementCall","url","userId","accessToken","homeserver","matrix","client","getUserId","getAccessToken","e","error","encodeURIComponent","window","location","href","device_id","warn","handleMessage","event","iframe","data","log","JSON","stringify","api","document","getElementById","resultData","cloneDeep","sendMessage","response","undefined","res","widgetId","requestId","action","versions","getVersions","supported_versions","age","name","console","contentWindow","postMessage","addEventListener","removeEventListener","div","style","width","height","position","h1","id","src","border","borderRadius","allow","title","AppbarContainer","AppShell","useTranslation","BasicSettingsPage","t","isReady","push","appbarProps","back"],"sourceRoot":"","ignoreList":[3]}