{"version":3,"file":"static/chunks/pages/im/room-f12457df96d0bfb5.js","mappings":"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","sources":["webpack://_N_E/../../../src/watcher/useWatchUpdates.tsx","webpack://_N_E/../../node_modules/.pnpm/react-i18next@15.1.4_i18next@24.1.0_typescript@5.8.2__react-dom@19.0.0_react@19.0.0__react@19.0.0/node_modules/react-i18next/dist/es/index.js","webpack://_N_E/../../../../src/components/app/AppShell.tsx","webpack://_N_E/./src/im/components/room/RoomHeader.tsx","webpack://_N_E/./src/im/components/messages/text/TextMessage.tsx","webpack://_N_E/./src/im/components/messages/location/LocationMessage.tsx","webpack://_N_E/./src/im/components/messages/invite/InviteMessage.tsx","webpack://_N_E/./src/im/components/messages/room/RoomNameMessage.tsx","webpack://_N_E/./src/im/components/messages/room/RoomHistoryVisibilityMessage.tsx","webpack://_N_E/./src/im/components/messages/room/RoomJoinRuleMessage.tsx","webpack://_N_E/./src/im/components/messages/room/RoomPowerLevelsMessage.tsx","webpack://_N_E/./src/im/components/messages/room/RoomGuestAccessMessage.tsx","webpack://_N_E/./src/im/components/messages/room/RoomTopicMessage.tsx","webpack://_N_E/./src/im/components/messages/room/RoomCreateMessage.tsx","webpack://_N_E/./src/im/components/messages/room/RoomAvatarMessage.tsx","webpack://_N_E/./src/im/components/messages/room/RoomCanonicalAliasMessage.tsx","webpack://_N_E/./src/im/components/messages/room/RoomTombstoneMessage.tsx","webpack://_N_E/./src/im/components/messages/room/RoomEncryptionMessage.tsx","webpack://_N_E/./src/im/components/messages/room/RoomServerAclMessage.tsx","webpack://_N_E/./src/im/components/messages/MessageRenderer.tsx","webpack://_N_E/./src/im/components/room/MessageItem.tsx","webpack://_N_E/./src/im/components/room/MessageList.tsx","webpack://_N_E/./src/im/client/message/handlers/location.ts","webpack://_N_E/../../../src/map/map.intf.ts","webpack://_N_E/../../../src/map/MapView.tsx","webpack://_N_E/./src/im/components/messages/location/LocationPicker.tsx","webpack://_N_E/./src/im/components/room/MessageInput.tsx","webpack://_N_E/../../node_modules/.pnpm/react-i18next@15.1.4_i18next@24.1.0_typescript@5.7.2__react-dom@19.0.0_react@19.0.0__react@19.0.0/node_modules/react-i18next/dist/es/index.js","webpack://_N_E/./src/im/components/room/MessageListScroller.tsx","webpack://_N_E/./src/im/components/room/RoomContent.tsx","webpack://_N_E/./src/im/components/room/RoomMembers.tsx","webpack://_N_E/./src/im/components/room/index.ts","webpack://_N_E/./src/im/client/message/handlers/loadHistory.ts","webpack://_N_E/./src/im/components/room/MessageListVirtuoso.tsx","webpack://_N_E/./src/im/components/room/RoomContent2.tsx","webpack://_N_E/./src/pages/im/room/index.tsx","webpack://_N_E/../../../../src/components/page/PageContent.tsx","webpack://_N_E/../../../../src/components/page/AndroidPageContent.tsx","webpack://_N_E/?768c","webpack://_N_E/../../../src/mc/static-model.ts","webpack://_N_E/../../../../src/components/motion/page-transition.tsx","webpack://_N_E/../../../../src/components/app/PageShell.tsx","webpack://_N_E/../../../../src/components/appbar/AppBar.tsx"],"sourcesContent":["import _ from \"lodash\"\r\nimport { useEffect, useState } from \"react\"\r\nimport { IWatchUpdatesConfig, watchUpdates } from \"./watchUpdates\"\r\nimport { PropertiesChain, toProxy } from \"./proxyWatch\"\r\nimport { useProxyWatch } from \"./useProxyWatch\"\r\nimport { objectCountUtils } from \"../utils\"\r\nimport { useWatch } from \"./UseWatch\"\r\nimport { Log } from \"../log\"\r\n\r\n/**\r\n * \r\n * 注意，返回的无论是object还是array，都无法监听，因为它们不是proxy，而是原始对象的副本\r\n * @param target 要监听的对象\r\n * @param conf 监听配置\r\n * @returns 监听的对象\r\n */\r\nexport function useWatchUpdates<T extends object>(target: T, conf?: IWatchUpdatesConfig<T>): [T] {\r\n    const [value, setValue] = useState<T>(target)\r\n    useEffect(() => {\r\n        console.log('use watch updates look look id', objectCountUtils.getObjectCount(target))\r\n        watchUpdates(target, (info) => {\r\n            console.log('uuuuuuuuuupdated', info)\r\n            console.log('tttttttarget=', target);\r\n            const now = _.isArray(info.target) ? [...info.target] : info.target\r\n            // setValue(now as T)\r\n            setValue((_.isArray(target) ? [...target] : { ...target }) as T)\r\n        }, conf)\r\n    }, [])\r\n    return [value as T]\r\n}\r\n\r\n/**\r\n * useProxyWatch + useWatchUpdates 结合体\r\n * 因为react的刷新机制，所以第二个state必须得用setState才会生效。\r\n * 不然其实这是两行代码，第一行是useProxyWatch，第二行是useWatchUpdates就可以了。\r\n * @param target 要监听的对象\r\n * @param propertyChain 要监听的属性链\r\n * @param defaultValue 默认值\r\n * @param conf 监听配置\r\n * @returns 监听的对象 返回的第一个参数是重新拼装的{...arr} or {...obj}，第二个参数是原始的target or defaultValue\r\n */\r\nexport function useProxyWatchUpdates<T extends object, U extends object>(target: T,\r\n    propertyChain: PropertiesChain<T>,\r\n    defaultValue: U,\r\n    conf?: IWatchUpdatesConfig<U>): [U, U] {\r\n        const logger = new Log(false, 'useProxyWatchUpdates_fn');\r\n        logger.pause = true;\r\n    const [v] = useProxyWatch(target, propertyChain, defaultValue)\r\n    const [value, setValue] = useState<U>(v);\r\n    logger.log(`propertyChain=`, propertyChain);\r\n    logger.log(`value=`, value);\r\n    logger.log('v=', v);\r\n    logger.log('defaultValue=', defaultValue)\r\n    useEffect(() => {\r\n        logger.log(`useEffect_fn v=`, v)\r\n        const newValue = _.isArray(v)\r\n            ? [...v]\r\n            : Object.assign({}, v);\r\n\r\n        setValue(newValue as U);\r\n        if(!v){\r\n            console.log('target=', target)\r\n            console.log('propertyChain=', propertyChain)\r\n            console.log('defaultValue=', defaultValue)\r\n            console.log('conf=', conf)\r\n            console.trace('v is null')\r\n            return;\r\n        }\r\n        return watchUpdates(v, (info) => {\r\n            logger.log('watchUpdates_fn', 'info=', info)\r\n            // setValue((_.isArray(v) ? [...v ] : {...v}) as U)\r\n            // 使用 Object.assign 来避免循环引用\r\n            const newValue = _.isArray(v)\r\n                ? [...v]\r\n                : Object.assign({}, v);\r\n\r\n            setValue(newValue as U);\r\n        }, conf)\r\n    }, [v])\r\n    return [value, v]\r\n}\r\n\r\n","export * from \"C:\\\\work\\\\android-droid\\\\html\\\\website-2024-12\\\\node_modules\\\\.pnpm\\\\react-i18next@15.1.4_i18next@24.1.0_typescript@5.8.2__react-dom@19.0.0_react@19.0.0__react@19.0.0\\\\node_modules\\\\react-i18next\\\\dist\\\\es\\\\index.js\"","'use client'\r\nimport { i18n, i18nInit, IPageScrollPosition, StorePageContext, StorePageDynamicContext, toProxy, watchUpdates, storeUtils } from \"@fanfanlo\";\r\nimport { useRouter } from \"next/router\";\r\nimport { PropsWithChildren, useEffect } from \"react\";\r\nimport { I18nextProvider } from \"react-i18next\";\r\n\r\n\r\ni18nInit()\r\n\r\nexport function AppShell({ children }: PropsWithChildren) {\r\n  const router = useRouter();\r\n  const scrollKey = 'scrollPositionInfo'\r\n  const href = window.location.href.split(\"#\")[0]\r\n  const dynamicKey = `dynamic-${href}`\r\n  const s = storeUtils.namespace(dynamicKey);\r\n  let o: Record<string, unknown>|undefined = s.read(dynamicKey)\r\n  if (!o) {\r\n    o = {}\r\n    s.write(dynamicKey, o)\r\n  }\r\n  o = toProxy(o)\r\n  useEffect(() => {\r\n\r\n    router.beforePopState((state) => {\r\n      s.clearAll()\r\n      return true\r\n    })\r\n  })\r\n  useEffect(() => {\r\n    s.write(dynamicKey, o)\r\n    return watchUpdates(o, () => {\r\n      s.write(dynamicKey, o)\r\n    })\r\n  }, [])\r\n  useEffect(() => {\r\n    const info = (s.read(scrollKey) || { x: 0, y: 0 }) as IPageScrollPosition\r\n    // console.log('app shell scroll info info = ', info)\r\n    if (info.x == 0 && info.y == 0) {\r\n      listenScroll()\r\n    } else {\r\n      window.requestAnimationFrame(() => {\r\n        window.scrollTo(info.x, info.y)\r\n        listenScroll()\r\n      })\r\n    }\r\n    function onScroll(e: Event) {\r\n      // console.log('app shell on scroll', { x: window.scrollX, y: window.scrollY })\r\n      s.write(scrollKey, { x: window.scrollX, y: window.scrollY })\r\n    }\r\n    function listenScroll() {\r\n      window.addEventListener('scroll', onScroll)\r\n    }\r\n\r\n    function unsub() {\r\n      window.removeEventListener('scroll', onScroll)\r\n    }\r\n    return unsub\r\n  });\r\n  return (\r\n    <StorePageContext value={s}>\r\n      <StorePageDynamicContext value={o}>\r\n\r\n        <I18nextProvider i18n={i18n}>\r\n          {children}\r\n        </I18nextProvider>\r\n      </StorePageDynamicContext>\r\n    </StorePageContext>\r\n  )\r\n}","import { AppBar, Toolbar, IconButton, Typography, Avatar, Box } from '@mui/material';\nimport MenuIcon from '@mui/icons-material/Menu';\nimport PeopleIcon from '@mui/icons-material/People';\nimport { useProxyWatchUpdates, useTranslation } from '@fanfanlo';\nimport { useProxyWatch } from '@fanfanlo';\nimport { matrixRoom } from '../../client/room';\nimport { useRouter } from 'next/router';\nimport KeyboardArrowLeft from '@mui/icons-material/KeyboardArrowLeft';\n\nexport interface RoomHeaderProps {\n  roomId: string;\n  showMembers: boolean;\n  onToggleMembers: () => void;\n}\n\nexport function RoomHeader({ roomId, showMembers, onToggleMembers }: RoomHeaderProps) {\n  const { t } = useTranslation('homepage/im/components/room/content');\n  const router = useRouter();\n  const [roomInfo] = useProxyWatchUpdates(\n    matrixRoom.roomData.joinedRoomsMap,\n    [roomId],\n    matrixRoom.roomData.joinedRoomsMap[roomId] || {}\n  );\n  function onOpenSettingsClick(){\n    router.push(`/im/room/room-settings?id=${roomId}`);\n  }\n  function handleBack(){\n    router.back()\n  }\n  return (\n    <AppBar position=\"static\" color=\"default\" elevation={1}>\n      <Toolbar>\n        <KeyboardArrowLeft onClick={handleBack} />\n        <Box sx={{ mr: 2 }}>\n          <Avatar src={roomInfo?.avatarUrl}>\n            {roomInfo?.name?.charAt(0) || 'R'}\n          </Avatar>\n        </Box>\n        <Typography\n          variant=\"h6\"\n          component=\"div\"\n          sx={{\n            flexGrow: 1,\n            minWidth: 0,\n            overflow: 'hidden',\n            textOverflow: 'ellipsis',\n            whiteSpace: 'nowrap',\n            mr: 2,\n          }}\n        >\n          {roomInfo?.name || t('RoomHeader.unnamedRoom')}\n        </Typography>\n        <IconButton\n          color={showMembers ? 'primary' : 'default'}\n          onClick={onOpenSettingsClick}\n          title={t('RoomHeader.toggleMembers')}\n        >\n          <PeopleIcon />\n        </IconButton>\n      </Toolbar>\n    </AppBar>\n  );\n}\n","import React from 'react';\nimport { ITextMessage } from '../../../client/message/types';\nimport { Box, Typography } from '@mui/material';\n\ninterface TextMessageProps {\n  message: ITextMessage;\n  className?: string;\n}\n\nexport const TextMessage = ({ message, className = '' }: TextMessageProps) => {\n  return (\n    <Box className={`text-message ${className}`}>\n      <Typography variant=\"body1\">\n        {message.content.body}\n      </Typography>\n    </Box>\n  );\n}\n","import React from 'react';\nimport { ILocationMessage } from '../../../client/message/types';\nimport { Box, Typography, Button, Dialog, DialogTitle, DialogContent, DialogActions } from '@mui/material';\nimport { useTranslation } from '@fanfanlo';\n\n\ninterface LocationMessageProps {\n  message: ILocationMessage;\n  className?: string;\n}\n\nexport const LocationMessage = ({ message, className = '' }: LocationMessageProps) => {\n  const { t } = useTranslation('homepage/im/components/messages/location/content');\n  // 从 geo_uri 中解析经纬度\n  const geoUri = message.content.geo_uri;\n  const [_, coordinates] = geoUri.split(':');\n  const [latitude, longitude] = coordinates.split(',').map(Number);\n  \n  // 构建静态地图 URL（使用百度地图）\n  const mapUrl = `https://api.map.baidu.com/staticimage/v2?ak=${process.env.REACT_APP_BAIDU_MAP_KEY || 'MmweUMZxcXOThZUaBuQ2rtKwLNHf1Hix'}&center=${longitude},${latitude}&zoom=12&width=300&height=200&markers=${longitude},${latitude}&markerStyles=m,B,0`;\n  \n  // 处理点击事件，打开交互式地图\n  const [open, setOpen] = React.useState(false);\n  const handleOpenMap = () => {\n    setOpen(true);\n  };\n\n  const handleClose = () => {\n    setOpen(false);\n  };\n  \n  return (\n    <Box className={`location-message ${className}`}>\n      <Box className=\"map-container\" mb={1}>\n        <img \n          src={mapUrl} \n          alt={message.content.info?.title || t('LocationMessage.title')} \n          onClick={handleOpenMap}\n          style={{ cursor: 'pointer' }}\n        />\n      </Box>\n      <Box display=\"flex\" justifyContent=\"space-between\" alignItems=\"center\">\n        <Typography variant=\"body2\" color=\"textSecondary\">\n          {message.content.info?.title || t('LocationMessage.title')}\n        </Typography>\n        <Button \n          variant=\"text\" \n          size=\"small\" \n          onClick={handleOpenMap}\n        >\n          {t('LocationMessage.viewMap')}\n        </Button>\n      </Box>\n      {open && (\n        <Dialog open={open} onClose={handleClose} maxWidth=\"sm\" fullWidth>\n          <DialogTitle>{message.content.info?.title || t('LocationMessage.title')}</DialogTitle>\n          <DialogContent>\n            <InteractiveLocationMap message={message} />\n          </DialogContent>\n          <DialogActions>\n            <Button onClick={handleClose} color=\"primary\">\n              {t('LocationMessage.close')}\n            </Button>\n          </DialogActions>\n        </Dialog>\n      )}\n    </Box>\n  );\n};\n\n// 在需要显示交互式地图的地方使用\nconst InteractiveLocationMap = React.forwardRef(({ message }: { message: ILocationMessage }, ref) => {\n  const [_, coordinates] = message.content.geo_uri.split(':');\n  const [latitude, longitude] = coordinates.split(',').map(Number);\n  \n  return (\n    <Box sx={{\n      width: '100%',\n      height: 400,\n      minHeight: 300,\n      position: 'relative'\n    }}>\n     \n    </Box>\n  );\n});\n\n","import React from 'react';\r\nimport { IMatrixMessage } from '../../../client/message/types';\r\n\r\ninterface InviteMessageProps {\r\n  message: IMatrixMessage;\r\n  className?: string;\r\n}\r\n\r\nexport const InviteMessage = ({ message, className = '' }: InviteMessageProps) => {\r\n  const inviter = message.sender;\r\n  const invitee = message.content.displayname || '';\r\n  const membership = message.content.membership;\r\n\r\n  if (membership === 'invite') {\r\n    return (\r\n      <div\r\n        className={`invite-message ${className}`}\r\n        style={{\r\n          color: '#fff',\r\n          background: '#1976d2',\r\n          borderRadius: 6,\r\n          padding: '8px 12px',\r\n          fontWeight: 500,\r\n          display: 'inline-block',\r\n          maxWidth: '100%',\r\n        }}\r\n      >\r\n        {inviter\r\n          ? `${inviter} 邀请了 ${invitee || '你'} 加入群聊`\r\n          : `你被邀请加入群聊`}\r\n      </div>\r\n    );\r\n  }\r\n  if (membership === 'join') {\r\n    return (\r\n      <div\r\n        className={`invite-message ${className}`}\r\n        style={{\r\n          color: '#fff',\r\n          background: '#388e3c',\r\n          borderRadius: 6,\r\n          padding: '8px 12px',\r\n          fontWeight: 500,\r\n          display: 'inline-block',\r\n          maxWidth: '100%',\r\n        }}\r\n      >\r\n        {invitee\r\n          ? `${invitee} 已接受邀请加入群聊`\r\n          : `有成员已接受邀请加入群聊`}\r\n      </div>\r\n    );\r\n  }\r\n  // 兜底\r\n  return null;\r\n}; ","import React from 'react';\r\nimport { IMatrixMessage } from '../../../client/message/types';\r\n\r\ninterface RoomNameMessageProps {\r\n  message: IMatrixMessage;\r\n  className?: string;\r\n}\r\n\r\nexport const RoomNameMessage = ({ message, className = '' }: RoomNameMessageProps) => {\r\n  const sender = message.sender;\r\n  const name = message.content.name;\r\n  return (\r\n    <div className={`room-name-message ${className}`} style={{ color: '#ffa000', padding: '8px 0' }}>\r\n      {sender ? `${sender} 修改了房间名称为「${name}」` : `房间名称被修改为「${name}」`}\r\n    </div>\r\n  );\r\n}; ","import React from 'react';\r\nimport { IMatrixMessage } from '../../../client/message/types';\r\n\r\ninterface RoomHistoryVisibilityMessageProps {\r\n  message: IMatrixMessage;\r\n  className?: string;\r\n}\r\n\r\nconst visibilityMap: Record<string, string> = {\r\n  shared: '所有成员可见',\r\n  invited: '仅被邀请成员可见',\r\n  joined: '仅加入后可见',\r\n  world_readable: '所有人可见',\r\n};\r\n\r\nexport const RoomHistoryVisibilityMessage = ({ message, className = '' }: RoomHistoryVisibilityMessageProps) => {\r\n  const sender = message.sender;\r\n  const visibility = message.content.history_visibility;\r\n  const text = visibilityMap[visibility] || visibility;\r\n  return (\r\n    <div className={`room-history-visibility-message ${className}`} style={{ color: '#8e24aa', padding: '8px 0' }}>\r\n      {sender ? `${sender} 修改了房间历史可见性为「${text}」` : `房间历史可见性被修改为「${text}」`}\r\n    </div>\r\n  );\r\n}; ","import React from 'react';\r\nimport { IMatrixMessage } from '../../../client/message/types';\r\n\r\ninterface RoomJoinRuleMessageProps {\r\n  message: IMatrixMessage;\r\n  className?: string;\r\n}\r\n\r\nconst joinRuleMap: Record<string, string> = {\r\n  invite: '仅邀请可加入',\r\n  public: '公开房间',\r\n  knock: '敲门加入',\r\n  restricted: '受限加入',\r\n};\r\n\r\nexport const RoomJoinRuleMessage = ({ message, className = '' }: RoomJoinRuleMessageProps) => {\r\n  const sender = message.sender;\r\n  const joinRule = message.content.join_rule;\r\n  const text = joinRuleMap[joinRule] || joinRule;\r\n  return (\r\n    <div\r\n      className={`room-join-rule-message ${className}`}\r\n      style={{\r\n        color: '#fff',\r\n        background: '#0288d1',\r\n        borderRadius: 6,\r\n        padding: '8px 12px',\r\n        fontWeight: 500,\r\n        display: 'inline-block',\r\n        maxWidth: '100%',\r\n      }}\r\n    >\r\n      {sender ? `${sender} 修改了房间加群规则为「${text}」` : `房间加群规则被修改为「${text}」`}\r\n    </div>\r\n  );\r\n}; ","import React from 'react';\r\nimport { IMatrixMessage } from '../../../client/message/types';\r\n\r\ninterface RoomPowerLevelsMessageProps {\r\n  message: IMatrixMessage;\r\n  className?: string;\r\n}\r\n\r\nexport const RoomPowerLevelsMessage = ({ message, className = '' }: RoomPowerLevelsMessageProps) => {\r\n  const sender = message.sender;\r\n  return (\r\n    <div className={`room-power-levels-message ${className}`} style={{ color: '#c62828', padding: '8px 0' }}>\r\n      {sender ? `${sender} 修改了房间权限设置` : `房间权限设置被修改`}\r\n    </div>\r\n  );\r\n}; ","import React from 'react';\r\nimport { IMatrixMessage } from '../../../client/message/types';\r\n\r\ninterface RoomGuestAccessMessageProps {\r\n  message: IMatrixMessage;\r\n  className?: string;\r\n}\r\n\r\nconst guestAccessMap: Record<string, string> = {\r\n  can_join: '允许访客加入',\r\n  forbidden: '禁止访客加入',\r\n};\r\n\r\nexport const RoomGuestAccessMessage = ({ message, className = '' }: RoomGuestAccessMessageProps) => {\r\n  const sender = message.sender;\r\n  const guestAccess = message.content.guest_access;\r\n  const text = guestAccessMap[guestAccess] || guestAccess;\r\n  return (\r\n    <div className={`room-guest-access-message ${className}`} style={{ color: '#43a047', padding: '8px 0' }}>\r\n      {sender ? `${sender} 修改了访客访问权限为「${text}」` : `访客访问权限被修改为「${text}」`}\r\n    </div>\r\n  );\r\n}; ","import React from 'react';\r\nimport { IMatrixMessage } from '../../../client/message/types';\r\n\r\ninterface RoomTopicMessageProps {\r\n  message: IMatrixMessage;\r\n  className?: string;\r\n}\r\n\r\nexport const RoomTopicMessage = ({ message, className = '' }: RoomTopicMessageProps) => {\r\n  const sender = message.sender;\r\n  const topic = message.content.topic;\r\n  return (\r\n    <div className={`room-topic-message ${className}`} style={{ color: '#6d4c41', padding: '8px 0' }}>\r\n      {sender ? `${sender} 修改了房间话题为「${topic}」` : `房间话题被修改为「${topic}」`}\r\n    </div>\r\n  );\r\n}; ","import React from 'react';\r\nimport { IMatrixMessage } from '../../../client/message/types';\r\n\r\ninterface RoomCreateMessageProps {\r\n  message: IMatrixMessage;\r\n  className?: string;\r\n}\r\n\r\nexport const RoomCreateMessage = ({ message, className = '' }: RoomCreateMessageProps) => {\r\n  const sender = message.content.creator;\r\n  const version = message.content.room_version;\r\n  return (\r\n    <div\r\n      className={`room-create-message ${className}`}\r\n      style={{\r\n        color: '#fff',\r\n        background: '#1976d2',\r\n        borderRadius: 6,\r\n        padding: '8px 12px',\r\n        fontWeight: 500,\r\n        display: 'inline-block',\r\n        maxWidth: '100%',\r\n      }}\r\n    >\r\n      {sender ? `${sender} 创建了房间（版本 ${version}）` : `房间已创建（版本 ${version}）`}\r\n    </div>\r\n  );\r\n}; ","import React from 'react';\r\nimport { IMatrixMessage } from '../../../client/message/types';\r\n\r\ninterface RoomAvatarMessageProps {\r\n  message: IMatrixMessage;\r\n  className?: string;\r\n}\r\n\r\nexport const RoomAvatarMessage = ({ message, className = '' }: RoomAvatarMessageProps) => {\r\n  const sender = message.sender;\r\n  return (\r\n    <div className={`room-avatar-message ${className}`} style={{ color: '#8e24aa', padding: '8px 0' }}>\r\n      {sender ? `${sender} 修改了房间头像` : `房间头像已修改`}\r\n    </div>\r\n  );\r\n}; ","import React from 'react';\r\nimport { IMatrixMessage } from '../../../client/message/types';\r\n\r\ninterface RoomCanonicalAliasMessageProps {\r\n  message: IMatrixMessage;\r\n  className?: string;\r\n}\r\n\r\nexport const RoomCanonicalAliasMessage = ({ message, className = '' }: RoomCanonicalAliasMessageProps) => {\r\n  const sender = message.sender;\r\n  const alias = message.content.canonical_alias;\r\n  return (\r\n    <div className={`room-canonical-alias-message ${className}`} style={{ color: '#0097a7', padding: '8px 0' }}>\r\n      {sender ? `${sender} 修改了房间主别名为「${alias}」` : `房间主别名被修改为「${alias}」`}\r\n    </div>\r\n  );\r\n}; ","import React from 'react';\r\nimport { IMatrixMessage } from '../../../client/message/types';\r\n\r\ninterface RoomTombstoneMessageProps {\r\n  message: IMatrixMessage;\r\n  className?: string;\r\n}\r\n\r\nexport const RoomTombstoneMessage = ({ message, className = '' }: RoomTombstoneMessageProps) => {\r\n  const replacement = message.content.replacement_room;\r\n  return (\r\n    <div className={`room-tombstone-message ${className}`} style={{ color: '#bdbdbd', padding: '8px 0' }}>\r\n      房间已废弃，迁移至 {replacement ? `「${replacement}」` : '新房间'}\r\n    </div>\r\n  );\r\n}; ","import React from 'react';\r\nimport { IMatrixMessage } from '../../../client/message/types';\r\n\r\ninterface RoomEncryptionMessageProps {\r\n  message: IMatrixMessage;\r\n  className?: string;\r\n}\r\n\r\nexport const RoomEncryptionMessage = ({ message, className = '' }: RoomEncryptionMessageProps) => {\r\n  return (\r\n    <div className={`room-encryption-message ${className}`} style={{ color: '#388e3c', padding: '8px 0' }}>\r\n      已启用端到端加密\r\n    </div>\r\n  );\r\n}; ","import React from 'react';\r\nimport { IMatrixMessage } from '../../../client/message/types';\r\n\r\ninterface RoomServerAclMessageProps {\r\n  message: IMatrixMessage;\r\n  className?: string;\r\n}\r\n\r\nexport const RoomServerAclMessage = ({ message, className = '' }: RoomServerAclMessageProps) => {\r\n  return (\r\n    <div className={`room-server-acl-message ${className}`} style={{ color: '#ffb300', padding: '8px 0' }}>\r\n      房间服务器访问控制已变更\r\n    </div>\r\n  );\r\n}; ","import React from 'react';\nimport { IMatrixMessage } from '../../client/message/types';\nimport { TextMessage } from './text/TextMessage';\nimport { LocationMessage } from './location/LocationMessage';\nimport { messageUtils } from '../../client/message/messageUtils';\nimport { InviteMessage } from './invite/InviteMessage';\nimport { RoomNameMessage } from './room/RoomNameMessage';\nimport { RoomHistoryVisibilityMessage } from './room/RoomHistoryVisibilityMessage';\nimport { RoomJoinRuleMessage } from './room/RoomJoinRuleMessage';\nimport { RoomPowerLevelsMessage } from './room/RoomPowerLevelsMessage';\nimport { RoomGuestAccessMessage } from './room/RoomGuestAccessMessage';\nimport { RoomTopicMessage } from './room/RoomTopicMessage';\nimport { RoomCreateMessage } from './room/RoomCreateMessage';\nimport { RoomAvatarMessage } from './room/RoomAvatarMessage';\nimport { RoomCanonicalAliasMessage } from './room/RoomCanonicalAliasMessage';\nimport { RoomTombstoneMessage } from './room/RoomTombstoneMessage';\nimport { RoomEncryptionMessage } from './room/RoomEncryptionMessage';\nimport { RoomServerAclMessage } from './room/RoomServerAclMessage';\n\ninterface MessageRendererProps {\n  message: IMatrixMessage;\n  className?: string;\n}\n\nexport const MessageRenderer = ({ \n  message, \n  className = '' \n}: MessageRendererProps) => {\n  const commonProps = {\n    message,\n    className\n  };\n\n  // 房间加群规则\n  if (message.content && message.content.join_rule) {\n    return <RoomJoinRuleMessage key={message.event_id} {...commonProps} message={message} />;\n  }\n\n  // 房间权限设置\n  if (message.content && (\n    message.content.events_default !== undefined ||\n    message.content.users !== undefined ||\n    message.content.ban !== undefined ||\n    message.content.kick !== undefined ||\n    message.content.redact !== undefined\n  )) {\n    return <RoomPowerLevelsMessage key={message.event_id} {...commonProps} message={message} />;\n  }\n\n  // 访客访问权限\n  if (message.content && message.content.guest_access) {\n    return <RoomGuestAccessMessage key={message.event_id} {...commonProps} message={message} />;\n  }\n\n  // 房间话题\n  if (message.content && message.content.topic) {\n    return <RoomTopicMessage key={message.event_id} {...commonProps} message={message} />;\n  }\n\n  // 房间历史可见性变更\n  if (message.content && message.content.history_visibility) {\n    return <RoomHistoryVisibilityMessage key={message.event_id} {...commonProps} message={message} />;\n  }\n\n  // 房间名称变更\n  if (message.content && message.content.name) {\n    return <RoomNameMessage key={message.event_id} {...commonProps} message={message} />;\n  }\n\n  // 邀请和接受邀请类型\n  if (message.content && (message.content.membership === 'invite' || message.content.membership === 'join')) {\n    return <InviteMessage key={message.event_id} {...commonProps} message={message} />;\n  }\n\n  // 房间创建\n  if (message.content && message.content.room_version && message.content.creator) {\n    return <RoomCreateMessage key={message.event_id} {...commonProps} message={message} />;\n  }\n\n  // 房间头像\n  if (message.content && message.content.avatar_url) {\n    return <RoomAvatarMessage key={message.event_id} {...commonProps} message={message} />;\n  }\n\n  // 房间主别名\n  if (message.content && message.content.canonical_alias) {\n    return <RoomCanonicalAliasMessage key={message.event_id} {...commonProps} message={message} />;\n  }\n\n  // 房间废弃/迁移\n  if (message.content && message.content.replacement_room) {\n    return <RoomTombstoneMessage key={message.event_id} {...commonProps} message={message} />;\n  }\n\n  // 启用加密\n  if (message.content && message.content.algorithm) {\n    return <RoomEncryptionMessage key={message.event_id} {...commonProps} message={message} />;\n  }\n\n  // 服务器访问控制\n  if (message.content && (message.content.allow || message.content.deny)) {\n    return <RoomServerAclMessage key={message.event_id} {...commonProps} message={message} />;\n  }\n\n  if (messageUtils.isTextMessage(message)) {\n    return <TextMessage key={message.event_id} {...commonProps} message={message} />;\n  }\n\n  if (messageUtils.isLocationMessage(message)) {\n    return <LocationMessage key={message.event_id} {...commonProps} message={message} />;\n  }\n  \n  // 其他消息类型的处理...\n  console.log('unknown message=', message);\n  console.log('json message=', JSON.stringify(message));\n  return <div className={`unknown-message ${className}`}>\n    不支持的消息类型: {message.content.msgtype}\n  </div>;\n};\n","import { Box, Typography, Avatar } from '@mui/material';\r\nimport { MessageRenderer } from '../messages/MessageRenderer';\r\nimport { Log } from '@fanfanlo';\r\nimport { IMatrixMessage } from '@src/im/client';\r\nimport { roomData } from '@src/im/client/room/data';\r\nconst fileLogger = new Log(false, 'im.components.room.MessageItem');\r\n// fileLogger.childrenPaused = true;\r\n// fileLogger.pause = true;\r\ninterface MessageItemProps {\r\n  message: IMatrixMessage;\r\n  currentUserId: string;\r\n}\r\n\r\nexport function MessageItem({ message, currentUserId }: MessageItemProps) {\r\n  const logger = fileLogger.sub(false, 'MessageItem_ui');\r\n  logger.pause = true;\r\n  logger.log('message=', message);\r\n  logger.log('currentUserId=', currentUserId);\r\n\r\n  // 获取成员信息\r\n  let memberInfo = undefined;\r\n  if (message.room_id && message.sender !== currentUserId) {\r\n    const members = roomData.roomMembers[message.room_id] || [];\r\n    memberInfo = members.find(m => m.userId === message.sender);\r\n  }\r\n\r\n  const isSelf = message.sender === currentUserId;\r\n\r\n  if (isSelf) {\r\n    // 自己的消息，右对齐，无头像无昵称\r\n    return (\r\n      <Box\r\n        sx={{\r\n          display: 'flex',\r\n          justifyContent: 'flex-end',\r\n          pb: 2\r\n        }}\r\n      >\r\n        <Box\r\n          sx={{\r\n            maxWidth: '80%',\r\n            bgcolor: 'primary.main',\r\n            color: 'primary.contrastText',\r\n            p: 2,\r\n            borderRadius: 2,\r\n            boxShadow: 1,\r\n            position: 'relative',\r\n            wordBreak: 'break-word',\r\n            display: 'flex',\r\n            flexDirection: 'column',\r\n          }}\r\n        >\r\n          <MessageRenderer \r\n            message={message} \r\n            className={'sent-message'}\r\n          />\r\n          <Typography \r\n            variant=\"caption\" \r\n            sx={{ \r\n              display: 'block',\r\n              textAlign: 'right',\r\n              mt: 0.5,\r\n              opacity: 0.7,\r\n              color: 'primary.contrastText'\r\n            }}\r\n          >\r\n            {new Date(message.origin_server_ts).toLocaleTimeString()}\r\n          </Typography>\r\n        </Box>\r\n      </Box>\r\n    );\r\n  }\r\n\r\n  // 别人的消息，左侧头像，右侧昵称+消息气泡纵向排列\r\n  return (\r\n    <Box\r\n      sx={{\r\n        display: 'flex',\r\n        justifyContent: 'flex-start',\r\n        alignItems: 'flex-start',\r\n        pb: 2\r\n      }}\r\n    >\r\n      <Avatar\r\n        src={memberInfo?.avatarUrl}\r\n        alt={memberInfo?.displayName || message.sender}\r\n        sx={{ width: 32, height: 32, mr: 1, mt: 0.5 }}\r\n      >\r\n        {(memberInfo?.displayName || message.sender)?.charAt(0) || '?'}\r\n      </Avatar>\r\n      <Box sx={{ display: 'flex', flexDirection: 'column', alignItems: 'flex-start', maxWidth: '80%' }}>\r\n        <Typography\r\n          variant=\"caption\"\r\n          sx={{\r\n            fontSize: '0.75rem',\r\n            color: 'text.secondary',\r\n            maxWidth: 160,\r\n            textAlign: 'left',\r\n            overflow: 'hidden',\r\n            textOverflow: 'ellipsis',\r\n            whiteSpace: 'nowrap',\r\n            lineHeight: 1.2,\r\n            mb: 0.5,\r\n          }}\r\n          title={memberInfo?.displayName || message.sender}\r\n        >\r\n          {memberInfo?.displayName || message.sender}\r\n        </Typography>\r\n        <Box\r\n          sx={{\r\n            bgcolor: 'background.paper',\r\n            color: 'text.primary',\r\n            p: 2,\r\n            borderRadius: 2,\r\n            boxShadow: 1,\r\n            position: 'relative',\r\n            wordBreak: 'break-word',\r\n            maxWidth: '100%',\r\n            display: 'flex',\r\n            flexDirection: 'column',\r\n          }}\r\n        >\r\n          <MessageRenderer \r\n            message={message} \r\n            className={'received-message'}\r\n          />\r\n          <Typography \r\n            variant=\"caption\" \r\n            sx={{ \r\n              display: 'block',\r\n              textAlign: 'right',\r\n              mt: 0.5,\r\n              opacity: 0.7,\r\n              color: 'text.secondary'\r\n            }}\r\n          >\r\n            {new Date(message.origin_server_ts).toLocaleTimeString()}\r\n          </Typography>\r\n        </Box>\r\n      </Box>\r\n    </Box>\r\n  );\r\n}","import { Log, useProxyWatch, useProxyWatchUpdates, useTranslation } from '@fanfanlo';\r\nimport { Box, CircularProgress, Typography } from '@mui/material';\r\nimport { useEffect, useRef, useState, useLayoutEffect } from 'react';\r\nimport { IMatrixMessage, matrixRoom } from '../../client/room';\r\nimport { matrixUser } from '../../client/user';\r\nimport { MessageItem } from './MessageItem';\r\nconst fileLogger = new Log(false, 'im.components.room.MessageList')\r\n// fileLogger.childrenPaused = true;\r\n// fileLogger.pause = true;\r\ninterface MessageListProps {\r\n  roomId: string;\r\n}\r\n\r\nexport function MessageList({ roomId }: MessageListProps) {\r\n  const logger = fileLogger.sub(false, 'MessageList_ui');\r\n  logger.pause = true;\r\n  const messagesEndRef = useRef<HTMLDivElement>(null);\r\n  const messagesContainerRef = useRef<HTMLDivElement>(null);\r\n  const [autoScroll, setAutoScroll] = useState(true);\r\n  const wasAtBottomRef = useRef(true);\r\n  const userAtBottomRef = useRef(true);\r\n  const userReallyAtBottomRef = useRef(true);\r\n  const { t } = useTranslation('homepage/im/components/room/content');\r\n  const DISTANCE_TO_BOTTOM = 5; // px\r\n  const prevMessageCountRef = useRef(0);\r\n\r\n  // 判断是否接近底部\r\n  function isNearBottom(distance = DISTANCE_TO_BOTTOM) {\r\n    if (!messagesContainerRef.current) return false;\r\n    const { scrollTop, scrollHeight, clientHeight } = messagesContainerRef.current;\r\n    return scrollHeight - scrollTop - clientHeight <= distance;\r\n  }\r\n  \r\n  // 监听登录状态\r\n  const [loginResponse] = useProxyWatch(\r\n    matrixUser.userData,\r\n    'userInfo.loginResponse',\r\n    matrixUser.userData.userInfo.loginResponse\r\n  );\r\n  \r\n  // 监听消息列表\r\n  const [messageIds] = useProxyWatchUpdates(\r\n    matrixRoom.roomData.messages,\r\n    [`${roomId}`],\r\n    matrixRoom.roomData.messages[roomId] || []\r\n  );\r\n  const messagesMap = matrixRoom.roomData.messagesMap;\r\n  // 获取消息详情并转换为 IMatrixMessage 格式\r\n  const messageList = messageIds?.map(id => {\r\n    const message = messagesMap[id];\r\n    if (!message) {\r\n      console.warn('Message not found:', id);\r\n      return null;\r\n    }\r\n    \r\n    // 转换为 IMatrixMessage 格式\r\n    const res:IMatrixMessage = {\r\n      event_id: message.event_id,\r\n      type: message.content.msgtype,\r\n      sender: message.sender,\r\n      origin_server_ts: message.origin_server_ts,\r\n      room_id: roomId,\r\n      content: message.content,\r\n    };\r\n    return res;\r\n  }).filter((item)=>{return item !== null}) || [];\r\n\r\n  // 滚动到底部\r\n  const scrollToBottom = () => {\r\n    console.log('[MessageList] scrollToBottom exec', {\r\n      messagesEndRef: messagesEndRef.current,\r\n      messagesContainerRef: messagesContainerRef.current,\r\n      scrollTop: messagesContainerRef.current?.scrollTop,\r\n      scrollHeight: messagesContainerRef.current?.scrollHeight,\r\n    });\r\n    if (messagesEndRef.current) {\r\n      messagesEndRef.current.scrollIntoView({ behavior: 'smooth' });\r\n    }\r\n  };\r\n\r\n  // 只在用户主动滚动时更新\"物理底部\"状态\r\n  const handleScroll = () => {\r\n    const atBottom = isNearBottom();\r\n    userReallyAtBottomRef.current = atBottom;\r\n    console.log('[MessageList] handleScroll, atBottom:', atBottom, 'autoScroll:', autoScroll);\r\n    setAutoScroll(atBottom);\r\n  };\r\n\r\n  // 新消息到来前，记录\"是否在底部\"\r\n  useLayoutEffect(() => {\r\n    wasAtBottomRef.current = userReallyAtBottomRef.current;\r\n    console.log('[MessageList] useLayoutEffect([messageList]), wasAtBottomRef.current:', wasAtBottomRef.current);\r\n  }, [messageList]);\r\n\r\n  // 渲染后，决定是否滚动到底\r\n  useEffect(() => {\r\n    console.log('[MessageList] useEffect([messageList, autoScroll]), wasAtBottomRef.current:', wasAtBottomRef.current, 'autoScroll:', autoScroll, 'messageList.length:', messageList.length);\r\n    if (wasAtBottomRef.current && autoScroll) {\r\n      setTimeout(() => {\r\n        scrollToBottom();\r\n      }, 0);\r\n    }\r\n  }, [messageList, autoScroll]);\r\n\r\n  // 首次加载消息时强制滚动到底部\r\n  useEffect(() => {\r\n    if (prevMessageCountRef.current === 0 && messageList.length > 0) {\r\n      setTimeout(() => {\r\n        scrollToBottom();\r\n      }, 0);\r\n    }\r\n    prevMessageCountRef.current = messageList.length;\r\n  }, [messageList]);\r\n\r\n  // 初始化时，autoScroll 设为 true\r\n  useEffect(() => {\r\n    setAutoScroll(true);\r\n  }, [roomId]);\r\n\r\n  return (\r\n    <Box id=\"messagesContainer\"\r\n      ref={messagesContainerRef}\r\n      onScroll={handleScroll}\r\n      sx={{\r\n        height: '100%',\r\n        flex: 1,\r\n        overflowY: 'auto',\r\n        p: 2,\r\n        display: 'flex',\r\n        flexDirection: 'column',\r\n        gap: 2\r\n      }}\r\n    >\r\n      {!loginResponse?.user_id ? (\r\n        <Box display=\"flex\" justifyContent=\"center\" alignItems=\"center\" height=\"100%\">\r\n          <CircularProgress />\r\n        </Box>\r\n      ) : messageList.length === 0 ? (\r\n        <Box display=\"flex\" justifyContent=\"center\" alignItems=\"center\" height=\"100%\">\r\n          <Typography variant=\"body1\" color=\"text.secondary\">\r\n            {t('MessageList.noMessages')}\r\n          </Typography>\r\n        </Box>\r\n      ) : (\r\n        messageList.map((message) => (\r\n          <MessageItem \r\n            key={message.event_id}\r\n            message={message}\r\n            currentUserId={loginResponse.user_id}\r\n          />\r\n        ))\r\n      )}\r\n      <div ref={messagesEndRef} />\r\n    </Box>\r\n  );\r\n}\r\n","import { IMatrixMessage, ILocationMessage, ILocationContent } from '../types';\nimport { roomData } from '../../room/data';\nimport { Log } from '@fanfanlo';\nimport { matrixClient } from '../../client';\n\nconst logger = new Log(false, 'im.client.message.handlers.location');\n\n// 内部辅助函数\nfunction addToLocalCache(roomId: string, message: IMatrixMessage) {\n  roomData.messagesMap[message.id] = message;\n  \n  if (!roomData.messages[roomId]) {\n    roomData.messages[roomId] = [];\n  }\n  roomData.messages[roomId].push(message.id);\n}\n\nfunction updateMessageStatus(messageId: string, updates: Partial<IMatrixMessage>) {\n  const message = roomData.messagesMap[messageId];\n  if (message) {\n    roomData.messagesMap[messageId] = {\n      ...message,\n      ...updates\n    };\n  }\n}\n\n// 导出所有内容\nexport const locationMessageUtils = {\n  // 创建位置消息内容\n  createLocationContent: (\n    latitude: number,\n    longitude: number,\n    title: string = '',\n    description: string = ''\n  ): ILocationContent => ({\n    msgtype: 'm.location',\n    body: title || `位置: ${latitude}, ${longitude}`,\n    geo_uri: `geo:${latitude},${longitude}`,\n    info: {\n      title,\n      description\n    }\n  }),\n\n  // 发送位置消息\n  send: async (\n    roomId: string,\n    latitude: number,\n    longitude: number,\n    title: string = '',\n    description: string = ''\n  ): Promise<string> => {\n    const content = locationMessageUtils.createLocationContent(latitude, longitude, title, description);\n    const tempId = `temp_${Date.now()}`;\n    \n    const message: ILocationMessage = {\n      id: tempId,\n      type: 'm.location',\n      sender: matrixClient.client?.getUserId() || '',\n      timestamp: Date.now(),\n      roomId,\n      content,\n      status: 'sending'\n    };\n\n    addToLocalCache(roomId, message);\n\n    if (!matrixClient.client) {\n      logger.error('Matrix client is not initialized');\n      throw new Error('Matrix client is not initialized');\n    }\n\n    try {\n      const eventId = await matrixClient.client.sendMessage(roomId, {\n        msgtype: 'm.location',\n        body: content.body,\n        geo_uri: content.geo_uri,\n        info: content.info\n      });\n\n      updateMessageStatus(tempId, {\n        id: eventId,\n        status: 'sent'\n      });\n\n      return eventId;\n    } catch (error) {\n      logger.error('Failed to send location message:', error);\n      updateMessageStatus(tempId, {\n        status: 'failed',\n        error: error instanceof Error ? error.message : 'Unknown error'\n      });\n      throw error;\n    }\n  },\n\n  // 处理接收到的位置消息\n  handleReceived: (roomId: string, event: any): ILocationMessage => {\n    const message: ILocationMessage = {\n      id: event.event_id,\n      type: 'm.location',\n      sender: event.sender,\n      timestamp: event.origin_server_ts,\n      roomId,\n      content: {\n        msgtype: 'm.location',\n        body: event.content.body,\n        geo_uri: event.content.geo_uri,\n        info: event.content.info\n      },\n      status: 'received'\n    };\n\n    addToLocalCache(roomId, message);\n    return message;\n  }\n};","export enum MapProvider {\r\n  Baidu = 'baidu',\r\n  Google = 'google',\r\n  Amap = 'amap'\r\n}\r\n\r\n// 位置坐标类型\r\nexport interface Location {\r\n    lng: number;\r\n    lat: number;\r\n    accuracy?: number;\r\n    timestamp?: number;\r\n  }\r\n  \r\n  // 地图定位选项类型\r\n  export interface MapWatchOptions {\r\n    enableHighAccuracy?: boolean;\r\n    timeout?: number;\r\n    maximumAge?: number;\r\n  }\r\n  \r\n  // MapView 组件属性类型\r\n  export interface MapProps extends React.HTMLAttributes<HTMLDivElement> {\r\n    provider?: MapProvider;\r\n    center?: Location;\r\n    zoom?: number;\r\n    style?: React.CSSProperties;\r\n    onDeviceLocationUpdate?: (location: Location) => void;\r\n    onLocationError?: (error: any) => void;\r\n    watchPosition?: boolean;\r\n    watchOptions?: MapWatchOptions;\r\n    onCenterChange?: (location: Location) => void;\r\n  }","// MapView.tsx\nimport React, { useEffect, useRef, useState } from 'react';\nimport dynamic from 'next/dynamic';\nimport { Location, MapProps, MapWatchOptions, MapProvider } from './map.intf';\n\n\n// 默认配置\n// const defaultCenter = { lng: 116.402544, lat: 39.928216 };\n// const defaultZoom = 10;\n// const defaultWatchOptions = {\n//   enableHighAccuracy: true,\n//   timeout: 5000,\n//   maximumAge: 0\n// };\n\n// // 使用 dynamic 导入地图组件，并禁用 SSR\n// const MapWithLoader = dynamic<MapProps>(\n//   () => import('react-bmapgl').then((mod) => {\n//     const { Map, MapApiLoaderHOC } = mod;\n    \n//     // 创建一个函数式组件\n//     const MapComponent: React.FC<MapProps> = (props) => {\n//       const {\n//         center = defaultCenter,\n//         zoom = defaultZoom,\n//         onLocationUpdate,\n//         onLocationError,\n//         watchPosition = false,\n//         watchOptions = defaultWatchOptions,\n//         onCenterChange,\n//         ...restProps\n//       } = props;\n      \n//       const mapRef = useRef<any>(null);\n//       const geolocationRef = useRef<any>(null);\n//       const watchIdRef = useRef<number | null>(null);\n//       // 新增：本地中心点state\n//       const [currentCenter, setCurrentCenter] = useState<Location>(center);\n//       const [hasLocated, setHasLocated] = useState(false);\n\n//       // 只在初次定位后设置地图中心\n//       useEffect(() => {\n//         console.log('hasLocated=',hasLocated);\n//         console.log('navigator.geolocation=',navigator.geolocation);\n//         if (!hasLocated && navigator.geolocation) {\n//           navigator.geolocation.getCurrentPosition(\n//             (pos) => {\n//               const location = {\n//                 lng: pos.coords.longitude,\n//                 lat: pos.coords.latitude,\n//                 accuracy: pos.coords.accuracy,\n//                 timestamp: pos.timestamp || Date.now()\n//               };\n//               console.log('location=',location);\n//               setCurrentCenter(location);\n//               setHasLocated(true);\n//               onLocationUpdate?.(location);\n//             },\n//             (err) => {\n//               setHasLocated(true); // 不再尝试\n//               onLocationError?.(err);\n//             }\n//           );\n//         }\n//       }, [hasLocated, onLocationUpdate, onLocationError]);\n\n//       // 获取当前位置（仅watchPosition时回调，不再设置中心）\n//       const getCurrentPosition = () => {\n//         if (!geolocationRef.current) return;\n//         geolocationRef.current.getCurrentPosition(\n//           (position: any) => {\n//             if (position?.point) {\n//               const location = {\n//                 lng: position.point.lng,\n//                 lat: position.point.lat,\n//                 accuracy: position.accuracy,\n//                 timestamp: position.timestamp || Date.now()\n//               };\n//               onLocationUpdate?.(location);\n//             }\n//           },\n//           (error: any) => {\n//             onLocationError?.(error);\n//           },\n//           watchOptions\n//         );\n//       };\n\n//       // 监听位置变化（只回调，不设置中心）\n//       const startWatchingPosition = () => {\n//         if (!geolocationRef.current || !watchPosition) return;\n//         getCurrentPosition();\n//         watchIdRef.current = window.setInterval(() => {\n//           getCurrentPosition();\n//         }, watchOptions.timeout || 5000);\n//       };\n//       const stopWatchingPosition = () => {\n//         if (watchIdRef.current) {\n//           clearInterval(watchIdRef.current);\n//           watchIdRef.current = null;\n//         }\n//       };\n\n//       // 初始化地图和地理位置\n//       const initMap = (map: any) => {\n//         if (!map) return;\n//         mapRef.current = map;\n//         try {\n//           geolocationRef.current = new BMapGL.Geolocation();\n//           // 修正：获取真实地图实例\n//           const realMap = map.map || map.instance;\n//           if (realMap) {\n//             if (realMap.enableScrollWheelZoom) realMap.enableScrollWheelZoom(true);\n//             if (realMap.enableContinuousZoom) realMap.enableContinuousZoom();\n//             if (realMap.enableInertialDragging) realMap.enableInertialDragging();\n//           }\n//           if (onCenterChange) {\n//             (realMap || map).addEventListener('moveend', () => {\n//               const c = (realMap || map).getCenter();\n//               console.log('c=',c);\n//               onCenterChange({ lng: c.lng, lat: c.lat });\n//             });\n//           }\n//           if (watchPosition) {\n//             startWatchingPosition();\n//           }\n//         } catch (error) {\n//           onLocationError?.(error);\n//         }\n//       };\n\n//       useEffect(() => {\n//         return () => {\n//           stopWatchingPosition();\n//         };\n//       }, []);\n//       useEffect(() => {\n//         if (watchPosition) {\n//           startWatchingPosition();\n//         } else {\n//           stopWatchingPosition();\n//         }\n//         return () => {\n//           stopWatchingPosition();\n//         };\n//       }, [watchPosition]);\n\n//       return (\n//         <Map\n//           ref={initMap}\n//           style={{ height: '100%', width: '100%', ...restProps.style }}\n//           center={new BMapGL.Point(currentCenter.lng, currentCenter.lat)}\n//           zoom={zoom}\n//           {...restProps}\n//         />\n//       );\n//     };\n\n//     // 使用类型断言来避免类型错误\n//     return MapApiLoaderHOC({\n//       ak: 'MmweUMZxcXOThZUaBuQ2rtKwLNHf1Hix'\n//     })(MapComponent as any) as any;\n//   }), \n//   { \n//     ssr: false,\n//     loading: () => (\n//       <div style={{ \n//         height: '100%', \n//         width: '100%', \n//         display: 'flex', \n//         alignItems: 'center', \n//         justifyContent: 'center',\n//         backgroundColor: '#f5f5f5',\n//         color: '#666'\n//       }}>\n//         地图加载中...\n//       </div>\n//     )\n//   }\n// );\n\n// 动态导入各地图实现\nconst BaiduMapView = dynamic(() => import('./BaiduMapView').then(m => m.BaiduMapView), { ssr: false });\nconst GoogleMapView = dynamic(() => import('./GoogleMapView').then(m => m.GoogleMapView), { ssr: false });\nconst AmapMapView = dynamic(() => import('./AmapMapView').then(m => m.AmapMapView), { ssr: false });\n\nexport const MapView: React.FC<MapProps> = (props) => {\n  const { provider = MapProvider.Baidu, ...rest } = props;\n  if (provider === MapProvider.Google) {\n    return <GoogleMapView {...rest} />;\n  }\n  if (provider === MapProvider.Amap) {\n    return <AmapMapView {...rest} />;\n  }\n  return <BaiduMapView {...rest} />;\n};\n","import React, { useState, useCallback } from 'react';\nimport { \n  Dialog, \n  DialogTitle, \n  DialogContent, \n  DialogActions, \n  Button, \n  TextField,\n  Box,\n  CircularProgress,\n  Typography\n} from '@mui/material';\nimport { LocationOn as LocationIcon } from '@mui/icons-material';\nimport { useTranslation, MapView, MapProvider } from '@fanfanlo';\n\nexport interface LocationInfo {\n  latitude: number;\n  longitude: number;\n  title: string;\n  description: string;\n}\n\ninterface LocationPickerProps {\n  open: boolean;\n  onClose: () => void;\n  onConfirm: (location: LocationInfo) => void;\n  provider?: MapProvider;\n}\n\nexport const LocationPicker = ({ \n  open, \n  onClose, \n  onConfirm,\n  provider = MapProvider.Baidu\n}: LocationPickerProps) => {\n  const { t } = useTranslation('homepage/im/components/messages/location/content');\n  const [title, setTitle] = useState('');\n  const [description, setDescription] = useState('');\n  const [isLoading, setIsLoading] = useState(false);\n  const [currentLocation, setCurrentLocation] = useState<{ lat: number; lng: number } | null>(null);\n  const [permissionDialogOpen, setPermissionDialogOpen] = useState(false);\n  const [permissionDeniedDialogOpen, setPermissionDeniedDialogOpen] = useState(false);\n\n  const handleGetCurrentLocation = useCallback(() => {\n    if (!navigator.geolocation) {\n      alert(t('LocationPicker.geolocationNotSupported'));\n      return;\n    }\n    console.log('Checking geolocation permissions...');\n    // 优先检测权限\n    if (navigator.permissions) {\n      navigator.permissions.query({ name: 'geolocation' }).then((result) => {\n        console.log('Permission state:', result.state);\n        if (result.state === 'granted') {\n          console.log('Permission granted, getting location...');\n          doGetLocation();\n        } else if (result.state === 'prompt') {\n          console.log('Permission prompt, showing dialog...');\n          setPermissionDialogOpen(true); // 确保这里被调用\n        } else if (result.state === 'denied') {\n          console.log('Permission denied, showing denied dialog...');\n          setPermissionDeniedDialogOpen(true);\n        }\n      }).catch((error) => {\n        console.error('Error checking permissions:', error);\n        // 兼容异常，直接尝试\n        doGetLocation();\n      });\n    } else {\n      console.log('Permissions API not supported, attempting to get location...');\n      // 兼容老浏览器\n      doGetLocation();\n    }\n  }, [t]);\n\n  const doGetLocation = () => {\n    setIsLoading(true);\n    navigator.geolocation.getCurrentPosition(\n      (position) => {\n        setCurrentLocation({\n          lat: position.coords.latitude,\n          lng: position.coords.longitude\n        });\n        setIsLoading(false);\n      },\n      (error) => {\n        if (error.code === error.PERMISSION_DENIED) {\n          setPermissionDeniedDialogOpen(true);\n        } else if (error.code === error.POSITION_UNAVAILABLE) {\n          alert(t('LocationPicker.locationUnavailable'));\n        } else if (error.code === error.TIMEOUT) {\n          alert(t('LocationPicker.locationTimeout'));\n        } else {\n          alert(t('LocationPicker.getLocationFailed'));\n        }\n        setIsLoading(false);\n      },\n      {\n        enableHighAccuracy: true,\n        timeout: 10000,\n        maximumAge: 0\n      }\n    );\n  };\n\n  const handleSubmit = () => {\n    if (!currentLocation) return;\n    \n    onConfirm({\n      latitude: currentLocation.lat,\n      longitude: currentLocation.lng,\n      title: title || t('LocationPicker.myLocation'),\n      description\n    });\n    \n    // 重置表单\n    setTitle('');\n    setDescription('');\n    setCurrentLocation(null);\n    onClose();\n  };\n\n  return (\n    <>\n      <Dialog\n        open={open}\n        onClose={onClose}\n        maxWidth=\"sm\"\n        fullWidth\n        PaperProps={{\n          sx: {\n            minHeight: 600,\n            height: '100%'\n          }\n        }}\n      >\n        <DialogTitle>{t('LocationPicker.shareLocation')}</DialogTitle>\n        <DialogContent\n          sx={{\n            height: '100%',\n            display: 'flex',\n            flexDirection: 'column'\n          }}\n        >\n          <Box sx={{ width: '100%', height: '100%', mb: 3, position: 'relative' }}>\n          <MapView \n            style={{ height: '500px', width: '100%' }}\n            watchPosition={true}\n            provider={provider}\n            onDeviceLocationUpdate={(location) => {\n              // 设备物理位置变化\n              console.log('设备位置更新:', location);\n            }}\n            onCenterChange={(location) => {\n              // 地图中心变化\n              console.log('地图中心更新:', location);\n            }}\n            onLocationError={(error) => {\n              console.error('位置获取错误:', error);\n            }}\n          />\n          </Box>\n          <Box sx={{ mt: 2, mb: 3 }}>\n            <Button\n              variant=\"contained\"\n              startIcon={<LocationIcon />}\n              onClick={handleGetCurrentLocation}\n              disabled={isLoading}\n            >\n              {isLoading ? (\n                <CircularProgress size={24} />\n              ) : (\n                t('LocationPicker.getCurrentLocation')\n              )}\n            </Button>\n          </Box>\n\n          {currentLocation && (\n            <Box sx={{ mt: 2, mb: 3 }}>\n              <TextField\n                fullWidth\n                label={t('LocationPicker.title')}\n                value={title}\n                onChange={(e) => setTitle(e.target.value)}\n                margin=\"normal\"\n              />\n              <TextField\n                fullWidth\n                label={t('LocationPicker.description')}\n                value={description}\n                onChange={(e) => setDescription(e.target.value)}\n                margin=\"normal\"\n                placeholder={t('LocationPicker.descriptionPlaceholder')}\n              />\n              \n              <Box sx={{ mt: 2, p: 2, border: '1px solid #eee', borderRadius: 1 }}>\n                <Typography variant=\"subtitle2\" gutterBottom>\n                  {t('LocationPicker.preview')}\n                </Typography>\n                <Typography variant=\"body2\" color=\"text.secondary\">\n                  {t('LocationPicker.latitude')}: {currentLocation.lat.toFixed(6)}\n                  <br />\n                  {t('LocationPicker.longitude')}: {currentLocation.lng.toFixed(6)}\n                </Typography>\n              </Box>\n            </Box>\n          )}\n        </DialogContent>\n        <DialogActions>\n          <Button onClick={onClose}>{t('LocationPicker.cancel')}</Button>\n          <Button \n            onClick={handleSubmit} \n            variant=\"contained\" \n            disabled={!currentLocation}\n          >\n            {t('LocationPicker.send')}\n          </Button>\n        </DialogActions>\n      </Dialog>\n      {/* 权限申请说明弹窗 */}\n      <Dialog open={permissionDialogOpen} onClose={() => setPermissionDialogOpen(false)}>\n        <DialogTitle>{t('LocationPicker.shareLocation')}</DialogTitle>\n        <DialogContent>\n          <Typography>{t('LocationPicker.permissionPrompt')}</Typography>\n        </DialogContent>\n        <DialogActions>\n          <Button onClick={() => setPermissionDialogOpen(false)}>{t('LocationPicker.cancel')}</Button>\n          <Button\n            onClick={() => {\n              setPermissionDialogOpen(false);\n              doGetLocation();\n            }}\n            variant=\"contained\"\n          >\n            {t('LocationPicker.getCurrentLocation')}\n          </Button>\n        </DialogActions>\n      </Dialog>\n      {/* 权限被拒绝弹窗 */}\n      <Dialog open={permissionDeniedDialogOpen} onClose={() => setPermissionDeniedDialogOpen(false)}>\n        <DialogTitle>{t('LocationPicker.shareLocation')}</DialogTitle>\n        <DialogContent>\n          <Typography color=\"error\">{t('LocationPicker.permissionDenied')}</Typography>\n        </DialogContent>\n        <DialogActions>\n          <Button onClick={() => setPermissionDeniedDialogOpen(false)}>{t('LocationPicker.cancel')}</Button>\n        </DialogActions>\n      </Dialog>\n    </>\n  );\n};\n","import { useState, useRef, KeyboardEvent } from 'react';\nimport { \n  Box, \n  TextField, \n  IconButton, \n  InputAdornment,\n  Tooltip\n} from '@mui/material';\nimport { \n  Send as SendIcon, \n  LocationOn as LocationIcon,\n  AttachFile as AttachFileIcon,\n  EmojiEmotions as EmojiIcon \n} from '@mui/icons-material';\nimport { useTranslation } from '@fanfanlo';\nimport { matrixClient } from '../../client';\nimport { locationMessageUtils } from '../../client/message/handlers/location';\nimport { LocationPicker } from '../messages/location/LocationPicker';\n\ninterface MessageInputProps {\n  roomId: string;\n}\n\nexport function MessageInput({ roomId }: MessageInputProps) {\n  const { t } = useTranslation('homepage/im/components/room/content');\n  const [message, setMessage] = useState('');\n  const [locationPickerOpen, setLocationPickerOpen] = useState(false);\n  const fileInputRef = useRef<HTMLInputElement>(null);\n  const textareaRef = useRef<HTMLTextAreaElement>(null);\n\n  const sendMessage = async () => {\n    if (!message.trim()) return;\n    \n    try {\n      await matrixClient.client.sendTextMessage(roomId, message.trim());\n      setMessage('');\n      // 保持焦点在输入框\n      textareaRef.current?.focus();\n    } catch (error) {\n      console.error('发送消息失败:', error);\n    }\n  };\n\n  const handleLocationConfirm = async (location: { \n    latitude: number; \n    longitude: number; \n    title: string;\n    description: string;\n  }) => {\n    try {\n      await locationMessageUtils.send(\n        roomId,\n        location.latitude,\n        location.longitude,\n        location.title,\n        location.description\n      );\n    } catch (error) {\n      console.error('发送位置消息失败:', error);\n    }\n  };\n\n  const handleFileChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0];\n    if (file) {\n      // 处理文件上传\n      console.log('Selected file:', file);\n      // TODO: 实现文件上传逻辑\n    }\n  };\n\n  const handleKeyDown = (e: KeyboardEvent<HTMLDivElement>) => {\n    if (e.key === 'Enter' && !e.shiftKey) {\n      e.preventDefault();\n      sendMessage();\n    }\n  };\n\n  return (\n    <Box sx={{ p: 2, borderTop: '1px solid', borderColor: 'divider' }}>\n      <Box sx={{ display: 'flex', alignItems: 'flex-end' }}>\n        <Tooltip title={t('MessageInput.attachFile')}>\n          <IconButton onClick={() => fileInputRef.current?.click()}>\n            <AttachFileIcon />\n            <input\n              type=\"file\"\n              ref={fileInputRef}\n              onChange={handleFileChange}\n              style={{ display: 'none' }}\n            />\n          </IconButton>\n        </Tooltip>\n        \n        <Tooltip title={t('MessageInput.emoji')}>\n          <IconButton>\n            <EmojiIcon />\n          </IconButton>\n        </Tooltip>\n        \n        <TextField\n          fullWidth\n          multiline\n          maxRows={4}\n          variant=\"outlined\"\n          placeholder={t('MessageInput.placeholder')}\n          value={message}\n          onChange={(e) => setMessage(e.target.value)}\n          onKeyDown={handleKeyDown}\n          inputRef={textareaRef}\n          sx={{ mx: 1 }}\n          InputProps={{\n            sx: { borderRadius: 4, pr: 1 },\n            endAdornment: (\n              <InputAdornment position=\"end\">\n                <Tooltip \n                  title={t('MessageInput.sendLocation')} \n                  disableFocusListener \n                  disableHoverListener\n                >\n                  <IconButton\n                    onClick={() => setLocationPickerOpen(true)}\n                    edge=\"end\"\n                    sx={{ mr: 0.5 }}\n                  >\n                    <LocationIcon color=\"primary\" />\n                  </IconButton>\n                </Tooltip>\n              </InputAdornment>\n            ),\n          }}\n        />\n        \n        <Tooltip \n          title={t('MessageInput.send')}\n        >\n          <span>\n            <IconButton \n              color=\"primary\" \n              onClick={sendMessage}\n              disabled={!message.trim()}\n              sx={{ alignSelf: 'flex-end', mb: 0.5 }}\n            >\n              <SendIcon />\n            </IconButton>\n          </span>\n        </Tooltip>\n      </Box>\n\n      <LocationPicker\n        open={locationPickerOpen}\n        onClose={() => setLocationPickerOpen(false)}\n        onConfirm={handleLocationConfirm}\n      />\n    </Box>\n  );\n}\n","export * from \"C:\\\\work\\\\android-droid\\\\html\\\\website-2024-12\\\\node_modules\\\\.pnpm\\\\react-i18next@15.1.4_i18next@24.1.0_typescript@5.7.2__react-dom@19.0.0_react@19.0.0__react@19.0.0\\\\node_modules\\\\react-i18next\\\\dist\\\\es\\\\index.js\"","import React, {\n  forwardRef,\n  useRef,\n  useState,\n  useCallback,\n  useEffect,\n  useImperativeHandle,\n  type ReactNode,\n  type CSSProperties,\n} from 'react';\nimport { Box, Fade, CircularProgress, Button, Badge } from '@mui/material';\nimport { useTranslation } from 'react-i18next';\n\ninterface ScrollInfo {\n  scrollTop: number;\n  scrollHeight: number;\n  clientHeight: number;\n  distanceFromBottom: number;\n  isAtTop: boolean;\n  isAtBottom: boolean;\n  timestamp: number;\n}\n\nexport interface MessageListScrollerRef {\n  scrollToBottom: (behavior?: ScrollBehavior) => void;\n  scrollToTop: (behavior?: ScrollBehavior) => void;\n  scrollToPosition: (position: number) => void;\n  getScrollPosition: () => number;\n  loadOlderMessages: () => Promise<void>;\n  loadNewerMessages: () => Promise<void>;\n}\n\nexport interface MessageListScrollerProps {\n  children: ReactNode;\n  onLoadMore?: () => Promise<void>;\n  onLoadNewer?: () => Promise<void>;\n  hasMore: boolean;\n  hasNewer: boolean;\n  loading: boolean;\n  loadingNewer: boolean;\n  className?: string;\n  style?: CSSProperties;\n  roomId: string;\n}\n\nconst SCROLL_THRESHOLD = 100;\nconst SCROLL_DEBOUNCE_MS = 150;\n\ntype ScrollDirection = 'up' | 'down' | null;\n\nconst MessageListScroller = forwardRef<MessageListScrollerRef, MessageListScrollerProps>((\n  {\n    children,\n    onLoadMore = async () => {},\n    onLoadNewer = async () => {},\n    hasMore = false,\n    hasNewer = false,\n    loading = false,\n    loadingNewer = false,\n    className = '',\n    style = {},\n    roomId,\n  },\n  ref\n) => {\n  const { t } = useTranslation('homepage/im/components/room/content');\n  const listRef = useRef<HTMLDivElement>(null);\n  const debounceTimerRef = useRef<NodeJS.Timeout>();\n  const scrollTimeoutRef = useRef<NodeJS.Timeout>();\n  const isAtBottomRef = useRef(true);\n  const scrollDirectionRef = useRef<ScrollDirection>(null);\n  // 使用对象存储滚动位置和时间戳，以便更好地控制滚动行为\n  const lastScrollTopRef = useRef<{ scrollTop: number; time?: number }>({ scrollTop: 0 });\n  const isLoadingOlderRef = useRef(false);\n  const isLoadingNewerRef = useRef(false);\n  const isInitialLoadRef = useRef(true);\n  const isProgrammaticScrollRef = useRef(false);\n  const scrollAnimationFrameRef = useRef<number>();\n\n  const [showScrollToBottom, setShowScrollToBottom] = useState(false);\n  const [newMessageCount, setNewMessageCount] = useState(0);\n\n  // 更新滚动信息\n  const updateScrollInfo = useCallback((el: HTMLDivElement): ScrollInfo | null => {\n    if (!el) return null;\n    \n    const { scrollTop, scrollHeight, clientHeight } = el;\n    const distanceFromBottom = scrollHeight - scrollTop - clientHeight;\n    // 调整顶部检测阈值，确保更容易触发加载\n    const isAtTop = scrollTop <= SCROLL_THRESHOLD * 1.5;\n    const isAtBottom = distanceFromBottom <= SCROLL_THRESHOLD;\n    \n    // 更新滚动方向（仅当滚动位置变化超过阈值时）\n    const SCROLL_THRESHOLD_PX = 1; // 1px threshold to reduce noise\n    const scrollDiff = scrollTop - lastScrollTopRef.current.scrollTop;\n    \n    if (Math.abs(scrollDiff) > SCROLL_THRESHOLD_PX) {\n      scrollDirectionRef.current = scrollDiff > 0 ? 'down' : 'up';\n      lastScrollTopRef.current = { ...lastScrollTopRef.current, scrollTop };\n      \n      console.log('Scroll direction updated:', {\n        direction: scrollDirectionRef.current,\n        scrollTop,\n        lastScrollTop: lastScrollTopRef.current.scrollTop,\n        diff: scrollDiff\n      });\n    }\n    \n    // 更新是否在底部的引用\n    isAtBottomRef.current = isAtBottom;\n    \n    return {\n      scrollTop,\n      scrollHeight,\n      clientHeight,\n      distanceFromBottom,\n      isAtTop,\n      isAtBottom,\n      timestamp: Date.now(),\n    };\n  }, []);\n\n  // 滚动到底部\n  const scrollToBottom = useCallback((behavior: ScrollBehavior = 'smooth') => {\n    const list = listRef.current;\n    if (!list) return;\n    \n    // 如果已经在底部，不需要滚动\n    const { scrollTop, scrollHeight, clientHeight } = list;\n    const isAtBottom = scrollHeight - (scrollTop + clientHeight) < 10;\n    if (isAtBottom) {\n      isAtBottomRef.current = true;\n      setShowScrollToBottom(false);\n      setNewMessageCount(0);\n      return;\n    }\n    \n    // 设置程序化滚动标志\n    isProgrammaticScrollRef.current = true;\n    \n    // 直接设置scrollTop而不是使用scrollTo可以避免触发scroll事件\n    list.scrollTop = list.scrollHeight;\n    \n    // 更新UI状态\n    isAtBottomRef.current = true;\n    setShowScrollToBottom(false);\n    setNewMessageCount(0);\n    \n    // 使用requestAnimationFrame确保DOM更新后重置标志\n    requestAnimationFrame(() => {\n      // 再次检查是否真的滚动到了底部\n      if (list) {\n        const { scrollTop, scrollHeight, clientHeight } = list;\n        isAtBottomRef.current = scrollHeight - (scrollTop + clientHeight) < 10;\n      }\n      // 延迟重置标志，防止滚动事件干扰\n      setTimeout(() => {\n        isProgrammaticScrollRef.current = false;\n      }, 100);\n    });\n  }, []);\n\n  // 滚动到顶部\n  const scrollToTop = useCallback((behavior: ScrollBehavior = 'smooth') => {\n    if (listRef.current) {\n      listRef.current.scrollTo({\n        top: 0,\n        behavior,\n      });\n    }\n  }, []);\n\n  // 滚动到指定位置\n  const scrollToPosition = useCallback((position: number) => {\n    if (listRef.current) {\n      listRef.current.scrollTop = position;\n    }\n  }, []);\n\n  // 获取滚动位置\n  const getScrollPosition = useCallback((): number => {\n    return listRef.current?.scrollTop || 0;\n  }, []);\n\n  // 加载更多历史消息\n  const loadOlderMessages = useCallback(async () => {\n    console.log('loadOlderMessages called');\n    if (!hasMore || loading || isLoadingOlderRef.current) {\n      console.log('Skipping loadOlderMessages:', { hasMore, loading, isLoadingOlder: isLoadingOlderRef.current });\n      return;\n    }\n    \n    console.log('Loading older messages...');\n    isLoadingOlderRef.current = true;\n    const list = listRef.current;\n    if (!list) {\n      console.log('No list element');\n      isLoadingOlderRef.current = false;\n      return;\n    }\n\n    // 保存当前滚动位置和内容高度\n    const scrollTop = list.scrollTop;\n    const scrollHeight = list.scrollHeight;\n    const isAtTop = scrollTop <= SCROLL_THRESHOLD;\n    const firstChild = list.firstElementChild as HTMLElement;\n    const firstChildOffset = firstChild ? firstChild.offsetTop : 0;\n    \n    console.log('Before load:', { scrollTop, scrollHeight, isAtTop, firstChildOffset });\n\n    try {\n      // 设置程序化滚动标志，防止滚动事件干扰\n      isProgrammaticScrollRef.current = true;\n      \n      // 加载更多消息\n      await onLoadMore();\n      \n      // 使用 requestAnimationFrame 确保 DOM 已更新\n      requestAnimationFrame(() => {\n        if (!list) return;\n        \n        const newScrollHeight = list.scrollHeight;\n        const heightDiff = newScrollHeight - scrollHeight;\n        console.log('After load:', { newScrollHeight, heightDiff });\n        \n        // 保持滚动位置\n        if (isAtTop && heightDiff > 0) {\n          console.log('Restoring scroll position:', { newPosition: heightDiff + scrollTop });\n          \n          // 方法1：使用新的滚动位置\n          list.scrollTop = heightDiff + scrollTop;\n          \n          // 方法2：使用第一个子元素的位置（备用）\n          if (firstChild) {\n            const newFirstChild = list.firstElementChild as HTMLElement;\n            if (newFirstChild) {\n              setTimeout(() => {\n                const newPosition = newFirstChild.offsetTop - firstChildOffset + scrollTop;\n                console.log('Alternative scroll position:', newPosition);\n                list.scrollTop = newPosition;\n              }, 0);\n            }\n          }\n        }\n        \n        // 重置程序化滚动标志\n        setTimeout(() => {\n          isProgrammaticScrollRef.current = false;\n        }, 100);\n      });\n    } catch (error) {\n      console.error('Failed to load older messages:', error);\n      isProgrammaticScrollRef.current = false;\n    } finally {\n      console.log('Finished loading older messages');\n      isLoadingOlderRef.current = false;\n    }\n  }, [hasMore, loading, onLoadMore]);\n\n  // 加载更新消息\n  const loadNewerMessages = useCallback(async () => {\n    console.log('loadNewerMessages called');\n    if (!hasNewer || loadingNewer || isLoadingNewerRef.current) return;\n    \n    isLoadingNewerRef.current = true;\n    const list = listRef.current;\n    if (!list) {\n      isLoadingNewerRef.current = false;\n      return;\n    }\n\n    const wasAtBottom = isAtBottomRef.current;\n\n    try {\n      await onLoadNewer();\n\n      // 检查是否仍然在底部\n      setTimeout(() => {\n        if (!list) return;\n        \n        const { scrollTop, scrollHeight, clientHeight } = list;\n        const isStillAtBottom = scrollHeight - (scrollTop + clientHeight) <= SCROLL_THRESHOLD;\n\n        if (wasAtBottom && isStillAtBottom) {\n          scrollToBottom('smooth');\n        } else if (!wasAtBottom) {\n          setNewMessageCount(prev => prev + 1);\n        }\n      }, 100);\n    } catch (error) {\n      console.error('Failed to load newer messages:', error);\n    } finally {\n      isLoadingNewerRef.current = false;\n    }\n  }, [hasNewer, loadingNewer, onLoadNewer, scrollToBottom]);\n\n  // 处理滚动事件\n  const handleScroll = useCallback((e: React.UIEvent<HTMLDivElement>) => {\n    const el = e.currentTarget;\n    if (!el) return;\n\n    // 如果是程序化滚动，不处理滚动逻辑\n    if (isProgrammaticScrollRef.current) {\n      console.log('Programmatic scroll, skipping scroll handling');\n      return;\n    }\n\n    // 清除之前的防抖定时器\n    if (debounceTimerRef.current) {\n      clearTimeout(debounceTimerRef.current);\n    }\n\n    // 立即更新滚动位置\n    const currentScrollTop = el.scrollTop;\n    const currentTime = Date.now();\n    \n    // 更新滚动方向\n    const scrollDiff = currentScrollTop - lastScrollTopRef.current.scrollTop;\n    if (Math.abs(scrollDiff) > 1) { // 1px threshold\n      scrollDirectionRef.current = scrollDiff > 0 ? 'down' : 'up';\n    }\n    \n    // 更新滚动位置和时间戳\n    lastScrollTopRef.current = {\n      scrollTop: currentScrollTop,\n      time: currentTime\n    };\n    \n    console.log('Scroll event:', {\n      scrollTop: currentScrollTop,\n      direction: scrollDirectionRef.current,\n      isProgrammatic: isProgrammaticScrollRef.current\n    });\n\n    // 设置防抖处理\n    debounceTimerRef.current = setTimeout(() => {\n      const scrollInfo = updateScrollInfo(el);\n      if (!scrollInfo) return;\n\n      const { isAtTop, isAtBottom, scrollTop, scrollHeight, clientHeight } = scrollInfo;\n      \n      console.log('Scroll info:', { \n        isAtTop, \n        isAtBottom, \n        scrollTop, \n        scrollHeight, \n        clientHeight, \n        direction: scrollDirectionRef.current,\n        isProgrammatic: isProgrammaticScrollRef.current\n      });\n      \n      // 更新UI状态\n      setShowScrollToBottom(!isAtBottom);\n      isAtBottomRef.current = isAtBottom;\n\n      // 记录滚动状态\n      console.log('Scroll state:', {\n        isAtTop,\n        isAtBottom,\n        hasMore,\n        hasNewer,\n        loading,\n        loadingNewer,\n        scrollDirection: scrollDirectionRef.current,\n        isProgrammatic: isProgrammaticScrollRef.current\n      });\n      \n      // 只在用户滚动时触发加载\n      if (!isProgrammaticScrollRef.current) {\n        // 滚动到顶部加载更多\n        if (isAtTop && hasMore && !loading && scrollDirectionRef.current === 'up') {\n          console.log('Loading older messages...');\n          loadOlderMessages().catch(error => {\n            console.error('Error loading older messages:', error);\n            // 确保加载状态被重置\n            isLoadingOlderRef.current = false;\n          });\n        }\n        // 滚动到底部加载更新\n        else if (isAtBottom && hasNewer && !loadingNewer && scrollDirectionRef.current === 'down') {\n          console.log('Loading newer messages...');\n          loadNewerMessages().catch(error => {\n            console.error('Error loading newer messages:', error);\n            // 确保加载状态被重置\n            isLoadingNewerRef.current = false;\n          });\n        }\n      }\n    }, SCROLL_DEBOUNCE_MS);\n  }, [hasMore, hasNewer, loading, loadingNewer, loadOlderMessages, loadNewerMessages, updateScrollInfo]);\n\n  // 初始滚动到底部\n  useEffect(() => {\n    if (isInitialLoadRef.current && listRef.current) {\n      isInitialLoadRef.current = false;\n      \n      console.log('Initial load, scrolling to bottom...');\n      \n      // 使用 setTimeout 确保所有子组件都已渲染\n      const timer = setTimeout(() => {\n        if (!listRef.current) return;\n        \n        const { scrollHeight, clientHeight, scrollTop } = listRef.current;\n        const isAtBottom = scrollHeight - (scrollTop + clientHeight) < 10;\n        \n        console.log('Initial scroll check:', { scrollHeight, clientHeight, scrollTop, isAtBottom });\n        \n        // 只有当不在底部时才滚动到底部\n        if (!isAtBottom) {\n          console.log('Scrolling to bottom...');\n          scrollToBottom('auto');\n        } else {\n          console.log('Already at bottom, no need to scroll');\n        }\n      }, 100);\n      \n      return () => {\n        clearTimeout(timer);\n      };\n    }\n  }, [scrollToBottom]);\n\n  // 清理定时器和动画帧\n  useEffect(() => {\n    return () => {\n      if (debounceTimerRef.current) clearTimeout(debounceTimerRef.current);\n      if (scrollTimeoutRef.current) clearTimeout(scrollTimeoutRef.current);\n      if (scrollAnimationFrameRef.current) {\n        cancelAnimationFrame(scrollAnimationFrameRef.current);\n      }\n    };\n  }, []);\n\n  // 暴露方法给父组件\n  useImperativeHandle(\n    ref,\n    () => ({\n      scrollToBottom,\n      scrollToTop,\n      scrollToPosition,\n      getScrollPosition,\n      loadOlderMessages,\n      loadNewerMessages,\n    }),\n    [scrollToBottom, scrollToTop, scrollToPosition, getScrollPosition, loadOlderMessages, loadNewerMessages]\n  );\n\n  return (\n    <Box\n      ref={listRef}\n      className={`message-list-scroller ${className}`}\n      style={{\n        position: 'relative',\n        height: '100%',\n        overflowY: 'auto',\n        ...style,\n      }}\n      onScroll={handleScroll}\n    >\n      {/* 顶部加载指示器 */}\n      <Box\n        sx={{\n          display: 'flex',\n          justifyContent: 'center',\n          padding: 1,\n          minHeight: 40,\n        }}\n      >\n        {loading && <CircularProgress size={20} />}\n      </Box>\n\n      {/* 消息列表内容 */}\n      {children}\n\n      {/* 底部加载指示器 */}\n      <Box\n        sx={{\n          display: 'flex',\n          justifyContent: 'center',\n          padding: 1,\n          minHeight: 40,\n        }}\n      >\n        {loadingNewer && <CircularProgress size={20} />}\n      </Box>\n\n      {/* 滚动到底部按钮 */}\n      <Fade in={showScrollToBottom}>\n        <Box\n          sx={{\n            position: 'sticky',\n            bottom: 16,\n            left: '50%',\n            transform: 'translateX(-50%)',\n            zIndex: 1,\n          }}\n        >\n          <Button\n            variant=\"contained\"\n            color=\"primary\"\n            onClick={() => scrollToBottom('smooth')}\n            startIcon={\n              <Badge\n                badgeContent={newMessageCount}\n                color=\"error\"\n                invisible={newMessageCount === 0}\n              >\n                <Box width={24} height={24} />\n              </Badge>\n            }\n          >\n            {t('scrollToBottom')}\n          </Button>\n        </Box>\n      </Fade>\n    </Box>\n  );\n});\n\nMessageListScroller.displayName = 'MessageListScroller';\n\nexport { MessageListScroller };\nexport type { MessageListScrollerRef, MessageListScrollerProps };\n","import { Box, Paper, Divider, useTheme, CssBaseline } from '@mui/material';\nimport { useTranslation } from '@fanfanlo';\nimport { RoomHeader } from './RoomHeader';\nimport { MessageList } from './MessageList';\nimport { MessageInput } from './MessageInput';\nimport { RoomMembers } from './RoomMembers';\nimport { useCallback, useEffect, useRef, useState } from 'react';\nimport { useRouter } from 'next/router';\nimport { MessageListScroller, MessageListScrollerRef } from './MessageListScroller';\n\ninterface RoomContentProps {\n  roomId: string;\n}\n\nexport function RoomContent({ roomId }: RoomContentProps) {\n  const { t } = useTranslation('homepage/im/components/room/content');\n  const theme = useTheme();\n  const [showMembers, setShowMembers] = useState(false);\n\n  const router = useRouter();\n  const toggleMembers = () => {\n    setShowMembers(!showMembers);\n  };\n  const topBarRef = useRef<HTMLDivElement>(null);\n  const bottomBarRef = useRef<HTMLDivElement>(null);\n  const [bottomBarHeight, setBottomBarHeight] = useState(0);\n  const [topBarHeight, setTopBarHeight] = useState(0);\n  const [hasMoreMessages, setHasMoreMessages] = useState(true);\n  const [hasNewerMessages, setHasNewerMessages] = useState(true);\n  const [isLoadingMore, setIsLoadingMore] = useState(false);\n  const [isLoadingNewer, setIsLoadingNewer] = useState(false);\n  const messageScrollerRef = useRef<MessageListScrollerRef>(null);\n\n  useEffect(() => {\n    if (bottomBarRef.current) {\n      setBottomBarHeight(bottomBarRef.current.offsetHeight);\n    }\n  }, [bottomBarRef.current]);\n\n  useEffect(() => {\n    if (topBarRef.current) {\n      setTopBarHeight(topBarRef.current.offsetHeight);\n    }\n  }, [topBarRef.current]);\n  // 加载更多历史消息\n  const handleLoadMore = useCallback(async () => {\n    if (isLoadingMore || !hasMoreMessages) return;\n    \n    setIsLoadingMore(true);\n    try {\n      // TODO: 实现加载更多消息的逻辑\n      // 例如: await loadOlderMessages(roomId);\n      // 加载完成后更新 hasMoreMessages 状态\n      // setHasMoreMessages(/* 是否还有更多消息 */);\n      await new Promise(resolve => setTimeout(resolve, 1000)); // 模拟加载延迟\n    } finally {\n      setIsLoadingMore(false);\n    }\n  }, [roomId, isLoadingMore, hasMoreMessages]);\n\n  // 加载更新消息\n  const handleLoadNewer = useCallback(async () => {\n    if (isLoadingNewer || !hasNewerMessages) return;\n    \n    setIsLoadingNewer(true);\n    try {\n      // TODO: 实现加载更新消息的逻辑\n      // 例如: await loadNewerMessages(roomId);\n      // 加载完成后更新 hasNewerMessages 状态\n      // setHasNewerMessages(/* 是否还有更新消息 */);\n      await new Promise(resolve => setTimeout(resolve, 1000)); // 模拟加载延迟\n    } finally {\n      setIsLoadingNewer(false);\n    }\n  }, [roomId, isLoadingNewer, hasNewerMessages]);\n\n  // 滚动到底部\n  const scrollToBottom = useCallback(() => {\n    if (messageScrollerRef.current) {\n      messageScrollerRef.current.scrollToBottom();\n    }\n  }, []);\n\n  return (\n    <Box sx={{ display: 'flex', flexDirection: 'column', height: '100%' }}>\n      {/* 顶部 AppBar */}\n      <Box\n        ref={topBarRef}\n        sx={{\n          position: 'fixed',\n          top: 0,\n          left: 0,\n          right: 0,\n          backgroundColor: '#fff',\n          padding: '10px',\n          borderBottom: '1px solid #ccc',\n          zIndex: 1,\n        }}>\n        <RoomHeader roomId={roomId} onToggleMembers={toggleMembers} showMembers={showMembers} />\n      </Box>\n\n      {/* 中间内容区域 */}\n      <Box\n        sx={{\n          display: 'flex',\n          flexDirection: 'column',\n          height: `calc(100vh - ${topBarHeight + bottomBarHeight}px)`,\n          marginTop: `${topBarHeight}px`,\n          overflow: 'hidden',\n          backgroundColor: '#e0e0e0',\n        }}>\n        <Box\n          sx={{\n            flex: 1,\n            padding: 2,\n            height: '100%',\n            boxSizing: 'border-box',\n            position: 'relative',\n          }}>\n          <MessageListScroller \n            ref={messageScrollerRef}\n            roomId={roomId}\n            onLoadMore={handleLoadMore}\n            onLoadNewer={handleLoadNewer}\n            hasMore={hasMoreMessages}\n            hasNewer={hasNewerMessages}\n            loading={isLoadingMore}\n            loadingNewer={isLoadingNewer}\n          >\n            <MessageList roomId={roomId} onMessageSent={scrollToBottom} />\n          </MessageListScroller>\n        </Box>\n      </Box>\n\n      {/* 底部 BottomBar */}\n      <Box\n        ref={bottomBarRef}\n        sx={{\n          position: 'fixed',\n          bottom: 0,\n          left: 0,\n          right: 0,\n          backgroundColor: '#fff',\n          padding: '10px',\n          borderTop: '1px solid #ccc',\n          zIndex: 1,\n        }}>\n        <MessageInput roomId={roomId} />\n      </Box>\n    </Box>\n  );\n}\n","import { Box, Typography, Avatar, List, ListItem, ListItemAvatar, ListItemText, CircularProgress } from '@mui/material';\nimport { useProxyWatch, useProxyWatchUpdates, useTranslation } from '@fanfanlo';\nimport { matrixUser } from '../../client/user';\nimport { matrixRoom } from '../../client/room';\nimport { RoomMembership } from '../../client/room/types';\n\ninterface RoomMember {\n  userId: string;\n  displayName?: string;\n  avatarUrl?: string;\n  membership: RoomMembership;\n}\n\ninterface RoomMembersProps {\n  roomId: string;\n}\n\nexport function RoomMembers({ roomId }: RoomMembersProps) {\n  const { t } = useTranslation('homepage/im/components/room/content');\n  \n  // 监听登录状态\n  const [loginResponse] = useProxyWatch(\n    matrixUser.userData,\n    'userInfo.loginResponse',\n    matrixUser.userData.userInfo.loginResponse\n  );\n  \n  // 监听房间成员数据和加载状态\n  const [roomMembers] = useProxyWatchUpdates(\n    matrixRoom.roomData.roomMembers,\n    [`${roomId}`],\n    matrixRoom.roomData.roomMembers[roomId] || []\n  );\n  const [isFetchingMembers] = useProxyWatch(\n    matrixRoom.roomData.isFetchingMembers,\n    'value',\n    matrixRoom.roomData.isFetchingMembers.value\n  );\n\n  // 如果登录信息未加载完成，显示加载中\n  if (!loginResponse) {\n    return (\n      <Box sx={{ p: 2, textAlign: 'center' }}>\n        <CircularProgress size={24} />\n      </Box>\n    );\n  }\n\n  const currentUserId = loginResponse.user_id;\n  \n  // 将当前用户排在最前面\n  const sortedMembers = [...roomMembers].sort((a) => \n    a.userId === currentUserId ? -1 : 1\n  );\n\n  if (isFetchingMembers) {\n    return (\n      <Box sx={{ p: 2, textAlign: 'center' }}>\n        <CircularProgress size={24} />\n        <Typography variant=\"caption\" color=\"text.secondary\" sx={{ mt: 1 }}>\n          {t('RoomMembers.loading')}\n        </Typography>\n      </Box>\n    );\n  }\n\n  if (sortedMembers.length === 0) {\n    return (\n      <Box sx={{ p: 2, textAlign: 'center' }}>\n        <Typography color=\"text.secondary\">\n          {t('RoomMembers.noMembers')}\n        </Typography>\n      </Box>\n    );\n  }\n\n  return (\n    <Box>\n      <List>\n        {sortedMembers.map((member: { userId: string; displayName?: string; avatarUrl?: string; membership: 'join' | 'invite' | 'leave' | 'ban' }) => (\n          <ListItem key={member.userId}>\n            <ListItemAvatar>\n              <Avatar src={member.avatarUrl} alt={member.displayName || member.userId} />\n            </ListItemAvatar>\n            <ListItemText\n              primary={member.displayName || member.userId}\n              secondary={member.userId === currentUserId ? t('RoomMembers.you') : t(`RoomMembers.${member.membership}`)}\n            />\n          </ListItem>\n        ))}\n      </List>\n    </Box>\n  );\n}","export * from './RoomContent';\nexport * from './RoomHeader';\nexport * from './MessageList';\nexport * from './MessageInput';\nexport * from './RoomMembers';\nexport * from './types';\n","import { Direction } from 'matrix-js-sdk';\r\nimport { matrixClient } from '../../client';\r\nimport { messageUtils } from '../messageUtils';\r\nimport { IMatrixMessage } from '../../room/types';\r\n// 你需要根据实际项目引入 matrix 客户端实例\r\n// import { matrixClient } from '你的matrix客户端路径';\r\n\r\n\r\n/**\r\n * 基于 event_id 向前翻历史消息\r\n * @param client MatrixClient 实例\r\n * @param roomId 房间ID\r\n * @param eventId 作为锚点的消息ID\r\n * @param limit 拉取条数\r\n * @returns 拉取到的 MatrixEvent[]，以及是否到达最早\r\n */\r\nasync function loadHistoryByEventId(roomId: string, eventId: string, limit: number = 20) {\r\n    if(!matrixClient.client) return {\r\n        events: [],\r\n        isEnd: true,\r\n        timeline: null,\r\n    };\r\n  // 1. 获取 Room 实例\r\n  const room = await matrixClient.client.getRoom(roomId);\r\n  if (!room) {\r\n    throw new Error('Room not found: ' + roomId);\r\n  }\r\n\r\n  // 2. 获取 timelineSet\r\n  const timelineSet = await room.getUnfilteredTimelineSet();\r\n  if (!timelineSet) {\r\n    throw new Error('timelineSet not found for room: ' + roomId);\r\n  }\r\n\r\n  // 3. 获取包含该 event 的 timeline\r\n  const timeline = await matrixClient.client.getEventTimeline(timelineSet, eventId);\r\n  if (!timeline) {\r\n    throw new Error('timeline not found for event: ' + eventId);\r\n  }\r\n\r\n  // 4. 向前分页加载历史\r\n  const hasMore = await matrixClient.client.paginateEventTimeline(timeline, {\r\n    backwards: true,\r\n    limit,\r\n  });\r\n\r\n  // 5. 获取 timeline 上的所有事件\r\n  const events = await timeline.getEvents(); // Array<MatrixEvent>\r\n  \r\n  // 6. 提取 event 字段，转为 IMatrixMessage[]\r\n  const messages = events\r\n  .map(ev => ev.event)\r\n  .filter(\r\n    (ev): ev is {\r\n      event_id: string;\r\n      sender: string;\r\n      content: any;\r\n      origin_server_ts: number;\r\n      type: string;\r\n      unsigned?: any;\r\n      room_id?: string;\r\n    } =>\r\n      !!ev &&\r\n      typeof ev.event_id === 'string' &&\r\n      typeof ev.sender === 'string' &&\r\n      typeof ev.content === 'object' &&\r\n      ev.content !== undefined &&\r\n      typeof ev.origin_server_ts === 'number' &&\r\n      typeof ev.type === 'string'\r\n  )\r\n  .map(ev => ({\r\n    event_id: ev.event_id,\r\n    sender: ev.sender,\r\n    content: ev.content,\r\n    origin_server_ts: ev.origin_server_ts,\r\n    type: ev.type,\r\n    unsigned: ev.unsigned,\r\n    room_id: ev.room_id,\r\n  })) as IMatrixMessage[];\r\n  // 7. 批量写入本地消息池\r\n  messageUtils.batchAddHistoryMessages(roomId, messages);\r\n  // 6. 判断是否到达最早\r\n  const isEnd = !hasMore;\r\n\r\n  return {\r\n    events,\r\n    isEnd,\r\n    timeline,\r\n  };\r\n}\r\n\r\nexport const matrixLoadHistory = {\r\n  loadHistoryByEventId\r\n}","import React, { useEffect, useRef, useState, useCallback } from 'react';\r\nimport { ListRange, Virtuoso } from 'react-virtuoso';\r\nimport { isDev, useTranslation } from '@fanfanlo';\r\nimport { MessageItem } from './MessageItem';\r\nimport { matrixRoom } from '../../client/room';\r\nimport { matrixUser } from '../../client/user';\r\nimport { useProxyWatch, useProxyWatchUpdates } from '@fanfanlo';\r\nimport { IMatrixMessage } from '@src/im/client';\r\nimport { matrixLoadHistory } from '@src/im/client/message/handlers/loadHistory';\r\nimport { Log } from '@fanfanlo';\r\n\r\ninterface MessageListVirtuosoProps {\r\n  roomId: string;\r\n}\r\n\r\nconst fileLogger = new Log(false, 'MessageListVirtuoso');\r\n// fileLogger.pause = true;\r\n// fileLogger.childrenPaused = true;\r\n\r\nexport function MessageListVirtuoso({ roomId }: MessageListVirtuosoProps) {\r\n  const logger = fileLogger.sub(false,'MessageListVirtuoso_ui');\r\n  logger.pause = true;\r\n  // logger.childrenPaused = true;\r\n\r\n  const { t } = useTranslation('homepage/im/components/room/content');\r\n\r\n  // 监听登录状态\r\n  const [loginResponse] = useProxyWatch(\r\n    matrixUser.userData,\r\n    'userInfo.loginResponse',\r\n    matrixUser.userData.userInfo.loginResponse\r\n  );\r\n\r\n  // 监听消息列表\r\n  const [messageIds] = useProxyWatchUpdates(\r\n    matrixRoom.roomData.messages,\r\n    [`${roomId}`],\r\n    matrixRoom.roomData.messages[roomId] || []\r\n  );\r\n  const messagesMap = matrixRoom.roomData.messagesMap;\r\n\r\n  // 获取消息详情并转换为 IMatrixMessage 格式\r\n  const messageList = (messageIds?.map(id => {\r\n    const message = messagesMap[id];\r\n    if (!message) return null;\r\n    return {\r\n      event_id: message.event_id,\r\n      type: message.content.msgtype,\r\n      sender: message.sender,\r\n      origin_server_ts: message.origin_server_ts,\r\n      room_id: roomId || '',\r\n      content: message.content,\r\n    };\r\n  }).filter((item): item is NonNullable<typeof item> => item !== null) || []) as IMatrixMessage[];\r\n\r\n  const [loading, setLoading] = useState(false);\r\n  const [historyEnd, setHistoryEnd] = useState(false);\r\n  const [loadingHistory, setLoadingHistory] = useState(false);\r\n  const virtuosoRef = useRef<any>(null);\r\n  const containerRef = useRef<HTMLDivElement>(null);\r\n  // 补偿相关\r\n  const anchorMsgIdRef = useRef<string | null>(null); // 记录锚点消息id\r\n  const [autoCompensate, setAutoCompensate] = useState(false);\r\n\r\n  // 上拉加载更多历史消息，加载前记录 anchorMsgIdRef\r\n  const onLoadMore = useCallback(async () => {\r\n    logger.log('onLoadMore called', {\r\n      roomId,\r\n      messageListLen: messageList.length,\r\n      loading,\r\n      historyEnd,\r\n    });\r\n    if (!roomId || messageList.length === 0 || loading || historyEnd) return;\r\n    setLoading(true);\r\n    setLoadingHistory(true);\r\n    try {\r\n      anchorMsgIdRef.current = messageList[0]?.event_id;\r\n      const res = await matrixLoadHistory.loadHistoryByEventId(roomId, messageList[0].event_id, isDev ? 30 : 10);\r\n      logger.log('res=', res);\r\n      if (res.isEnd) setHistoryEnd(true);\r\n      setAutoCompensate(true); // 加载后触发补偿\r\n    } finally {\r\n      setLoading(false);\r\n      setLoadingHistory(false);\r\n    }\r\n  }, [roomId, messageList, loading, historyEnd]);\r\n\r\n  // 在 totalListHeightChanged 里做自动补偿\r\n  const handleTotalListHeightChanged = useCallback((height: number) => {\r\n    logger.log('[totalListHeightChanged] compensation check', { height, autoCompensate, anchorMsg: anchorMsgIdRef.current });\r\n    if (autoCompensate && anchorMsgIdRef.current) {\r\n      const newIndex = messageList.findIndex(msg => msg.event_id === anchorMsgIdRef.current);\r\n      logger.log('[autoCompensate] anchorMsgId', anchorMsgIdRef.current, 'newIndex', newIndex);\r\n      if (newIndex !== -1) {\r\n        setTimeout(() => {\r\n          logger.log('[autoScroll] scrollToIndex', { newIndex, anchorMsgId: anchorMsgIdRef.current });\r\n          virtuosoRef.current?.scrollToIndex({ index: newIndex, align: 'start', \r\n            // behavior: 'smooth' \r\n          });\r\n        }, 30);\r\n      }\r\n      setAutoCompensate(false);\r\n    }\r\n  }, [autoCompensate, messageList]);\r\n\r\n  // 监听用户主动操作，停止自动补偿\r\n  useEffect(() => {\r\n    const stopCompensate = () => {\r\n      logger.log('[userAction] stop autoCompensate');\r\n      setAutoCompensate(false);\r\n    };\r\n    const el = containerRef.current;\r\n    if (!el) return;\r\n    el.addEventListener('mousedown', stopCompensate);\r\n    el.addEventListener('touchstart', stopCompensate);\r\n    return () => {\r\n      el.removeEventListener('mousedown', stopCompensate);\r\n      el.removeEventListener('touchstart', stopCompensate);\r\n    };\r\n  }, []);\r\n\r\n  // 每次到顶都尝试加载历史\r\n  const handleAtTopStateChange = useCallback((atTop: boolean) => {\r\n    logger.log('[atTopStateChange]', { atTop, historyEnd, loading, loadingHistory });\r\n    if (atTop && !historyEnd && !loading && !loadingHistory) {\r\n      onLoadMore();\r\n    }\r\n  }, [historyEnd, loading, loadingHistory, onLoadMore]);\r\n\r\n  logger.log('messageList.length=', messageList.length);\r\n  return (\r\n    // <div ref={containerRef} style={{ height: '100%', width: '100%' }}>\r\n      <Virtuoso\r\n        ref={virtuosoRef}\r\n        totalListHeightChanged={handleTotalListHeightChanged}\r\n        style={{ height: '100%', width: '100%' }}\r\n        data={messageList}\r\n        itemContent={(index, message) => (\r\n          <MessageItem\r\n            message={message}\r\n            currentUserId={loginResponse?.user_id || ''}\r\n          />\r\n        )}\r\n        followOutput={\"auto\"}\r\n        atTopStateChange={handleAtTopStateChange}\r\n        components={{\r\n          EmptyPlaceholder: () => (\r\n            <div style={{ textAlign: 'center', color: '#888', padding: 16 }}>\r\n              {t('MessageList.noMessages')}\r\n            </div>\r\n          ),\r\n          Header: () =>\r\n            loading ? (\r\n              <div style={{ textAlign: 'center', color: '#888', padding: 8 }}>\r\n                {t('MessageList.loadingHistory')}\r\n              </div>\r\n            ) : historyEnd ? (\r\n              <div style={{ textAlign: 'center', color: '#888', padding: 8 }}>\r\n                {t('MessageList.historyEnd')}\r\n              </div>\r\n            ) : null,\r\n        }}\r\n      />\r\n    // </div>\r\n  );\r\n}\r\n\r\n","import { Box, Paper, Divider, useTheme, CssBaseline } from '@mui/material';\r\nimport { useTranslation } from '@fanfanlo';\r\nimport { RoomHeader } from './RoomHeader';\r\nimport { MessageList } from './MessageList';\r\nimport { MessageInput } from './MessageInput';\r\nimport { RoomMembers } from './RoomMembers';\r\nimport { useCallback, useEffect, useRef, useState } from 'react';\r\nimport { useRouter } from 'next/router';\r\nimport { Log } from '@fanfanlo';\r\nimport { MessageVirturalList } from './message-virtural-list/MessageVirturalList';\r\nimport { VirtualListScrollToBottom } from './message-virtural-list/virtural-list-scroll-to-bottom';\r\nimport { MessageListVirtuoso } from './MessageListVirtuoso';\r\nimport { MessageListVirtuosoTest } from './MessageListVirtuosoTest';\r\n// import {MessageVirturalList} from './MessageVirturalList'\r\n\r\nconst fileLogger = new Log(false, 'im.components.room.RoomContent2');\r\n// fileLogger.pause = true;\r\n\r\ninterface RoomContent2Props {\r\n  roomId: string;\r\n}\r\n\r\nexport function RoomContent2({ roomId }: RoomContent2Props) {\r\n  const logger = fileLogger.sub(false, 'RoomContent2');\r\n  // logger.pause = true;\r\n  \r\n  const { t } = useTranslation('homepage/im/components/room/content');\r\n  const theme = useTheme();\r\n  const [showMembers, setShowMembers] = useState(false);\r\n  const router = useRouter();\r\n  \r\n  const topBarRef = useRef<HTMLDivElement>(null);\r\n  const bottomBarRef = useRef<HTMLDivElement>(null);\r\n  const [bottomBarHeight, setBottomBarHeight] = useState(0);\r\n  const [topBarHeight, setTopBarHeight] = useState(0);\r\n\r\n  useEffect(() => {\r\n    if (bottomBarRef.current) {\r\n      setBottomBarHeight(bottomBarRef.current.offsetHeight);\r\n    }\r\n  }, [bottomBarRef.current]);\r\n\r\n  useEffect(() => {\r\n    if (topBarRef.current) {\r\n      setTopBarHeight(topBarRef.current.offsetHeight);\r\n    }\r\n  }, [topBarRef.current]);\r\n\r\n  // 滚动到底部\r\n  const scrollToBottom = useCallback(() => {\r\n    // 由于移除了 MessageListScroller，这里暂时留空\r\n    // 后续可以实现自定义滚动逻辑\r\n  }, []);\r\n\r\n  // 切换成员面板\r\n  const toggleMembers = useCallback(() => {\r\n    setShowMembers(prev => !prev);\r\n  }, []);\r\n\r\n  return (\r\n    <Box sx={{ display: 'flex', flexDirection: 'column', height: '100%' }}>\r\n      {/* 顶部 AppBar */}\r\n      <Box\r\n        ref={topBarRef}\r\n        sx={{\r\n          position: 'fixed',\r\n          top: 0,\r\n          left: 0,\r\n          right: 0,\r\n          backgroundColor: '#fff',\r\n          padding: '10px',\r\n          borderBottom: '1px solid #ccc',\r\n          zIndex: 1,\r\n        }}>\r\n        <RoomHeader roomId={roomId} onToggleMembers={toggleMembers} showMembers={showMembers} />\r\n      </Box>\r\n\r\n      {/* 中间内容区域 */}\r\n      <Box\r\n        sx={{\r\n          display: 'flex',\r\n          flexDirection: 'column',\r\n          height: `calc(100vh - ${topBarHeight + bottomBarHeight}px)`,\r\n          marginTop: `${topBarHeight}px`,\r\n          overflow: 'hidden',\r\n          backgroundColor: '#e0e0e0',\r\n        }}>\r\n        <Box\r\n          sx={{\r\n            flex: 1,\r\n            padding: 2,\r\n            height: '100%',\r\n            boxSizing: 'border-box',\r\n            position: 'relative',\r\n            overflowY: 'hidden',\r\n          }}>\r\n            <MessageListVirtuoso roomId={roomId} />\r\n            {/* <MessageListVirtuosoTest /> */}\r\n          {/* <MessageList roomId={roomId} /> */}\r\n          {/* <MessageVirturalList roomId={roomId} /> */}\r\n          {/* <VirtualListScrollToBottom /> */}\r\n        </Box>\r\n      </Box>\r\n\r\n      {/* 底部 BottomBar */}\r\n      <Box\r\n        ref={bottomBarRef}\r\n        sx={{\r\n          position: 'fixed',\r\n          bottom: 0,\r\n          left: 0,\r\n          right: 0,\r\n          backgroundColor: '#fff',\r\n          padding: '10px',\r\n          borderTop: '1px solid #ccc',\r\n          zIndex: 1,\r\n        }}>\r\n        <MessageInput roomId={roomId} />\r\n      </Box>\r\n    </Box>\r\n  );\r\n}","import { useRouter } from 'next/router';\r\nimport { useEffect } from 'react';\r\nimport { Dispatcher, useTranslation } from \"@fanfanlo\";\r\nimport { AppbarContainer, AppShell } from \"@app/ui\";\r\nimport { RoomContent } from '../../../im/components/room';\r\nimport { RoomContent2 } from '@src/im/components/room/RoomContent2';\r\n\r\nexport default function RoomPage() {\r\n  const { t } = useTranslation(\"homepage/pages/im/room/content\");\r\n  const router = useRouter();\r\n  const { id: roomId } = router.query;\r\n\r\n  useEffect(() => {\r\n    // 如果没有roomId，重定向到聊天列表\r\n    if (!roomId && router.isReady) {\r\n      router.push('/im');\r\n    }\r\n  }, [roomId, router]);\r\n\r\n  if (!roomId) {\r\n    return (\r\n      <AppShell>\r\n        <AppbarContainer appbarProps={{ title: t(\"content.title\"), back: true }} />\r\n      </AppShell>\r\n    );\r\n  }\r\n\r\n  // return(\r\n  //   <AppShell>\r\n  //     <RoomContentV2 roomId={roomId as string} dispatcher={new Dispatcher()} />\r\n  //   </AppShell>\r\n  // )\r\n  return (\r\n    \r\n    <RoomContent2 roomId={roomId as string} />\r\n  )\r\n\r\n  return (\r\n    <AppShell>\r\n      \r\n      {/* <AppbarContainer appbarProps={{ title: t(\"content.title\"), back: true }}> */}\r\n      <RoomContent roomId={roomId as string} />\r\n      {/* </AppbarContainer> */}\r\n    </AppShell>\r\n  );\r\n}","import { Box, Button, Container } from '@mui/material';\r\nimport { createContext, PropsWithChildren, useContext, useEffect } from 'react';\r\nimport { ITitleI18nConf, ITitleI18nNsConf, ITitleI18nTitleConf } from '.';\r\nimport { isBuild, isDev, isServer, loadI18nValue, publicRuntimeConfig } from '@fanfanlo';\r\nimport { read } from 'fs';\r\nimport { useTranslation } from '@fanfanlo';\r\n\r\n\r\nfunction Reload(){\r\n  if(!isDev)return <>  </>\r\n  const {t} = useTranslation(\"app-ui/components/page/content\")\r\n  return(\r\n    <Box>\r\n      <Button onClick={() => {window.location.reload()}}>{t(\"PageContent.refresh\")}</Button>\r\n      {new Date().toLocaleString()}\r\n    </Box>\r\n  )\r\n}\r\n\r\nconst ScrollP = createContext({ x: 0, y: 0 });\r\nlet index = 0;\r\nexport default function PageContent({ children, titleConf, reload }: {titleConf?:ITitleI18nConf, reload?: boolean} & PropsWithChildren) {\r\n  index++;\r\n  const scroll = useContext(ScrollP);\r\n  const clazz = `${Date.now() + Math.random() * Date.now()}`;\r\n  useEffect(()=>{\r\n    async function loadTitle(){\r\n      if(!titleConf)return\r\n      let title = titleConf.title\r\n      if(titleConf.ns){\r\n        title = await loadI18nValue(titleConf.ns, titleConf.key || \"content.title\")\r\n      }\r\n      if(!title)return\r\n      document.title = title\r\n    }\r\n    loadTitle()\r\n  }, [])\r\n  useEffect(() => {\r\n    const container = document.getElementsByClassName(clazz)[0];\r\n    if (!container) return;\r\n    container.scrollTop = scroll.y;\r\n    const onScroll = () => {\r\n      var scrollTop = container.scrollTop;\r\n      scroll.y = scrollTop;\r\n    };\r\n    container.removeEventListener('scroll', onScroll);\r\n    container.addEventListener('scroll', onScroll, { passive: true });\r\n    return () => container.removeEventListener('scroll', onScroll);\r\n  }, [clazz, scroll]);\r\n  return (\r\n\r\n    <Container className={clazz} sx={{ flexGrow: 1, overflow: 'auto', padding: \"0px\" }}>\r\n      <Box>\r\n        {(reload || (reload == undefined)) && <Reload />}\r\n        {children}\r\n      </Box>\r\n    </Container>\r\n  );\r\n}\r\n","import { PropsWithChildren } from \"react\";\r\nimport PageContent from \"./PageContent\";\r\nimport { ITitleI18nConf } from \".\";\r\nexport default function AndroidPageContent({ children, titleConf, reload }: {titleConf?:ITitleI18nConf, reload?: boolean} & PropsWithChildren)  {\r\n    return (\r\n        <PageContent titleConf={titleConf} reload={reload}>\r\n            {children}\r\n        </PageContent>\r\n    )\r\n}\r\n","\n    (window.__NEXT_P = window.__NEXT_P || []).push([\n      \"/im/room\",\n      function () {\n        return require(\"private-next-pages/im/room/index.tsx\");\n      }\n    ]);\n    if(module.hot) {\n      module.hot.dispose(function () {\n        window.__NEXT_P.push([\"/im/room\"])\n      });\n    }\n  ","import { Dispatcher } from \"@fanfanlo\"\r\nimport { DispatcherUnsubscribe } from \"@fanfanlo\"\r\n\r\nconst dipsatcher = new Dispatcher()\r\ninterface IStaticModel{\r\n    dipsatcher:Dispatcher\r\n    screenLockCount:number\r\n    switchPage:()=>void\r\n    listenSwitchPage:(callback:()=>void)=>DispatcherUnsubscribe \r\n}\r\nexport const staticModel:IStaticModel = {\r\n    dipsatcher,\r\n    screenLockCount:0,\r\n    switchPage:async()=>{\r\n        dipsatcher.dispatch(\"switchPage\")\r\n        staticModel.screenLockCount = 0\r\n    },\r\n    listenSwitchPage:(callback:()=>void)=>{\r\n        return dipsatcher.addListener(\"switchPage\",callback)\r\n    }\r\n}   \r\n","import { PropsWithChildren } from \"react\";\r\nimport { AnimatePresence, motion } from \"framer-motion\";\r\nimport { useRouter } from \"next/router\";\r\n\r\n\r\nexport function PageTransition({ children }: PropsWithChildren) {\r\n    const router = useRouter()\r\n    return (\r\n\r\n        <AnimatePresence mode=\"sync\">\r\n            <motion.div\r\n                key={router.route}\r\n                initial={{ opacity: 0, y: 10 }}\r\n                animate={{ opacity: 1, y: 0 }}\r\n                exit={{ opacity: 0, y: -110 }}\r\n                transition={{ duration: 0.3 }}\r\n            >\r\n                {children}\r\n            </motion.div>\r\n        </AnimatePresence>\r\n    )\r\n}","import { staticModel } from \"@app/static\";\r\nimport { Box } from \"@mui/material\";\r\nimport { useEffect } from \"react\";\r\nimport { PageTransition } from \"../motion\";\r\nlet idCount = 0\r\nexport function PageShell({children}:{children:React.ReactNode}){\r\n    const id = `app-shell-${idCount++}`\r\n    useEffect(()=>{\r\n        const box = document.querySelector(`#${id}`)\r\n        const unlisten = staticModel.listenSwitchPage(()=>{\r\n            if(!box)return\r\n        })\r\n        if(!box)return\r\n        box.addEventListener(\"click\",(e)=>{\r\n            if(staticModel.screenLockCount == 0)return\r\n            e.stopPropagation()\r\n            e.preventDefault()\r\n        })\r\n        return ()=>{\r\n            unlisten()\r\n        }\r\n    },[])\r\n    return (\r\n        <Box id={id}>\r\n            <PageTransition>\r\n                {children}  \r\n            </PageTransition>\r\n        </Box>\r\n    )\r\n}\r\n","import { AppBar, Box, Container, CssBaseline, Fab, Fade, Slide, Toolbar, Typography, useScrollTrigger } from \"@mui/material\";\r\nimport { PropsWithChildren, ReactNode } from \"react\";\r\n// import {AndroidPageContent} from \"../../\";\r\nimport { browserHistoryUtils, IDispatcher } from \"@fanfanlo\";\r\nimport KeyboardArrowLeft from '@mui/icons-material/KeyboardArrowLeft';\r\nimport KeyboardArrowUpIcon from '@mui/icons-material/KeyboardArrowUp';\r\nimport * as React from \"react\";\r\nimport { useRouter } from \"next/router\";\r\nimport { PageShell } from \"../app/PageShell\";\r\nimport shadows from \"@mui/material/styles/shadows\";\r\nimport AndroidPageContent from \"../page/AndroidPageContent\";\r\nimport { IAppBarBackAskEvent } from \"@app/static\";\r\nimport { ITitleI18nConf } from \"../page\";\r\ninterface Props {\r\n    /**\r\n     * Injected by the documentation to work in an iframe.\r\n     * You won't need it on your project.\r\n     */\r\n    window?: () => Window;\r\n    children?: React.ReactElement<unknown>;\r\n}\r\n\r\nfunction HideOnScroll(props: Props) {\r\n    const { children, window } = props;\r\n    // Note that you normally won't need to set the window ref as useScrollTrigger\r\n    // will default to window.\r\n    // This is only being set here because the demo is in an iframe.\r\n    const trigger = useScrollTrigger({\r\n        target: window ? window() : undefined,\r\n    });\r\n\r\n    return (\r\n        <Slide appear={false} direction=\"down\" in={!trigger}>\r\n            {children ?? <div />}\r\n        </Slide>\r\n    );\r\n}\r\nexport interface IAppbarProps extends PropsWithChildren {\r\n    title: ReactNode\r\n    back: boolean\r\n    backHandler?: () => boolean\r\n    backDispatcher?:IDispatcher\r\n    toolbar?:ReactNode\r\n    toolbarContent?:ReactNode\r\n}\r\nexport function Appbar({ title }: { title: ReactNode } & PropsWithChildren) {\r\n    return (\r\n\r\n        <AppBar color={\"inherit\"}>\r\n            <Toolbar>\r\n                <Typography variant=\"h6\" component=\"div\">\r\n                    {title}\r\n                </Typography>\r\n            </Toolbar>\r\n        </AppBar>\r\n    )\r\n}\r\n\r\ninterface IAppbarContainerProps extends PropsWithChildren {\r\n    appbarProps: IAppbarProps\r\n    titleConf?:ITitleI18nConf\r\n    reload?: boolean\r\n}\r\n\r\n// export interface IAppBarBackAskEvent{\r\n//     defaultPrevented:boolean\r\n// }\r\n\r\nfunction ScrollTop(props: Props) {\r\n    const { children, window } = props;\r\n    // Note that you normally won't need to set the window ref as useScrollTrigger\r\n    // will default to window.\r\n    // This is only being set here because the demo is in an iframe.\r\n    const trigger = useScrollTrigger({\r\n        target: window ? window() : undefined,\r\n        disableHysteresis: true,\r\n        threshold: 100,\r\n    });\r\n\r\n    const handleClick = (event: React.MouseEvent<HTMLDivElement>) => {\r\n        const anchor = (\r\n            (event.target as HTMLDivElement).ownerDocument || document\r\n        ).querySelector('#back-to-top-anchor');\r\n\r\n        if (anchor) {\r\n            anchor.scrollIntoView({\r\n                block: 'center',\r\n            });\r\n        }\r\n    };\r\n\r\n    return (\r\n        <Fade in={trigger}>\r\n            <Box data-id=\"content-scroll-top-button\"\r\n                onClick={handleClick}\r\n                role=\"presentation\"\r\n                sx={{ position: 'fixed', bottom: 16, right: 16 }}\r\n            >\r\n                {children}\r\n            </Box>\r\n        </Fade>\r\n    );\r\n}\r\nexport function AppbarContainer(props: IAppbarContainerProps) {\r\n    const { children, appbarProps, titleConf, reload } = props;\r\n    const router = useRouter()\r\n    function handleBack(){\r\n        // 本想抽象成底层一个方法，但是考虑了一下router需要注入或者是一个callback，似乎像现在这样判断一下event也可以。回头继续观察一下吧。\r\n        const event = browserHistoryUtils.askHistoryBack()\r\n        if(event.defaultPrevented)return\r\n        if(appbarProps.backDispatcher){\r\n            const e:IAppBarBackAskEvent = {defaultPrevented:false}\r\n            appbarProps.backDispatcher.dispatch('back',e)\r\n            if(e.defaultPrevented)return\r\n        }\r\n        router.back()\r\n    }\r\n    return (\r\n        <PageShell>\r\n        <React.Fragment>\r\n            <CssBaseline />\r\n            <HideOnScroll {...props}>\r\n                <AppBar color=\"inherit\">\r\n                    {appbarProps.toolbar ? \r\n                    appbarProps.toolbar:\r\n                    <Toolbar>\r\n                        <KeyboardArrowLeft onClick={handleBack} />\r\n                        {appbarProps.title}\r\n                    </Toolbar>\r\n                    }\r\n                </AppBar>\r\n            </HideOnScroll>\r\n            <Toolbar id=\"back-to-top-anchor\" />\r\n            <Container sx={{padding:\"0\", marginTop:\"17px\"}}>\r\n                <AndroidPageContent titleConf={titleConf} reload={reload}>\r\n                    {children}\r\n                </AndroidPageContent>\r\n            </Container>\r\n\r\n            <ScrollTop {...props}>\r\n                <Fab size=\"small\" aria-label=\"scroll back to top\">\r\n                    <KeyboardArrowUpIcon />\r\n                </Fab>\r\n            </ScrollTop>\r\n        </React.Fragment>\r\n        </PageShell>\r\n    );\r\n}\r\n"],"names":["newValue","AppBar","Toolbar","IconButton","Typography","Avatar","Box","PeopleIcon","useProxyWatchUpdates","useTranslation","matrixRoom","useRouter","KeyboardArrowLeft","RoomHeader","roomId","showMembers","onToggleMembers","roomInfo","t","router","roomData","joinedRoomsMap","onOpenSettingsClick","push","handleBack","back","position","color","elevation","onClick","sx","mr","src","avatarUrl","name","charAt","variant","component","flexGrow","minWidth","overflow","textOverflow","whiteSpace","title","React","TextMessage","message","className","content","body","Button","Dialog","DialogTitle","DialogContent","DialogActions","LocationMessage","geoUri","geo_uri","_","coordinates","split","latitude","longitude","map","Number","mapUrl","process","env","REACT_APP_BAIDU_MAP_KEY","open","setOpen","useState","handleOpenMap","handleClose","mb","img","alt","info","style","cursor","display","justifyContent","alignItems","size","onClose","maxWidth","fullWidth","InteractiveLocationMap","forwardRef","ref","width","height","minHeight","InviteMessage","inviter","sender","invitee","displayname","membership","div","background","borderRadius","padding","fontWeight","RoomNameMessage","visibilityMap","shared","invited","joined","world_readable","RoomHistoryVisibilityMessage","visibility","history_visibility","text","joinRuleMap","invite","public","knock","restricted","RoomJoinRuleMessage","joinRule","join_rule","RoomPowerLevelsMessage","guestAccessMap","can_join","forbidden","RoomGuestAccessMessage","guestAccess","guest_access","RoomTopicMessage","topic","RoomCreateMessage","creator","version","room_version","RoomAvatarMessage","RoomCanonicalAliasMessage","alias","canonical_alias","RoomTombstoneMessage","replacement","replacement_room","RoomEncryptionMessage","RoomServerAclMessage","messageUtils","MessageRenderer","commonProps","event_id","events_default","undefined","users","ban","kick","redact","avatar_url","algorithm","allow","deny","isTextMessage","isLocationMessage","console","log","JSON","stringify","msgtype","Log","fileLogger","MessageItem","currentUserId","memberInfo","logger","sub","pause","room_id","members","roomMembers","find","m","userId","isSelf","pb","bgcolor","p","boxShadow","wordBreak","flexDirection","textAlign","mt","opacity","Date","origin_server_ts","toLocaleTimeString","displayName","fontSize","lineHeight","useProxyWatch","CircularProgress","useEffect","useRef","useLayoutEffect","matrixUser","MessageList","messagesEndRef","messagesContainerRef","autoScroll","setAutoScroll","wasAtBottomRef","userAtBottomRef","userReallyAtBottomRef","DISTANCE_TO_BOTTOM","prevMessageCountRef","isNearBottom","distance","current","scrollTop","scrollHeight","clientHeight","loginResponse","userData","userInfo","messageIds","messages","messagesMap","messageList","id","warn","res","type","filter","item","scrollToBottom","scrollIntoView","behavior","handleScroll","atBottom","length","setTimeout","onScroll","flex","overflowY","gap","user_id","matrixClient","addToLocalCache","updateMessageStatus","messageId","updates","locationMessageUtils","createLocationContent","description","send","tempId","now","client","getUserId","timestamp","status","error","Error","eventId","sendMessage","handleReceived","event","MapProvider","useCallback","TextField","LocationOn","LocationIcon","MapView","LocationPicker","onConfirm","provider","Baidu","setTitle","setDescription","isLoading","setIsLoading","currentLocation","setCurrentLocation","permissionDialogOpen","setPermissionDialogOpen","permissionDeniedDialogOpen","setPermissionDeniedDialogOpen","handleGetCurrentLocation","navigator","geolocation","alert","permissions","query","then","result","state","doGetLocation","catch","getCurrentPosition","lat","coords","lng","code","PERMISSION_DENIED","POSITION_UNAVAILABLE","TIMEOUT","enableHighAccuracy","timeout","maximumAge","handleSubmit","PaperProps","watchPosition","onDeviceLocationUpdate","location","onCenterChange","onLocationError","startIcon","disabled","label","value","onChange","e","target","margin","placeholder","border","gutterBottom","toFixed","br","InputAdornment","Tooltip","Send","SendIcon","AttachFile","AttachFileIcon","EmojiEmotions","EmojiIcon","MessageInput","setMessage","locationPickerOpen","setLocationPickerOpen","fileInputRef","textareaRef","trim","sendTextMessage","focus","handleLocationConfirm","handleFileChange","file","files","handleKeyDown","key","shiftKey","preventDefault","borderTop","borderColor","click","input","multiline","maxRows","onKeyDown","inputRef","mx","InputProps","pr","endAdornment","disableFocusListener","disableHoverListener","edge","span","alignSelf","useImperativeHandle","Fade","Badge","SCROLL_THRESHOLD","SCROLL_DEBOUNCE_MS","MessageListScroller","children","onLoadMore","onLoadNewer","hasMore","hasNewer","loading","loadingNewer","listRef","debounceTimerRef","scrollTimeoutRef","isAtBottomRef","scrollDirectionRef","lastScrollTopRef","isLoadingOlderRef","isLoadingNewerRef","isInitialLoadRef","isProgrammaticScrollRef","scrollAnimationFrameRef","showScrollToBottom","setShowScrollToBottom","newMessageCount","setNewMessageCount","updateScrollInfo","el","distanceFromBottom","isAtTop","isAtBottom","SCROLL_THRESHOLD_PX","scrollDiff","Math","abs","direction","lastScrollTop","diff","list","requestAnimationFrame","scrollToTop","scrollTo","top","scrollToPosition","getScrollPosition","loadOlderMessages","isLoadingOlder","firstChild","firstElementChild","firstChildOffset","offsetTop","newScrollHeight","heightDiff","newPosition","newFirstChild","loadNewerMessages","wasAtBottom","isStillAtBottom","prev","currentTarget","clearTimeout","currentScrollTop","currentTime","time","isProgrammatic","scrollInfo","scrollDirection","timer","cancelAnimationFrame","in","bottom","left","transform","zIndex","badgeContent","invisible","useTheme","RoomContent","theme","setShowMembers","toggleMembers","topBarRef","bottomBarRef","bottomBarHeight","setBottomBarHeight","topBarHeight","setTopBarHeight","hasMoreMessages","setHasMoreMessages","hasNewerMessages","setHasNewerMessages","isLoadingMore","setIsLoadingMore","isLoadingNewer","setIsLoadingNewer","messageScrollerRef","offsetHeight","handleLoadMore","Promise","resolve","handleLoadNewer","right","backgroundColor","borderBottom","marginTop","boxSizing","onMessageSent","List","ListItem","ListItemAvatar","ListItemText","RoomMembers","isFetchingMembers","sortedMembers","sort","a","member","primary","secondary","loadHistoryByEventId","limit","events","isEnd","timeline","room","getRoom","timelineSet","getUnfilteredTimelineSet","getEventTimeline","paginateEventTimeline","backwards","getEvents","ev","unsigned","batchAddHistoryMessages","matrixLoadHistory","Virtuoso","isDev","MessageListVirtuoso","setLoading","historyEnd","setHistoryEnd","loadingHistory","setLoadingHistory","virtuosoRef","containerRef","anchorMsgIdRef","autoCompensate","setAutoCompensate","messageListLen","handleTotalListHeightChanged","anchorMsg","newIndex","findIndex","msg","anchorMsgId","scrollToIndex","index","align","stopCompensate","addEventListener","removeEventListener","handleAtTopStateChange","atTop","totalListHeightChanged","data","itemContent","followOutput","atTopStateChange","components","EmptyPlaceholder","Header","RoomContent2","AppbarContainer","AppShell","RoomPage","isReady","appbarProps"],"sourceRoot":"","ignoreList":[1,27]}