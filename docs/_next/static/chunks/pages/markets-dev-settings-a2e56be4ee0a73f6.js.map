{"version":3,"file":"static/chunks/pages/markets-dev-settings-a2e56be4ee0a73f6.js","mappings":"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","sources":["webpack://_N_E/./src/markets/market-dev-socket-setting-data.ts","webpack://_N_E/./src/markets/markets-script-dev-lib.ts","webpack://_N_E/../../../src/types/market.intf.ts","webpack://_N_E/../../../src/watcher/useWatchUpdates.tsx","webpack://_N_E/../../../../src/utils/socket/socket-utils.ts","webpack://_N_E/?29aa","webpack://_N_E/./src/markets/market-html-utils.ts","webpack://_N_E/./src/markets/market-dev-socket.ts","webpack://_N_E/../../../src/mc/static-model.ts","webpack://_N_E/../../../../src/components/motion/page-transition.tsx","webpack://_N_E/../../../../src/components/app/PageShell.tsx","webpack://_N_E/../../../../src/components/appbar/AppBar.tsx","webpack://_N_E/../../../../src/components/app/AppPageDataWrapperShell.tsx","webpack://_N_E/./src/components/page/markets-dev-settings/data/context.tsx","webpack://_N_E/./src/components/page/markets-dev-settings/content/DevSettings.tsx","webpack://_N_E/./src/components/page/markets-dev-settings/content/Scripts.tsx","webpack://_N_E/./src/components/page/markets-dev-settings/content/MarketsDevSettingsContent.tsx","webpack://_N_E/./src/components/page/markets-dev-settings/data/data.intf.ts","webpack://_N_E/./src/pages/markets-dev-settings/index.tsx"],"sourcesContent":["import { storeUtils, toProxy } from \"@fanfanlo\";\r\n\r\nexport interface ISocketSettingData{\r\n    //如果点击开始链接了，那就保持链接，这样需要注意不在开发环境时会不停重连。\r\n    keepConnect:boolean;\r\n    url:string;\r\n}\r\n\r\nasync function createDefSocketSettingData():Promise<ISocketSettingData>{\r\n    const data =  {\r\n        keepConnect:false,\r\n        url:\"\"     \r\n     }\r\n     const res = await storeUtils.getNamespaceStoreWithData('market-dev-socket-setting', {defData:data})\r\n     return res.data;\r\n}\r\n\r\nexport async function getMarketDevSocketSettingData():Promise<ISocketSettingData>{\r\n    return await createDefSocketSettingData()\r\n}","import { autoJsStoreUtils } from \"@droid/android\"\r\nimport { IStoreWithData, storeUtils, toProxy } from \"@fanfanlo\"\r\nimport { IAndroidWatchFile, IMarketDevConnectEventType, IMarketDevGetAllEventData, IMarketDevServerEventType, WatchResourceType } from \"@market/lib\"\r\nimport { marketsDevSocket } from \"./market-dev-socket\"\r\nimport { objectCountUtils } from \"@fanfanlo\"\r\ninterface IMarketDevLibInfo{\r\n    allMarketLibData?:IMarketDevGetAllEventData\r\n    \r\n}\r\n// 注意marketDevLibData的操作是由devLibInfo来做的\r\n// 一定保持它俩操作的对象是同一个。\r\nconst marketDevLibData = toProxy<IMarketDevLibInfo>({})\r\nlet devLibInfo:IStoreWithData<IMarketDevLibInfo>// = storeUtils.getNamespaceStoreWithData('devLibInfo', {defData:{}, forceReset:false});\r\n\r\nfunction getMarketScriptDataNsPrefix() {\r\n    return 'market-script-data'\r\n}\r\n\r\nfunction createMarketScriptDataNsPath(ns: string) {\r\n    return `${getMarketScriptDataNsPrefix()}/${ns}`\r\n}\r\n\r\nasync function writeNsAllFiles(ns: string, files: Record<string, string>) {\r\n    const nsPath = createMarketScriptDataNsPath(ns)\r\n    const oldFiles = autoJsStoreUtils.read<string[]>(nsPath) || [];\r\n    for (const name of Object.keys(files)) {\r\n        const index = oldFiles.indexOf(name);\r\n        if (index > -1) {\r\n            oldFiles.splice(index, 1);\r\n        }\r\n        const content = files[name]\r\n        autoJsStoreUtils.write(`${nsPath}/${name}`, content)\r\n    }\r\n    for (const name of oldFiles) {\r\n        removeFile(`${nsPath}/${name}`)\r\n    }\r\n}\r\n\r\nfunction writeFile(name: string, content: string) {\r\n\r\n}\r\n\r\nfunction readNsAllFiles(ns: string) {\r\n\r\n}\r\n\r\nfunction readFile(name: string) {\r\n\r\n}\r\n\r\nfunction removeFile(name: string) {\r\n\r\n}\r\n\r\nfunction getAllMarkets() {\r\n\r\n}\r\nfunction listenDev(){\r\n    marketsDevSocket.dispatcher.addListener(IMarketDevConnectEventType.getAllScripts, onGetAllScript)\r\n    marketsDevSocket.dispatcher.addListener(IMarketDevServerEventType.update, onFileUpdate)    \r\n}\r\n\r\nfunction onGetAllScript(data:IMarketDevGetAllEventData){\r\n    // console.log('onGetAllScript=2', data)\r\n    // console.log('devLibInfo.data=', devLibInfo.data)\r\n    devLibInfo.data.allMarketLibData = data;\r\n    // 转为已经代理过的对象\r\n    marketDevLibData.allMarketLibData = devLibInfo.data.allMarketLibData;\r\n    // console.log('from onGetAllScript look look id', objectCountUtils.getObjectCount(devLibInfo.data.allMarketLibData.resources))\r\n}\r\n\r\nfunction onFileUpdate(data:IAndroidWatchFile){\r\n    if(data.client.resourceType == WatchResourceType.Html){\r\n        if(!devLibInfo.data.allMarketLibData)return;\r\n        for(const html of devLibInfo.data.allMarketLibData.htmls){\r\n            if(html.client.path == data.client.path){\r\n                html.content = data.content;\r\n                return;\r\n            }\r\n        }\r\n    }else if(data.client.resourceType == WatchResourceType.Js){\r\n        if(!devLibInfo.data.allMarketLibData)return;\r\n        for(let index = 0; index < devLibInfo.data.allMarketLibData.resources.length; index ++){\r\n            const script = devLibInfo.data.allMarketLibData.resources[index];\r\n            if(script.client.path == data.client.path){\r\n                devLibInfo.data.allMarketLibData.resources[index] = data;\r\n                console.log('market script dev scripts update script', data)\r\n                // devLibInfo.data.allMarketLibData.resources = [...devLibInfo.data.allMarketLibData.resources];\r\n                // console.log('update data', data);\r\n                // console.log('look look id', objectCountUtils.getObjectCount(devLibInfo.data.allMarketLibData.resources), devLibInfo.data.allMarketLibData.resources)\r\n                return;\r\n            }\r\n        }\r\n    }else{\r\n        // unknown resource type\r\n    }\r\n}\r\nlet isInitialized = false;\r\nasync function init() {\r\n    if(isInitialized){\r\n        return;\r\n    }\r\n    isInitialized = true;\r\n    listenDev();\r\n    devLibInfo = await storeUtils.getNamespaceStoreWithData('devLibInfo', {defData:{}, forceReset:false});\r\n    marketDevLibData.allMarketLibData = devLibInfo.data.allMarketLibData\r\n}\r\nexport const marketsDevScriptLib = {\r\n    writeFile,\r\n    readFile,\r\n    writeNsAllFiles,\r\n    readNsAllFiles,\r\n    getAllMarkets,\r\n    init,\r\n    marketDevLibData,\r\n}\r\n","export enum ScriptType {\r\n    // 只有一个脚本执行文件，它只在脚本列表里显示。\r\n    // 如果要修改或者配置参数，它可以嵌入到自己的代码里\r\n    // 或者提供新的页面路径，用router的方式打开\r\n    // 例如router.go({url:'/script-setting', script:'function(){//code is here}', pagePath:'/all-script-setting/#your-namespace/script/script001'})\r\n    // all-script-setting所有第三方统一页面\r\n    // your-namespace 第三方自己的命名空间\r\n    // url 第三方自己的js文件url，它和script二选一，优先script。\r\n    // script 第三方自己纯代码的脚本\r\n    // url可以设置为实时更新版本，script可以作为stable版本使用。\r\n    // script001 第三方自己的脚本名称\r\n    // pagePath可以挂载到你指定的路径下\r\n    Script = 'script',\r\n    Market = 'market'\r\n}\r\nexport enum WatchResourceType {\r\n    // 这是一个js文件，加载后直接套在iframe里用即可\r\n    Js = 'js',\r\n    // 这是一个html文件，直接当html加载到iframe里即可.\r\n    Html = 'html'\r\n}\r\n\r\nexport enum IMarketDevConnectEventType{\r\n    getAllScripts = 'getAllScripts'\r\n}\r\n// client用socket向server发送的消息，也就是安卓端或者是安卓端的网页向server发送的消息\r\nexport enum IMarketDevClientEmitEventType{\r\n    init = 'init'\r\n}\r\n// server用socket向安卓端发送的消息（本地调试也可以认为是向安卓的网页发送消息）\r\nexport enum IMarketDevServerEventType{\r\n    update = 'update',\r\n}\r\n\r\n// export interface IMarketDevFileUpdateEventData{\r\n//     filePath:string,\r\n//     conf:IClientWatchFile\r\n// }\r\n\r\nexport interface IMarketDevFileUpdateEvent extends IMarketDevEvent<IAndroidWatchFile>{\r\n    type: IMarketDevServerEventType.update,\r\n    data:IAndroidWatchFile\r\n}\r\n\r\nexport interface IMarketDevGetAllEventData{\r\n    resources:IAndroidWatchFile[]\r\n    htmls:IAndroidWatchFile[]\r\n}\r\nexport interface IMarketDevGetAllEvent extends IMarketDevEvent<IMarketDevGetAllEventData>{\r\n    type: IMarketDevConnectEventType.getAllScripts,\r\n    data:IMarketDevGetAllEventData\r\n}\r\nexport type IMarketDevEventType = IMarketDevConnectEventType | IMarketDevClientEmitEventType | IMarketDevServerEventType;\r\nexport interface IMarketDevEvent<T>{\r\n    type: IMarketDevEventType,\r\n    data:T\r\n}\r\ntype NamespaceType = string;\r\nexport interface IScriptFile{\r\n\r\n    // 命名空间 用于识别唯一对象\r\n    // 每个用户用自己的用户名做命名空间\r\n    // 例如\r\n    // 0xFF336699/e-commerce\r\n    ns:NamespaceType\r\n    resourceType:WatchResourceType\r\n    scriptType:ScriptType\r\n    // 通过网络加载的路径\r\n    url?:string;\r\n}\r\n\r\nexport interface IClientWatchFile extends IScriptFile{\r\n    // 本地加载的路径\r\n    path:string;\r\n    //是否是ui模式输出，如果是ui模式输出则需要export {ScriptItem, MarketItem, MarketPage}当中之一或全部。\r\n    // isUi:boolean\r\n}\r\nexport interface IClientScriptConf extends IClientWatchFile{\r\n}\r\n\r\nexport interface IClientHtmlConf extends IClientWatchFile{\r\n    resourcesPath:string\r\n    resourcesUrl:string\r\n}\r\n\r\nexport interface IAndroidWatchFile{\r\n    client:IClientWatchFile\r\n    content:string\r\n}\r\n\r\n// 脚本文件map，这里是打散的，并没有按照开发者的ns分类，而是按照文件名分类\r\n// 也就是文件名当作分类了。开发者有个ns，但是一个开发者可以开发n个market\r\n// 所以用开发者的ns做限定是不够用的，现在想的是开发者ns+market or script做market的限定\r\n// 所以这个ns应该是：\r\n// `${developerNs}/markets/${market}`\r\n// `${developerNs}/markets/${market}/${script}`\r\n// `${developerNs}/scripts/${script}`\r\n// 这种格式，回头可以用分段的方式来截取对象\r\nexport type ScriptMap = Record<NamespaceType, IAndroidWatchFile>;","import _ from \"lodash\"\r\nimport { useEffect, useState } from \"react\"\r\nimport { IWatchUpdatesConfig, watchUpdates } from \"./watchUpdates\"\r\nimport { PropertiesChain } from \"./proxyWatch\"\r\nimport { useProxyWatch } from \"./useProxyWatch\"\r\nimport { objectCountUtils } from \"../utils\"\r\n\r\n/**\r\n * \r\n * 注意，返回的无论是object还是array，都无法监听，因为它们不是proxy，而是原始对象的副本\r\n * @param target 要监听的对象\r\n * @param conf 监听配置\r\n * @returns 监听的对象\r\n */\r\nexport function useWatchUpdates<T extends object>(target: T, conf?: IWatchUpdatesConfig<T>):[T]{\r\n    const [value, setValue] = useState<T>(target)\r\n    useEffect(() => {\r\n        console.log('use watch updates look look id', objectCountUtils.getObjectCount(target))\r\n        watchUpdates(target, (info)=>{\r\n            console.log('uuuuuuuuuupdated', info)\r\n            console.log('tttttttarget=',target);\r\n            const now = _.isArray(info.target) ? [...info.target] : info.target\r\n            // setValue(now as T)\r\n            setValue((_.isArray(target) ? [...target ] : {...target}) as T)\r\n        }, conf)\r\n    }, [])\r\n    return [value as T]\r\n}\r\n\r\n/**\r\n * useProxyWatch + useWatchUpdates 结合体\r\n * 因为react的刷新机制，所以第二个state必须得用setState才会生效。\r\n * 不然其实这是两行代码，第一行是useProxyWatch，第二行是useWatchUpdates就可以了。\r\n * @param target 要监听的对象\r\n * @param propertyChain 要监听的属性链\r\n * @param defaultValue 默认值\r\n * @param conf 监听配置\r\n * @returns 监听的对象 返回的第一个参数是重新拼装的{...arr} or {...obj}，第二个参数是原始的target or defaultValue\r\n */\r\nexport function useProxyWatchUpdates<T extends object, U extends object>(target:T,\r\n  propertyChain: PropertiesChain<T>,\r\n  defaultValue: U,\r\n  conf?: IWatchUpdatesConfig<U> ):[U, U]{\r\n    const [v] = useProxyWatch(target, propertyChain, defaultValue)\r\n    const [value, setValue] = useState<U>(defaultValue)\r\n    useEffect(() => {\r\n        watchUpdates(v, (info)=>{\r\n            // console.log('uuuuuuuuuupdatedaaaaa', info)\r\n            // console.log('tttttttargetaaaaa=',target);\r\n            setValue((_.isArray(v) ? [...v ] : {...v}) as U)\r\n        }, conf)\r\n    }, [v])\r\n    return [value, v]\r\n  }","import validator from \"validator\";\r\nimport { loadI18nValue } from \"../../i18n\";\r\nexport function isValidWebSocketURL(url: string): boolean {\r\n    if(!url)return false;\r\n    return validator.isURL(url, { protocols: ['ws','wss'], require_protocol: true });\r\n  }\r\n  \r\n\r\nexport enum SocketConnectStatusEnum {\r\n    connecting = \"connecting\",\r\n    connected = \"connected\",\r\n    disconnecting = \"disconnecting\",\r\n    disconnected = \"disconnected\",\r\n    waitRetry = \"waitRetry\"\r\n}\r\n\r\nexport async function getSocketConnectStatusEnumI18n(status:SocketConnectStatusEnum){\r\n    return await loadI18nValue('fanfanlo/utils/socket/content', `status.${status}`);\r\n}","\n    (window.__NEXT_P = window.__NEXT_P || []).push([\n      \"/markets-dev-settings\",\n      function () {\n        return require(\"private-next-pages/markets-dev-settings/index.tsx\");\n      }\n    ]);\n    if(module.hot) {\n      module.hot.dispose(function () {\n        window.__NEXT_P.push([\"/markets-dev-settings\"])\n      });\n    }\n  ","import { IFrameHtmlBuilderOptions } from \"@fanfanlo\";\n\nfunction createHtml(script: string, opts?:IFrameHtmlBuilderOptions) {\n    return `<html>\n    <head>\n    <script type=\"importmap\">\n  {\n    \"imports\": {\n      \"react\": \"https://esm.sh/react@19\",\n      \"react-dom/client\": \"https://esm.sh/react-dom@19/client\"\n    }\n  }\n</script>\n        <script>\n                const IFRAME_ID = '${opts?.iframeId}';\n                window.IFRAME_ID = '${opts?.iframeId}';\n                \n            var autoWebViewJs = window.autoWebViewJs = window.parent.window.autoWebViewJs;\n            autoWebViewJs = window.parent.window.autoWebViewJs;\n            var callScript = window.callScript = autoWebViewJs.callScript;\n            var callScriptByConf = window.callScriptByConf = autoWebViewJs.callScriptByConf;\n            var isRealInAndroid = window.isRealInAndroid;\n            // var storeUtilsConf = window.storeUtilsConf = window.parent.window.storeUtilsConf;\n            var storeUtilsConf = window.storeUtilsConf = {\n                ns:{},\n                read:window.parent.window.storeUtilsConf.read,\n                write:window.parent.window.storeUtilsConf.write   \n            }\n        </script>\n        <title>droid lego</title>\n        <style>html, body{margin-left:-0px;padding:0;\n        background-color: white;}</style>\n    </head>\n    <body>\n        <div id=\"app\"></div>\n        <script>${script}</script>\n        <script>\n                // const IFRAME_ID = '${opts?.iframeId}';\n                function notifyResize() {\n                    const body = document.body;\n                    const html = document.documentElement;\n                    \n                    // 获取实际内容高度（取最大值）\n                    const height = Math.max(\n                        body.scrollHeight,\n                        body.offsetHeight,\n                        html.scrollHeight,\n                        html.offsetHeight\n                    );\n                    \n                    // 获取实际内容宽度\n                    const width = Math.max(\n                        body.scrollWidth,\n                        body.offsetWidth,\n                        html.scrollWidth,\n                        html.offsetWidth\n                    );\n                    \n                    // 发送消息给父窗口\n                    window.parent.postMessage({\n                        type: 'resize',\n                        iframeId: IFRAME_ID,\n                        height,\n                        width\n                    }, '*');\n                }\n                \n                // 监听窗口大小变化\n                window.addEventListener('resize', notifyResize);\n                \n                // 监听DOMContentLoaded，确保DOM加载完毕后调整大小\n                document.addEventListener('DOMContentLoaded', notifyResize);\n                \n                // 监听load事件，确保所有资源加载完毕后调整大小\n                window.addEventListener('load', notifyResize);\n                \n                // 创建MutationObserver监听DOM变化\n                const observer = new MutationObserver(notifyResize);\n                observer.observe(document.documentElement, {\n                    childList: true,\n                    subtree: true,\n                    attributes: true,\n                    characterData: true\n                });\n                \n                // 监听来自父窗口的消息，处理请求重新调整大小的消息\n                window.addEventListener('message', function(event) {\n                    if (event.data && event.data.type === 'requestResize') {\n                        // 主动触发一次尺寸计算和发送\n                        notifyResize();\n                    }\n                });\n                \n                // 初始化大小\n                notifyResize();\n        </script>\n    </body>\n</html>`\n}\n\nfunction mergeHtml(html:string, opts?:IFrameHtmlBuilderOptions){\n    let h = html;\n    if(!h.includes('<body')){\n        h = `<body>${h}</body>`\n    }\n    if(!h.includes('<html')){\n        h = `<html>${h}</html>`\n    }\n    if(!h.includes('<head')){\n        h = h.replace('<html>', '<html><head></head>')\n    }\n    h = h.replace('<head>', `<head><script>\n                const IFRAME_ID = '${opts?.iframeId}';\n                window.IFRAME_ID = '${opts?.iframeId}';\n                \n            var autoWebViewJs = window.autoWebViewJs = window.parent.window.autoWebViewJs;\n            autoWebViewJs = window.parent.window.autoWebViewJs;\n            var callScript = window.callScript = autoWebViewJs.callScript;\n            var callScriptByConf = window.callScriptByConf = autoWebViewJs.callScriptByConf;\n            var isRealInAndroid = window.isRealInAndroid;\n            // var storeUtilsConf = window.storeUtilsConf = window.parent.window.storeUtilsConf;\n            var storeUtilsConf = window.storeUtilsConf = {\n                ns:{},\n                read:window.parent.window.storeUtilsConf.read,\n                write:window.parent.window.storeUtilsConf.write   \n            }\n        </script>\n        \n        <style>html, body{margin-left:-0px;padding:0;\n        background-color: white;}</style>`);\n\n    h = h.replace(`</body>`, `\n        \n        <script>\n                function notifyResize() {\n                    const body = document.body;\n                    const html = document.documentElement;\n                    \n                    // 获取实际内容高度（取最大值）\n                    const height = Math.max(\n                        body.scrollHeight,\n                        body.offsetHeight,\n                        html.scrollHeight,\n                        html.offsetHeight\n                    );\n                    \n                    // 获取实际内容宽度\n                    const width = Math.max(\n                        body.scrollWidth,\n                        body.offsetWidth,\n                        html.scrollWidth,\n                        html.offsetWidth\n                    );\n                    \n                    // 发送消息给父窗口\n                    window.parent.postMessage({\n                        type: 'resize',\n                        iframeId: IFRAME_ID,\n                        height,\n                        width\n                    }, '*');\n                }\n                \n                // 监听窗口大小变化\n                window.addEventListener('resize', notifyResize);\n                \n                // 监听DOMContentLoaded，确保DOM加载完毕后调整大小\n                document.addEventListener('DOMContentLoaded', notifyResize);\n                \n                // 监听load事件，确保所有资源加载完毕后调整大小\n                window.addEventListener('load', notifyResize);\n                \n                // 创建MutationObserver监听DOM变化\n                const observer = new MutationObserver(notifyResize);\n                observer.observe(document.documentElement, {\n                    childList: true,\n                    subtree: true,\n                    attributes: true,\n                    characterData: true\n                });\n                \n                // 监听来自父窗口的消息，处理请求重新调整大小的消息\n                window.addEventListener('message', function(event) {\n                    if (event.data && event.data.type === 'requestResize') {\n                        // 主动触发一次尺寸计算和发送\n                        notifyResize();\n                    }\n                });\n                \n                // 初始化大小\n                notifyResize();\n        </script>\n        </body>`);\n        console.log('hhhhhhhhhhhhh=', h);\n    return h;\n}\nasync function createHtmlByUrl(url: string, opts?:IFrameHtmlBuilderOptions) {\n    const res = await fetch(url);\n    const content = await res.text();\n    return createHtml(content, opts);\n}\nexport const marketHtmlUtils = {\n    createHtml,\n    createHtmlByUrl,\n    mergeHtml\n}","import { Dispatcher, isValidWebSocketURL, SocketConnectStatusEnum, toProxy } from \"@fanfanlo\";\r\nimport { IMarketDevConnectEventType, IMarketDevEvent } from \"@market/lib\";\r\nimport { getMarketDevSocketSettingData } from \"./market-dev-socket-setting-data\";\r\nconst dispatcher = new Dispatcher();\r\ninterface ISocketConnectInfo{\r\n    status:SocketConnectStatusEnum;\r\n    retryCount:number;\r\n}\r\n\r\nexport const socketConnectInfo:ISocketConnectInfo = toProxy({\r\n    status:SocketConnectStatusEnum.disconnected,\r\n    retryCount:0\r\n})\r\nlet ws:WebSocket|undefined;\r\nasync function connect(){\r\n    const url = (await getMarketDevSocketSettingData()).url\r\n    if(!isValidWebSocketURL(url)){\r\n        return;\r\n    }\r\n    socketConnectInfo.status = SocketConnectStatusEnum.connecting;\r\n    const w = ws = new WebSocket(url);\r\n    w.onopen = () => {\r\n        socketConnectInfo.status = SocketConnectStatusEnum.connected;\r\n        toGetAllScripts();\r\n    }\r\n    w.onclose = () => {\r\n        console.log('oscket on close', arguments)\r\n        socketConnectInfo.status = SocketConnectStatusEnum.disconnected;\r\n        checkNeedRetry();\r\n    }\r\n    w.onerror = () => {\r\n        console.log('socket onerror', arguments)\r\n        socketConnectInfo.status = SocketConnectStatusEnum.disconnected;\r\n        close();\r\n        checkNeedRetry();\r\n    }\r\n    w.onmessage = (e:MessageEvent) => {\r\n        try{\r\n            const event:IMarketDevEvent<any> = JSON.parse(e.data)\r\n            console.log('market dev socket onmessage', event.type)\r\n            dispatcher.dispatch(event.type, event.data)\r\n        }catch(e){\r\n            console.error(e)\r\n        }\r\n    }\r\n\r\n    async function toGetAllScripts(){\r\n        const event = {type: IMarketDevConnectEventType.getAllScripts}\r\n        w.send(JSON.stringify(event));\r\n    }\r\n}\r\nfunction close(){\r\n    if(!ws)return;\r\n    ws.close();\r\n    ws = undefined;\r\n}\r\nasync function checkNeedRetry(){\r\n    const settingData = await getMarketDevSocketSettingData()\r\n    if(!settingData.keepConnect){\r\n        return;\r\n    }\r\n    socketConnectInfo.retryCount++;\r\n    setTimeout(()=>{\r\n        connect();\r\n    }, 1000 * 5)\r\n}\r\nfunction disconnect(){\r\n    if(ws){\r\n        ws.close();\r\n        ws = undefined;\r\n    }\r\n    socketConnectInfo.status = SocketConnectStatusEnum.disconnected;\r\n}\r\nexport const marketsDevSocket = {\r\n    connect,\r\n    disconnect,\r\n    socketConnectInfo,\r\n    dispatcher\r\n}\r\n","import { Dispatcher } from \"@fanfanlo\"\r\nimport { DispatcherUnsubscribe } from \"@fanfanlo\"\r\n\r\nconst dipsatcher = new Dispatcher()\r\ninterface IStaticModel{\r\n    dipsatcher:Dispatcher\r\n    screenLockCount:number\r\n    switchPage:()=>void\r\n    listenSwitchPage:(callback:()=>void)=>DispatcherUnsubscribe \r\n}\r\nexport const staticModel:IStaticModel = {\r\n    dipsatcher,\r\n    screenLockCount:0,\r\n    switchPage:async()=>{\r\n        dipsatcher.dispatch(\"switchPage\")\r\n        staticModel.screenLockCount = 0\r\n    },\r\n    listenSwitchPage:(callback:()=>void)=>{\r\n        return dipsatcher.addListener(\"switchPage\",callback)\r\n    }\r\n}   \r\n","import { PropsWithChildren } from \"react\";\r\nimport { AnimatePresence, motion } from \"framer-motion\";\r\nimport { useRouter } from \"next/router\";\r\n\r\n\r\nexport function PageTransition({ children }: PropsWithChildren) {\r\n    const router = useRouter()\r\n    return (\r\n\r\n        <AnimatePresence mode=\"sync\">\r\n            <motion.div\r\n                key={router.route}\r\n                initial={{ opacity: 0, y: 10 }}\r\n                animate={{ opacity: 1, y: 0 }}\r\n                exit={{ opacity: 0, y: -110 }}\r\n                transition={{ duration: 0.3 }}\r\n            >\r\n                {children}\r\n            </motion.div>\r\n        </AnimatePresence>\r\n    )\r\n}","import { staticModel } from \"@app/static\";\r\nimport { Box } from \"@mui/material\";\r\nimport { useEffect } from \"react\";\r\nimport { PageTransition } from \"../motion\";\r\nlet idCount = 0\r\nexport function PageShell({children}:{children:React.ReactNode}){\r\n    const id = `app-shell-${idCount++}`\r\n    useEffect(()=>{\r\n        const box = document.querySelector(`#${id}`)\r\n        const unlisten = staticModel.listenSwitchPage(()=>{\r\n            if(!box)return\r\n        })\r\n        if(!box)return\r\n        box.addEventListener(\"click\",(e)=>{\r\n            if(staticModel.screenLockCount == 0)return\r\n            e.stopPropagation()\r\n            e.preventDefault()\r\n        })\r\n        return ()=>{\r\n            unlisten()\r\n        }\r\n    },[])\r\n    return (\r\n        <Box id={id}>\r\n            <PageTransition>\r\n                {children}  \r\n            </PageTransition>\r\n        </Box>\r\n    )\r\n}\r\n","import { AppBar, Box, Container, CssBaseline, Fab, Fade, Slide, Toolbar, Typography, useScrollTrigger } from \"@mui/material\";\r\nimport { PropsWithChildren, ReactNode } from \"react\";\r\n// import {AndroidPageContent} from \"../../\";\r\nimport { browserHistoryUtils, IDispatcher } from \"@fanfanlo\";\r\nimport KeyboardArrowLeft from '@mui/icons-material/KeyboardArrowLeft';\r\nimport KeyboardArrowUpIcon from '@mui/icons-material/KeyboardArrowUp';\r\nimport * as React from \"react\";\r\nimport { useRouter } from \"next/router\";\r\nimport { PageShell } from \"../app/PageShell\";\r\nimport shadows from \"@mui/material/styles/shadows\";\r\nimport AndroidPageContent from \"../page/AndroidPageContent\";\r\nimport { IAppBarBackAskEvent } from \"@app/static\";\r\nimport { ITitleI18nConf } from \"../page\";\r\ninterface Props {\r\n    /**\r\n     * Injected by the documentation to work in an iframe.\r\n     * You won't need it on your project.\r\n     */\r\n    window?: () => Window;\r\n    children?: React.ReactElement<unknown>;\r\n}\r\n\r\nfunction HideOnScroll(props: Props) {\r\n    const { children, window } = props;\r\n    // Note that you normally won't need to set the window ref as useScrollTrigger\r\n    // will default to window.\r\n    // This is only being set here because the demo is in an iframe.\r\n    const trigger = useScrollTrigger({\r\n        target: window ? window() : undefined,\r\n    });\r\n\r\n    return (\r\n        <Slide appear={false} direction=\"down\" in={!trigger}>\r\n            {children ?? <div />}\r\n        </Slide>\r\n    );\r\n}\r\nexport interface IAppbarProps extends PropsWithChildren {\r\n    title: ReactNode\r\n    back: boolean\r\n    backHandler?: () => boolean\r\n    backDispatcher?:IDispatcher\r\n}\r\nexport function Appbar({ title }: { title: ReactNode } & PropsWithChildren) {\r\n    return (\r\n\r\n        <AppBar color={\"inherit\"}>\r\n            <Toolbar>\r\n                <Typography variant=\"h6\" component=\"div\">\r\n                    {title}\r\n                </Typography>\r\n            </Toolbar>\r\n        </AppBar>\r\n    )\r\n}\r\n\r\ninterface IAppbarContainerProps extends PropsWithChildren {\r\n    appbarProps: IAppbarProps\r\n    titleConf?:ITitleI18nConf\r\n    reload?: boolean\r\n}\r\n\r\n// export interface IAppBarBackAskEvent{\r\n//     defaultPrevented:boolean\r\n// }\r\n\r\nfunction ScrollTop(props: Props) {\r\n    const { children, window } = props;\r\n    // Note that you normally won't need to set the window ref as useScrollTrigger\r\n    // will default to window.\r\n    // This is only being set here because the demo is in an iframe.\r\n    const trigger = useScrollTrigger({\r\n        target: window ? window() : undefined,\r\n        disableHysteresis: true,\r\n        threshold: 100,\r\n    });\r\n\r\n    const handleClick = (event: React.MouseEvent<HTMLDivElement>) => {\r\n        const anchor = (\r\n            (event.target as HTMLDivElement).ownerDocument || document\r\n        ).querySelector('#back-to-top-anchor');\r\n\r\n        if (anchor) {\r\n            anchor.scrollIntoView({\r\n                block: 'center',\r\n            });\r\n        }\r\n    };\r\n\r\n    return (\r\n        <Fade in={trigger}>\r\n            <Box data-id=\"content-scroll-top-button\"\r\n                onClick={handleClick}\r\n                role=\"presentation\"\r\n                sx={{ position: 'fixed', bottom: 16, right: 16 }}\r\n            >\r\n                {children}\r\n            </Box>\r\n        </Fade>\r\n    );\r\n}\r\nexport function AppbarContainer(props: IAppbarContainerProps) {\r\n    const { children, appbarProps, titleConf, reload } = props;\r\n    const router = useRouter()\r\n    function handleBack(){\r\n        // 本想抽象成底层一个方法，但是考虑了一下router需要注入或者是一个callback，似乎像现在这样判断一下event也可以。回头继续观察一下吧。\r\n        const event = browserHistoryUtils.askHistoryBack()\r\n        if(event.defaultPrevented)return\r\n        if(appbarProps.backDispatcher){\r\n            const e:IAppBarBackAskEvent = {defaultPrevented:false}\r\n            appbarProps.backDispatcher.dispatch('back',e)\r\n            if(e.defaultPrevented)return\r\n        }\r\n        router.back()\r\n    }\r\n    return (\r\n        <PageShell>\r\n        <React.Fragment>\r\n            <CssBaseline />\r\n            <HideOnScroll {...props}>\r\n                <AppBar color=\"inherit\">\r\n                    <Toolbar>\r\n                        <KeyboardArrowLeft onClick={handleBack} />\r\n                        {appbarProps.title}\r\n                    </Toolbar>\r\n                </AppBar>\r\n            </HideOnScroll>\r\n            <Toolbar id=\"back-to-top-anchor\" />\r\n            <Container sx={{padding:\"0\", marginTop:\"17px\"}}>\r\n                <AndroidPageContent titleConf={titleConf} reload={reload}>\r\n                    {children}\r\n                </AndroidPageContent>\r\n            </Container>\r\n\r\n            <ScrollTop {...props}>\r\n                <Fab size=\"small\" aria-label=\"scroll back to top\">\r\n                    <KeyboardArrowUpIcon />\r\n                </Fab>\r\n            </ScrollTop>\r\n        </React.Fragment>\r\n        </PageShell>\r\n    );\r\n}\r\n","import { PropsWithChildren } from \"react\";\r\nimport { AppShell } from \"./AppShell\";\r\nimport { ContextWrapper, ContextWrapperProps } from \"@fanfanlo\";\r\n\r\n//回头想想AppShell里的s要怎么用\r\n// createTypedContext方法返回的context没想好怎么样跟s结合使用。\r\n\r\nexport function AppPageDataWrapperShell<T>({ children, contextValue, ContextProvider }: PropsWithChildren & ContextWrapperProps<T>) {\r\n    return (\r\n        <AppShell>\r\n            <ContextWrapper contextValue={contextValue} ContextProvider={ContextProvider}>\r\n                {children}\r\n            </ContextWrapper>\r\n        </AppShell>\r\n    )\r\n}","import { createTypedContext } from \"@fanfanlo\";\r\nimport { IPageData } from \"./data.intf\";\r\n\r\nexport const [MarketsDevSettingsContextProvider, useMarketsDevSettingsContext] = createTypedContext<IPageData>();","'use client'\r\nimport { getSocketConnectStatusEnumI18n, isValidWebSocketURL, SocketConnectStatusEnum, useProxyWatch, useTranslation } from \"@fanfanlo\";\r\nimport { Box, Button, Checkbox, FormControlLabel, Grid2, Stack, TextField } from \"@mui/material\";\r\nimport { marketsDevSocket } from \"@src/markets/market-dev-socket\";\r\nimport { useEffect, useState } from \"react\";\r\nimport { useMarketsDevSettingsContext } from \"../data/context\";\r\n\r\nfunction URL() {\r\n    const { t } = useTranslation('homepage/components/page/markets-dev-settings/content/content');\r\n    const pageData = useMarketsDevSettingsContext()\r\n    const [value, _setValue] = useState(pageData.socketSettingData.url)\r\n    const [isWrong, setIsWrong] = useState(!isValidWebSocketURL(value))\r\n    function setValue(v: string) {\r\n        _setValue(v)\r\n        pageData.socketSettingData.url = v\r\n        if (!isValidWebSocketURL(v)) {\r\n            setIsWrong(true)\r\n        } else {\r\n            setIsWrong(false)\r\n        }\r\n    }\r\n    const s = t(\"DevSettings.socket.url.helperText\", { 0: \"socket\", 1: \"ws\", 2: \"wss\", 3: \"url\" })\r\n    return (\r\n        <Box>\r\n            <TextField fullWidth\r\n                error={isWrong}\r\n                label={t(\"DevSettings.socket.url.name\")}\r\n                value={value}\r\n                placeholder={\"ws://192.168.1.2:7001\"}\r\n                helperText={isWrong ? s : \"\"}\r\n                variant=\"standard\"\r\n                onChange={(e) => setValue(e.target.value)}\r\n            />\r\n        </Box>\r\n    )\r\n}\r\n\r\nfunction ConnectButton2() {\r\n    const pageData = useMarketsDevSettingsContext()\r\n    const [status] = useProxyWatch(marketsDevSocket.socketConnectInfo, 'status', marketsDevSocket.socketConnectInfo.status);\r\n    const [buttonName, setButtonName] = useState('')\r\n    const { t } = useTranslation('homepage/components/page/markets-dev-settings/content/content');\r\n    const [url] = useProxyWatch(pageData.socketSettingData, 'url', pageData.socketSettingData.url);\r\n    const [enabled, setEnabled] = useState(false)\r\n    useEffect(() => {\r\n        setEnabled((status === SocketConnectStatusEnum.disconnected || status === SocketConnectStatusEnum.connected) && isValidWebSocketURL(url))\r\n    }, [status, url])\r\n    useEffect(() => {\r\n        async function updateButtonName() {\r\n            const status = marketsDevSocket.socketConnectInfo.status\r\n            let name = buttonName;\r\n\r\n            switch (status) {\r\n                case SocketConnectStatusEnum.connecting:\r\n                    name = await getSocketConnectStatusEnumI18n(SocketConnectStatusEnum.connecting)\r\n                    break;\r\n                case SocketConnectStatusEnum.connected:\r\n                    name = t(\"DevSettings.connectButton.disconnect\")\r\n                    break;\r\n                case SocketConnectStatusEnum.disconnecting:\r\n                    name = await getSocketConnectStatusEnumI18n(SocketConnectStatusEnum.disconnecting)\r\n                    break;\r\n                case SocketConnectStatusEnum.disconnected:\r\n                    name = t(\"DevSettings.connectButton.connect\")\r\n                    break;\r\n            }\r\n            if(marketsDevSocket.socketConnectInfo.status !== status){\r\n                return updateButtonName();\r\n            }\r\n            if(name !== buttonName){\r\n                setButtonName(name)\r\n            }\r\n        }\r\n        updateButtonName()\r\n    }, [status])\r\n    function onClick() {\r\n        if (status === SocketConnectStatusEnum.disconnected) {\r\n            marketsDevSocket.connect();\r\n        } else {\r\n            marketsDevSocket.disconnect();\r\n        }\r\n    }\r\n    return (\r\n        <Button\r\n            variant=\"contained\"\r\n            disabled={!enabled}\r\n            onClick={onClick}\r\n        >\r\n            {buttonName}\r\n        </Button>\r\n    )\r\n}\r\n\r\nfunction KeepConnectCheckbox() {\r\n    const pageData = useMarketsDevSettingsContext()\r\n    const [keepConnect] = useProxyWatch(pageData.socketSettingData, 'keepConnect', pageData.socketSettingData.keepConnect ?? false);\r\n    const { t } = useTranslation('homepage/components/page/markets-dev-settings/content/content');\r\n    return (\r\n        \r\n        <FormControlLabel control={<Checkbox\r\n            checked={keepConnect}\r\n            onChange={(e) => pageData.socketSettingData.keepConnect = e.target.checked}\r\n        />}\r\n            label={<span><span>{t(\"DevSettings.socket.keepConnect.name\")}</span><span style={{fontSize:'0.8rem', color:'gray'}}>{t(\"DevSettings.socket.keepConnect.helperText\")}</span></span>}>\r\n\r\n        </FormControlLabel>\r\n    )\r\n}\r\n\r\nfunction CheckboxButtonGroup() {\r\n    return (\r\n        <Grid2 container direction={\"row\"} spacing={2}>\r\n            <Grid2 size={\"grow\"}>\r\n                <KeepConnectCheckbox />\r\n            </Grid2>\r\n            <Grid2 size={\"auto\"}>\r\n                <ConnectButton2 />\r\n            </Grid2>\r\n        </Grid2>\r\n    )\r\n}\r\n\r\nexport function DevSettings() {\r\n    const pageData = useMarketsDevSettingsContext()\r\n    useEffect(() => {\r\n        if(pageData.socketSettingData.keepConnect){\r\n            marketsDevSocket.connect();\r\n        }\r\n    }, [])\r\n    return (\r\n        <>\r\n            <Box>\r\n                <Stack direction={\"column\"} spacing={2}>\r\n                    <URL />\r\n                    <CheckboxButtonGroup />\r\n                </Stack>\r\n            </Box>\r\n        </>\r\n    )\r\n}","import { IFrameReactContainer, useProxyWatchUpdates } from \"@fanfanlo\";\r\nimport { IAndroidWatchFile } from \"@market/lib\";\r\nimport { Box, Stack } from \"@mui/material\";\r\nimport { marketHtmlUtils } from \"@src/markets/market-html-utils\";\r\nimport { marketsDevScriptLib } from \"@src/markets/markets-script-dev-lib\";\r\n\r\nfunction createHtml(script:string){\r\n    // return marketHtmlUtils.createHtml(script);\r\n    return `<html>\r\n    <head>\r\n        <title>script</title>\r\n    </head>\r\n    <body>\r\n        <div id=\"app\"></div>\r\n        <script>${script}</script>\r\n    </body>\r\n</html>`\r\n}\r\nfunction Script({resource}:{resource:IAndroidWatchFile}){\r\n    return(\r\n        <Box>\r\n            <Stack direction=\"column\" spacing={2}>\r\n                <span>{resource.client.path}</span>\r\n                {/* <IFrameReactContainer content={createHtml(resource.content)} /> */}\r\n                <IFrameReactContainer content={resource.content} htmlBuilder={marketHtmlUtils.createHtml} />\r\n            </Stack>\r\n        </Box>\r\n    )\r\n}\r\n\r\nexport function Scripts(){\r\n    const [resources] = useProxyWatchUpdates(marketsDevScriptLib.marketDevLibData, \"allMarketLibData.resources\", marketsDevScriptLib.marketDevLibData.allMarketLibData?.resources || []);\r\n    return(\r\n        <Box>\r\n            {\r\n                marketsDevScriptLib.marketDevLibData.allMarketLibData?.resources?.map((resource, index)=>{\r\n                    return(\r\n                        <Script key={resource.content} resource={resource} />\r\n                    )\r\n                })\r\n            }\r\n        </Box>\r\n    )\r\n}","import { Box } from \"@mui/material\";\r\nimport { DevSettings } from \"./DevSettings\";\r\nimport { Scripts } from \"./Scripts\";\r\n\r\n\r\n\r\n\r\nexport function MarketsDevSettingsContent(){\r\n    return(\r\n        <>\r\n            <Box>\r\n                <DevSettings />\r\n                <Scripts />\r\n                <Box>\r\n                    <button>hello</button>\r\n                </Box>\r\n            </Box>\r\n        </>\r\n    )\r\n}","import { toProxy } from \"@fanfanlo\";\r\nimport { getMarketDevSocketSettingData } from \"@src/markets/market-dev-socket-setting-data\";\r\n\r\nexport interface ISocketSettingData{\r\n    //如果点击开始链接了，那就保持链接，这样需要注意不在开发环境时会不停重连。\r\n    keepConnect:boolean;\r\n    url:string;\r\n}\r\n\r\nexport interface IPageData{\r\n    socketSettingData:ISocketSettingData;\r\n}\r\n\r\nasync function createDefPageData():Promise<IPageData>{\r\n    return {\r\n        socketSettingData:await getMarketDevSocketSettingData()\r\n    }\r\n}\r\n\r\nlet dataImpl:IPageData|undefined\r\nexport async function marketsDevSettingsLoadDefData():Promise<IPageData>{\r\n    if(dataImpl){\r\n        return dataImpl;\r\n    }\r\n    let data:IPageData = await createDefPageData();\r\n    dataImpl = toProxy(data);\r\n    return dataImpl;\r\n}","import { AppbarContainer, AppPageDataWrapperShell } from \"@app/ui\";\r\nimport { autoWebViewJs } from \"@droid/android\";\r\nimport { Dispatcher, isValidWebSocketURL, useTranslation } from \"@fanfanlo\";\r\nimport { IScriptConf } from \"@market/lib\";\r\nimport { Box, Button } from \"@mui/material\";\r\nimport { MarketsDevSettingsContent } from \"@src/components/page/markets-dev-settings/content/MarketsDevSettingsContent\";\r\nimport { MarketsDevSettingsContextProvider } from \"@src/components/page/markets-dev-settings/data/context\";\r\nimport { IPageData, marketsDevSettingsLoadDefData } from \"@src/components/page/markets-dev-settings/data/data.intf\";\r\nimport { marketsDevScriptLib } from \"@src/markets/markets-script-dev-lib\";\r\nimport { Suspense, use } from \"react\";\r\n\r\nexport default function MarketsDevSettingsPage() {\r\n    const { t } = useTranslation('homepage/pages/markets-dev-settings/content');\r\n    return (\r\n        <Suspense fallback={<div>{t(\"content.loadPageData\")}</div>}>\r\n            <Content pageData={marketsDevSettingsLoadDefData()} libInit={marketsDevScriptLib.init()} />\r\n        </Suspense>\r\n    )\r\n}\r\n\r\nfunction Content({ pageData, libInit }: { pageData: Promise<IPageData>, libInit: Promise<void> }) {\r\n\r\n    const { t } = useTranslation('homepage/pages/markets-dev-settings/content');\r\n    const data = use(pageData)\r\n    const dispatcher = new Dispatcher()\r\n    use(libInit)\r\n\r\n    async function onClick() {\r\n        const res = await getContacts();\r\n        console.log('on click res=', res);\r\n    }\r\n    return (\r\n        <AppPageDataWrapperShell\r\n            contextValue={data}\r\n            ContextProvider={MarketsDevSettingsContextProvider}\r\n        >\r\n            <AppbarContainer appbarProps={{ title: t(\"content.title\"), back: true, backDispatcher: dispatcher }}>\r\n                <Box>\r\n                    <Button onClick={onClick}>script</Button>\r\n                </Box>\r\n                <MarketsDevSettingsContent />\r\n            </AppbarContainer>\r\n        </AppPageDataWrapperShell>\r\n    )\r\n}\r\n\r\n\r\nfunction temp(id: string) {\r\n    const x = `\r\n\r\ncontactsPermission.permission = \"android.permission.READ_CONTACTS\";\r\n    var permissions = [contactsPermission];\r\n    var result = {\r\n      permissions: permissions,\r\n      permissionDenied: [],\r\n      permissionsSuccessed: [],\r\n      error: null,\r\n      data: null,\r\n      warning: null,\r\n      info: null,\r\n      isSuccess:false,\r\n    };\r\n\r\n    com.fanfanlo.lib.permissions.PermissionActivity.requestPermissions(context, permissions, true, \"SOS-读取联系人\", onCheckPermissionsCallback);\r\n    \r\n    function missionFailed(){\r\n      webViewJs.callJsEvent(\"${id}-missionFailed\", result, ${id});\r\n      missionComplete();\r\n    }\r\n    \r\n    function missionSuccess(){\r\n      webViewJs.callJsEvent(\"${id}-missionSuccess\", result, ${id});\r\n      missionComplete();\r\n    }\r\n\r\n    function missionComplete(){\r\n      webViewJs.callJsEvent(\"${id}-missionComplete\", result, ${id});\r\n    }\r\n    function onCheckPermissionsCallback(resultMap){\r\n      for(var i = 0; i < permissions.size(); i++){\r\n        var permissionInfo = permissions.get(i);\r\n        var permission = permissionInfo.permission;\r\n        if((permission in resultMap && resultMap[permission] == true) || permissionInfo.required == false)continue;\r\n        result.error = {\r\n          message:\"permission denied\",\r\n          extra:permissionInfo\r\n        }\r\n        missionFailed();\r\n        return;\r\n      }\r\n      runCodeAfterPermissionsAccess();\r\n    }\r\n    \r\n    function runCodeAfterPermissionsAccess(){\r\n      result.isSuccess = true;\r\n      missionSuccess();\r\n    }\r\n    \\`{isOk:\"true\"}\\`\r\n`\r\n}\r\n\r\n\r\nfunction createReadContactsScript(id: string) {\r\n    return `\r\n    var Manifest = Packages.android.Manifest;\r\n    var context = com.fanfanlo.lib.mc.LibMainModel.instance.application;\r\n    var contactsPermission = new Packages.com.fanfanlo.lib.permissions.PermissionRequest(\"android.permission.READ_CONTACTS\", true, null, null, null);\r\n// contactsPermission.permission = \"android.permission.READ_CONTACTS\";\r\n\r\n    var permissions = [contactsPermission];\r\n    var result = {\r\n      permissions: permissions,\r\n      permissionDenied: [],\r\n      permissionsSuccessed: [],\r\n      error: null,\r\n      data: null,\r\n      warning: null,\r\n      info: null,\r\n      isSuccess:false,\r\n    };\r\n    \r\n    com.fanfanlo.lib.permissions.PermissionActivity.requestPermissions(context, permissions, true, \"SOS-读取联系人\", onCheckPermissionsCallback);\r\n\r\n    function missionFailed(){\r\n        webViewJs.callJsEvent(\"${id}-missionFailed\", result, \"${id}\");\r\n        missionComplete();\r\n      }\r\n      \r\n      function missionSuccess(){\r\n        webViewJs.callJsEvent(\"${id}-missionSuccess\", result, \"${id}\");\r\n        missionComplete();\r\n      }\r\n  \r\n      function missionComplete(){\r\n        webViewJs.callJsEvent(\"${id}-missionComplete\", result, \"${id}\");\r\n      }\r\n      function onCheckPermissionsCallback(resultMap){\r\n        for(var i = 0; i < permissions.length; i++){\r\n          var permissionInfo = permissions[i];\r\n          var permission = permissionInfo.permission;\r\n          if(resultMap.get(permission) == true)continue;\r\n          if(permissionInfo.required == false)continue;\r\n          result.error = {\r\n            message:\"permission denied\",\r\n            extra:{\r\n                \"resultMap\":resultMap,\r\n                \"permission\":permission,\r\n                permissionInfo:permissionInfo\r\n            }\r\n          }\r\n          missionFailed();\r\n          return;\r\n        }\r\n        runCodeAfterPermissionsAccess();\r\n      }\r\n      \r\n      function runCodeAfterPermissionsAccess(){\r\n        result.isSuccess = true;\r\n        readContacts();\r\n        missionSuccess();\r\n      }\r\n\r\n      function readContacts(){\r\n        var contentResolver = com.fanfanlo.lib.mc.LibMainModel.instance.application.getContentResolver();\r\n        var ContactsContract = Packages.android.provider.ContactsContract;\r\n        var cursor = contentResolver.query(\r\n        ContactsContract.Contacts.CONTENT_URI,\r\n        null,\r\n        null,\r\n        null,\r\n        null\r\n        );\r\n\r\n        var contactList = [];\r\n        if (cursor !== null && cursor.moveToFirst()) {\r\n        var nameIndex = cursor.getColumnIndex(ContactsContract.Contacts.DISPLAY_NAME);\r\n        var idIndex = cursor.getColumnIndex(ContactsContract.Contacts._ID);\r\n\r\n        do {\r\n            var contactName = cursor.getString(nameIndex);\r\n            var contactId = cursor.getString(idIndex);\r\n\r\n            // 查询电话号码\r\n            let phone = null;\r\n            var hasPhoneNumberIndex = cursor.getColumnIndex(ContactsContract.Contacts.HAS_PHONE_NUMBER);\r\n            var hasPhoneNumber = cursor.getInt(hasPhoneNumberIndex);\r\n            if (hasPhoneNumber > 0) {\r\n            var phoneCursor = contentResolver.query(\r\n                ContactsContract.CommonDataKinds.Phone.CONTENT_URI,\r\n                null,\r\n                ContactsContract.CommonDataKinds.Phone.CONTACT_ID + \" = ?\",\r\n                [contactId],\r\n                null\r\n            );\r\n\r\n            if (phoneCursor !== null && phoneCursor.moveToFirst()) {\r\n                var phoneIndex = phoneCursor.getColumnIndex(ContactsContract.CommonDataKinds.Phone.NUMBER);\r\n                phone = phoneCursor.getString(phoneIndex);\r\n                phoneCursor.close();\r\n            }\r\n            }\r\n\r\n            contactList.push({\r\n            name: contactName,\r\n            phone: phone,\r\n            });\r\n\r\n        } while (cursor.moveToNext());\r\n\r\n        cursor.close();\r\n        }\r\n\r\n        result.data = {contactList};\r\n        var json = com.fanfanlo.lib.utils.JsonUtil.gson2.toJson(result);\r\n        console.log(json);\r\n      }\r\n    `\r\n}\r\n\r\ninterface IPermission{\r\n    permission:string\r\n    required:boolean\r\n    reason:string\r\n    denyInfo:string\r\n    externalKey:string\r\n}\r\ninterface IErorr{\r\n    message:string,\r\n    extra:{\r\n        \"resultMap\":Record<string, boolean>,\r\n        \"permission\":string,\r\n        permissionInfo:IPermission\r\n    }\r\n  }\r\n\r\n  interface IData{\r\n    contactList:IContact[]\r\n  }\r\n  export interface IReadContactsResult {\r\n    permissions?: IPermission[];\r\n    permissionDenied?: IPermission[];\r\n    permissionsSuccessed?: IPermission[];\r\n    data?: IData;\r\n    isSuccess: boolean;\r\n    error?:IErorr\r\n  }\r\n  \r\n  export interface IContact {\r\n    name: string;\r\n    phone?: string;\r\n  }\r\n  \r\nexport async function getContacts() {\r\n    return new Promise((resolve, reject) => {\r\n\r\n        const id = '@fanfanlo/scripts/script001/get-contacts'\r\n        const conf: IScriptConf = {\r\n            bridgeId: id,\r\n            scriptId: id,\r\n            forceStopTime: 1000 * 60 * 20,\r\n            onlyRunSingle: true,\r\n            injects: [\"webViewJs\", \"console\"],\r\n            script: createReadContactsScript(id)\r\n\r\n        }\r\n        function onMessage(event: { type: string, data: IReadContactsResult }) {\r\n            console.log('llllllllllllllllllllllllllaaaddd', event)\r\n            switch (event.type) {\r\n                case \"@fanfanlo/scripts/script001/get-contacts-missionSuccess\":\r\n                    resolve(event.data);\r\n                    break;\r\n                case \"@fanfanlo/scripts/script001/get-contacts-missionSuccess\":\r\n                    reject(event.data);\r\n                    break;\r\n                case \"@fanfanlo/scripts/script001/get-contacts-missionComplete\":\r\n                    window.removeEventListener(\"message\", onMessage);\r\n                    break;\r\n            }\r\n        }\r\n        window.addEventListener('message', onMessage)\r\n        const res = autoWebViewJs.callScriptByConf(conf)\r\n        console.log('getContacts_fn res=', res)\r\n    })\r\n}"],"names":["storeUtils","createDefSocketSettingData","data","keepConnect","url","res","getNamespaceStoreWithData","defData","getMarketDevSocketSettingData","autoJsStoreUtils","toProxy","IMarketDevConnectEventType","IMarketDevServerEventType","WatchResourceType","marketsDevSocket","marketDevLibData","devLibInfo","getMarketScriptDataNsPrefix","createMarketScriptDataNsPath","ns","writeNsAllFiles","files","nsPath","oldFiles","read","name","Object","keys","index","indexOf","splice","content","write","removeFile","writeFile","readNsAllFiles","readFile","getAllMarkets","listenDev","dispatcher","addListener","getAllScripts","onGetAllScript","update","onFileUpdate","allMarketLibData","client","resourceType","Html","html","htmls","path","Js","resources","length","script","console","log","isInitialized","init","forceReset","marketsDevScriptLib","ScriptType","IMarketDevClientEmitEventType","SocketConnectStatusEnum","createHtml","opts","iframeId","mergeHtml","h","includes","replace","createHtmlByUrl","fetch","text","marketHtmlUtils","Dispatcher","isValidWebSocketURL","socketConnectInfo","status","disconnected","retryCount","ws","connect","connecting","w","WebSocket","onopen","connected","toGetAllScripts","onclose","arguments","checkNeedRetry","onerror","close","onmessage","e","event","JSON","parse","type","dispatch","error","send","stringify","undefined","settingData","setTimeout","disconnect","createTypedContext","MarketsDevSettingsContextProvider","useMarketsDevSettingsContext","getSocketConnectStatusEnumI18n","useProxyWatch","useTranslation","Box","Button","Checkbox","FormControlLabel","Grid2","Stack","TextField","useEffect","useState","URL","t","pageData","value","_setValue","socketSettingData","isWrong","setIsWrong","setValue","v","s","fullWidth","label","placeholder","helperText","variant","onChange","target","ConnectButton2","buttonName","setButtonName","enabled","setEnabled","updateButtonName","disconnecting","onClick","disabled","KeepConnectCheckbox","control","checked","span","style","fontSize","color","CheckboxButtonGroup","container","direction","spacing","size","DevSettings","IFrameReactContainer","useProxyWatchUpdates","Script","resource","htmlBuilder","Scripts","map","MarketsDevSettingsContent","button","createDefPageData","dataImpl","marketsDevSettingsLoadDefData","AppbarContainer","AppPageDataWrapperShell","autoWebViewJs","Suspense","use","MarketsDevSettingsPage","fallback","div","Content","libInit","getContacts","contextValue","ContextProvider","appbarProps","title","back","backDispatcher","temp","id","x","createReadContactsScript","Promise","resolve","reject","conf","bridgeId","scriptId","forceStopTime","onlyRunSingle","injects","onMessage","window","removeEventListener","addEventListener","callScriptByConf"],"sourceRoot":"","ignoreList":[]}