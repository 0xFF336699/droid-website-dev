<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>WebView ES Features Test</title>
    <style>
        body {
            font-family: monospace;
            padding: 20px;
            background: #f9f9f9;
        }

        .ok {
            color: green;
        }

        .fail {
            color: red;
        }

        .summary {
            margin-top: 20px;
            font-weight: bold;
        }

        button {
            margin-top: 20px;
            padding: 8px 16px;
            font-size: 16px;
        }

        #info {
            margin-bottom: 20px;
            font-size: 14px;
            color: #555;
        }
    </style>
</head>

<body>
    <h1>WebView ES Features Test</h1>

    <div id="info"></div>
    <pre id="output"></pre>
    <div class="summary" id="summary"></div>
    <button onclick="copyResult()">ğŸ“‹ å¤åˆ¶æ£€æµ‹ç»“æœ</button>

    <script>
        const output = document.getElementById('output');
        const summary = document.getElementById('summary');
        const info = document.getElementById('info');

        // æ˜¾ç¤º UserAgent å’Œå°è¯•æå– Chromium ç‰ˆæœ¬
        const ua = navigator.userAgent;
        let chromeVersion = 'Unknown';
        const match = ua.match(/Chrome\/(\d+)/);
        if (match) {
            chromeVersion = match[1];
        }
        info.innerText = `UserAgent: ${ua}\næ¨æµ‹ Chromium ç‰ˆæœ¬: ${chromeVersion}`;

        const features = [
            { name: 'let/const', code: 'let a = 1; const b = 2;', critical: true },
            { name: 'Arrow Functions', code: 'const fn = () => {};', critical: false },
            { name: 'Template Literals', code: 'const str = `template`;', critical: false },
            { name: 'Destructuring', code: 'const {a, b} = {a:1, b:2};', critical: false },
            { name: 'Default Parameters', code: 'function foo(x = 1) {}', critical: false },
            { name: 'Optional Chaining (?.)', code: 'const obj = {}; const val = obj?.prop;', critical: true },
            { name: 'Nullish Coalescing (??)', code: 'const foo = null ?? "default";', critical: true },
            { name: 'Async/Await', code: 'async function foo() { await Promise.resolve(); }', critical: false },
            { name: 'BigInt', code: 'const big = 123n;', critical: false },
            { name: 'Dynamic Import', code: 'import("data:text/javascript,export default 123")', critical: false },
        ];

        let criticalFailures = [];

        features.forEach(f => {
            try {
                eval(f.code);
                output.innerHTML += `[âœ”ï¸] ${f.name} supported\n`;
            } catch (e) {
                output.innerHTML += `[âŒ] ${f.name} NOT supported\n`;
                if (f.critical) {
                    criticalFailures.push(f.name);
                }
            }
        });

        if (criticalFailures.length === 0) {
            summary.innerHTML = `âœ… æ­å–œï¼æ‚¨çš„ WebView æ”¯æŒå¤§éƒ¨åˆ†ç°ä»£ JS ç‰¹æ€§ï¼Œå…¼å®¹æ€§è‰¯å¥½ã€‚`;
        } else {
            summary.innerHTML = `âš ï¸ æ£€æµ‹åˆ°ä»¥ä¸‹å…³é”®ç‰¹æ€§ä¸æ”¯æŒï¼š${criticalFailures.join(', ')}ã€‚\nå»ºè®®å‡çº§ WebView è‡³ Chromium 84+ï¼Œæˆ–è€…æ‰‹åŠ¨é™çº§ä»£ç ï¼Œé¿å…ä½¿ç”¨ä¸Šè¿°è¯­æ³•ã€‚`;
        }

        function copyResult() {
            const text = "UserAgent: " + ua + "\næ¨æµ‹ Chromium ç‰ˆæœ¬: " + chromeVersion + "\n\n" +
                output.innerText + "\n" + summary.innerText;

            const textarea = document.createElement('textarea');
            textarea.value = text;
            document.body.appendChild(textarea);
            textarea.select();
            try {
                document.execCommand('copy');
                alert('âœ… æ£€æµ‹ç»“æœå·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
            } catch (err) {
                alert('âŒ å¤åˆ¶å¤±è´¥ï¼š' + err);
            }
            document.body.removeChild(textarea);
        }

    </script>
</body>

</html>